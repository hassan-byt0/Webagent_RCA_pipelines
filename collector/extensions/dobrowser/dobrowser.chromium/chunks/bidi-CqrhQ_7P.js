
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="171d0e36-afad-59d5-a839-8f0b64add2c9")}catch(e){}}();
var nf=Object.defineProperty;var af=Object.getPrototypeOf;var of=Reflect.get;var Xc=i=>{throw TypeError(i)};var cf=(i,e,t)=>e in i?nf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var F=(i,e,t)=>cf(i,typeof e!="symbol"?e+"":e,t),Jc=(i,e,t)=>e.has(i)||Xc("Cannot "+t),za=(i,e)=>Object(e)!==e?Xc('Cannot use the "in" operator on this value'):i.has(e),s=(i,e,t)=>(Jc(i,e,"read from private field"),t?t.call(i):e.get(i)),u=(i,e,t)=>e.has(i)?Xc("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),f=(i,e,t,r)=>(Jc(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t),w=(i,e,t)=>(Jc(i,e,"access private method"),t);var Yc=(i,e,t,r)=>({set _(n){f(i,e,n,t)},get _(){return s(i,e,r)}}),Fd=(i,e,t)=>of(af(i),t,e);import{ar as Dl,ab as rt}from"./Providers-CszSossT.js";import{C as uf,D as df,U,T as fd,E as z,a as lf,c as Re,d as Ie,e as md,f as bt,g as ne,h as ms,t as q,j as hf,J as pf,A as Rl,k as ff,l as mf,m as gf,s as Ol,n as wf,o as yf,H as vf,q as bf,u as jd,v as Cf,w as xf,x as Ef,y as Sf,z as Pf,B as _f,P as so,F as kf,G as If,R as Tf,I as Nf,K as Df,L as Rf,M as Ml,N as Bd,O as Ad,Q as $d,W as Of,V as Ht,X as Wa,Y as et,Z as pr,_ as Ld,$ as Ss,a0 as So,a1 as Mf,a2 as Ff,a3 as jf,a4 as Bf,a5 as Fl,a6 as Po,a7 as Af,a8 as Qc,a9 as $f,aa as Lf,ab as qf,ac as gs,ad as Uf,ae as Hf,af as Kt,ag as Kf,ah as zf,ai as Wf,aj as Vf,ak as Gf,al as Xf,am as qd,an as Jf,ao as Yf,ap as Qf,aq as cc,ar as uc,as as dc,at as Ud,au as Zf,av as em}from"./index-CNkQF85e.js";var lc={},hc={},qt={};function tm(i){return{all:i=i||new Map,on:function(e,t){var r=i.get(e);r?r.push(t):i.set(e,[t])},off:function(e,t){var r=i.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):i.set(e,[]))},emit:function(e,t){var r=i.get(e);r&&r.slice().map(function(n){n(t)}),(r=i.get("*"))&&r.slice().map(function(n){n(e,t)})}}}const sm=Object.freeze(Object.defineProperty({__proto__:null,default:tm},Symbol.toStringTag,{value:"Module"})),rm=Dl(sm);var nm=rt&&rt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(qt,"__esModule",{value:!0});qt.EventEmitter=void 0;const im=nm(rm);var zt;class am{constructor(){u(this,zt,(0,im.default)())}on(e,t){return s(this,zt).on(e,t),this}once(e,t){const r=n=>{t(n),this.off(e,r)};return this.on(e,r)}off(e,t){return s(this,zt).off(e,t),this}emit(e,t){s(this,zt).emit(e,t)}removeAllListeners(e){return e?s(this,zt).all.delete(e):s(this,zt).all.clear(),this}}zt=new WeakMap;qt.EventEmitter=am;var Te={};Object.defineProperty(Te,"__esModule",{value:!0});Te.LogType=void 0;var Hd;(function(i){i.bidi="bidi",i.cdp="cdp",i.debug="debug",i.debugError="debug:error",i.debugInfo="debug:info"})(Hd||(Te.LogType=Hd={}));var pc={},jl;Object.defineProperty(pc,"__esModule",{value:!0});pc.ProcessingQueue=void 0;const Zc=Te;var _s,oi,Nr,Dr,Oo,Bl;class gd{constructor(e,t){u(this,Oo);u(this,_s);u(this,oi);u(this,Nr,[]);u(this,Dr,!1);f(this,oi,e),f(this,_s,t)}add(e,t){s(this,Nr).push([e,t]),w(this,Oo,Bl).call(this)}}_s=new WeakMap,oi=new WeakMap,Nr=new WeakMap,Dr=new WeakMap,Oo=new WeakSet,Bl=async function(){var e;if(!s(this,Dr)){for(f(this,Dr,!0);s(this,Nr).length>0;){const t=s(this,Nr).shift();if(!t)continue;const[r,n]=t;(e=s(this,_s))==null||e.call(this,jl.LOGGER_PREFIX,"Processing event:",n),await r.then(a=>{var o;if(a.kind==="error"){(o=s(this,_s))==null||o.call(this,Zc.LogType.debugError,"Event threw before sending:",a.error.message,a.error.stack);return}return s(this,oi).call(this,a.value)}).catch(a=>{var o;(o=s(this,_s))==null||o.call(this,Zc.LogType.debugError,"Event was not processed:",a==null?void 0:a.message)})}f(this,Dr,!1)}},F(gd,"LOGGER_PREFIX",`${Zc.LogType.debug}:queue`);pc.ProcessingQueue=gd;jl=gd;var fc={},Z={},Al={};Object.defineProperty(Al,"__esModule",{value:!0});var xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.EVENT_NAMES=xe.Bluetooth=xe.Network=xe.BrowsingContext=xe.Log=xe.Script=xe.BiDiModule=void 0;var lu;(function(i){i.Bluetooth="bluetooth",i.Browser="browser",i.BrowsingContext="browsingContext",i.Cdp="goog:cdp",i.DeprecatedCdp="cdp",i.Input="input",i.Log="log",i.Network="network",i.Script="script",i.Session="session"})(lu||(xe.BiDiModule=lu={}));var hu;(function(i){(function(e){e.Message="script.message",e.RealmCreated="script.realmCreated",e.RealmDestroyed="script.realmDestroyed"})(i.EventNames||(i.EventNames={}))})(hu||(xe.Script=hu={}));var pu;(function(i){(function(e){e.LogEntryAdded="log.entryAdded"})(i.EventNames||(i.EventNames={}))})(pu||(xe.Log=pu={}));var fu;(function(i){(function(e){e.ContextCreated="browsingContext.contextCreated",e.ContextDestroyed="browsingContext.contextDestroyed",e.DomContentLoaded="browsingContext.domContentLoaded",e.DownloadWillBegin="browsingContext.downloadWillBegin",e.FragmentNavigated="browsingContext.fragmentNavigated",e.HistoryUpdated="browsingContext.historyUpdated",e.Load="browsingContext.load",e.NavigationAborted="browsingContext.navigationAborted",e.NavigationFailed="browsingContext.navigationFailed",e.NavigationStarted="browsingContext.navigationStarted",e.UserPromptClosed="browsingContext.userPromptClosed",e.UserPromptOpened="browsingContext.userPromptOpened"})(i.EventNames||(i.EventNames={}))})(fu||(xe.BrowsingContext=fu={}));var mu;(function(i){(function(e){e.AuthRequired="network.authRequired",e.BeforeRequestSent="network.beforeRequestSent",e.FetchError="network.fetchError",e.ResponseCompleted="network.responseCompleted",e.ResponseStarted="network.responseStarted"})(i.EventNames||(i.EventNames={}))})(mu||(xe.Network=mu={}));var Kd;(function(i){(function(e){e.RequestDevicePromptUpdated="bluetooth.requestDevicePromptUpdated"})(i.EventNames||(i.EventNames={}))})(Kd||(xe.Bluetooth=Kd={}));xe.EVENT_NAMES=new Set([...Object.values(lu),...Object.values(fu.EventNames),...Object.values(pu.EventNames),...Object.values(mu.EventNames),...Object.values(hu.EventNames)]);var $l={};Object.defineProperty($l,"__esModule",{value:!0});var B={};Object.defineProperty(B,"__esModule",{value:!0});B.NoSuchWebExtensionException=B.InvalidWebExtensionException=B.UnderspecifiedStoragePartitionException=B.UnableToSetFileInputException=B.UnableToSetCookieException=B.NoSuchStoragePartitionException=B.UnsupportedOperationException=B.UnableToCloseBrowserException=B.UnableToCaptureScreenException=B.UnknownErrorException=B.UnknownCommandException=B.SessionNotCreatedException=B.NoSuchUserContextException=B.NoSuchScriptException=B.NoSuchRequestException=B.NoSuchNodeException=B.NoSuchInterceptException=B.NoSuchHistoryEntryException=B.NoSuchHandleException=B.NoSuchFrameException=B.NoSuchElementException=B.NoSuchAlertException=B.MoveTargetOutOfBoundsException=B.InvalidSessionIdException=B.InvalidSelectorException=B.InvalidArgumentException=B.Exception=void 0;class ee extends Error{constructor(t,r,n){super();F(this,"error");F(this,"message");F(this,"stacktrace");this.error=t,this.message=r,this.stacktrace=n}toErrorResponse(t){return{type:"error",id:t,error:this.error,message:this.message,stacktrace:this.stacktrace}}}B.Exception=ee;class om extends ee{constructor(e,t){super("invalid argument",e,t)}}B.InvalidArgumentException=om;class cm extends ee{constructor(e,t){super("invalid selector",e,t)}}B.InvalidSelectorException=cm;class um extends ee{constructor(e,t){super("invalid session id",e,t)}}B.InvalidSessionIdException=um;class dm extends ee{constructor(e,t){super("move target out of bounds",e,t)}}B.MoveTargetOutOfBoundsException=dm;class lm extends ee{constructor(e,t){super("no such alert",e,t)}}B.NoSuchAlertException=lm;class hm extends ee{constructor(e,t){super("no such element",e,t)}}B.NoSuchElementException=hm;class pm extends ee{constructor(e,t){super("no such frame",e,t)}}B.NoSuchFrameException=pm;class fm extends ee{constructor(e,t){super("no such handle",e,t)}}B.NoSuchHandleException=fm;class mm extends ee{constructor(e,t){super("no such history entry",e,t)}}B.NoSuchHistoryEntryException=mm;class gm extends ee{constructor(e,t){super("no such intercept",e,t)}}B.NoSuchInterceptException=gm;class wm extends ee{constructor(e,t){super("no such node",e,t)}}B.NoSuchNodeException=wm;class ym extends ee{constructor(e,t){super("no such request",e,t)}}B.NoSuchRequestException=ym;class vm extends ee{constructor(e,t){super("no such script",e,t)}}B.NoSuchScriptException=vm;class bm extends ee{constructor(e,t){super("no such user context",e,t)}}B.NoSuchUserContextException=bm;class Cm extends ee{constructor(e,t){super("session not created",e,t)}}B.SessionNotCreatedException=Cm;class xm extends ee{constructor(e,t){super("unknown command",e,t)}}B.UnknownCommandException=xm;class Em extends ee{constructor(e,t=new Error().stack){super("unknown error",e,t)}}B.UnknownErrorException=Em;class Sm extends ee{constructor(e,t){super("unable to capture screen",e,t)}}B.UnableToCaptureScreenException=Sm;class Pm extends ee{constructor(e,t){super("unable to close browser",e,t)}}B.UnableToCloseBrowserException=Pm;class _m extends ee{constructor(e,t){super("unsupported operation",e,t)}}B.UnsupportedOperationException=_m;class km extends ee{constructor(e,t){super("no such storage partition",e,t)}}B.NoSuchStoragePartitionException=km;class Im extends ee{constructor(e,t){super("unable to set cookie",e,t)}}B.UnableToSetCookieException=Im;class Tm extends ee{constructor(e,t){super("unable to set file input",e,t)}}B.UnableToSetFileInputException=Tm;class Nm extends ee{constructor(e,t){super("underspecified storage partition",e,t)}}B.UnderspecifiedStoragePartitionException=Nm;class Dm extends ee{constructor(e,t){super("invalid web extension",e,t)}}B.InvalidWebExtensionException=Dm;class Rm extends ee{constructor(e,t){super("no such web extension",e,t)}}B.NoSuchWebExtensionException=Rm;var Ll={};Object.defineProperty(Ll,"__esModule",{value:!0});var ql={};Object.defineProperty(ql,"__esModule",{value:!0});(function(i){var e=rt&&rt.__createBinding||(Object.create?function(a,o,c,h){h===void 0&&(h=c);var d=Object.getOwnPropertyDescriptor(o,c);(!d||("get"in d?!o.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return o[c]}}),Object.defineProperty(a,h,d)}:function(a,o,c,h){h===void 0&&(h=c),a[h]=o[c]}),t=rt&&rt.__setModuleDefault||(Object.create?function(a,o){Object.defineProperty(a,"default",{enumerable:!0,value:o})}:function(a,o){a.default=o}),r=rt&&rt.__importStar||function(){var a=function(o){return a=Object.getOwnPropertyNames||function(c){var h=[];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(h[h.length]=d);return h},a(o)};return function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var h=a(o),d=0;d<h.length;d++)h[d]!=="default"&&e(c,o,h[d]);return t(c,o),c}}(),n=rt&&rt.__exportStar||function(a,o){for(var c in a)c!=="default"&&!Object.prototype.hasOwnProperty.call(o,c)&&e(o,a,c)};Object.defineProperty(i,"__esModule",{value:!0}),i.ChromiumBidi=i.Cdp=void 0,i.Cdp=r(Al),i.ChromiumBidi=r(xe),n($l,i),n(B,i),n(Ll,i),n(ql,i)})(Z);var mc={};Object.defineProperty(mc,"__esModule",{value:!0});mc.BidiNoOpParser=void 0;class Om{parseHandleRequestDevicePromptParams(e){return e}parseSimulateAdapterParameters(e){return e}parseSimulateAdvertisementParameters(e){return e}parseSimulatePreconnectedPeripheralParameters(e){return e}parseRemoveUserContextParams(e){return e}parseActivateParams(e){return e}parseCaptureScreenshotParams(e){return e}parseCloseParams(e){return e}parseCreateParams(e){return e}parseGetTreeParams(e){return e}parseHandleUserPromptParams(e){return e}parseLocateNodesParams(e){return e}parseNavigateParams(e){return e}parsePrintParams(e){return e}parseReloadParams(e){return e}parseSetViewportParams(e){return e}parseTraverseHistoryParams(e){return e}parseGetSessionParams(e){return e}parseResolveRealmParams(e){return e}parseSendCommandParams(e){return e}parseAddPreloadScriptParams(e){return e}parseCallFunctionParams(e){return e}parseDisownParams(e){return e}parseEvaluateParams(e){return e}parseGetRealmsParams(e){return e}parseRemovePreloadScriptParams(e){return e}parsePerformActionsParams(e){return e}parseReleaseActionsParams(e){return e}parseSetFilesParams(e){return e}parseAddInterceptParams(e){return e}parseContinueRequestParams(e){return e}parseContinueResponseParams(e){return e}parseContinueWithAuthParams(e){return e}parseFailRequestParams(e){return e}parseProvideResponseParams(e){return e}parseRemoveInterceptParams(e){return e}parseSetCacheBehavior(e){return e}parseSetPermissionsParams(e){return e}parseSubscribeParams(e){return e}parseDeleteCookiesParams(e){return e}parseGetCookiesParams(e){return e}parseSetCookieParams(e){return e}}mc.BidiNoOpParser=Om;var gc={};Object.defineProperty(gc,"__esModule",{value:!0});gc.BrowserProcessor=void 0;const zd=Z;var St,ci,Mo,Ul;class Mm{constructor(e,t){u(this,Mo);u(this,St);u(this,ci);f(this,St,e),f(this,ci,t)}close(){return setTimeout(()=>s(this,St).sendCommand("Browser.close"),0),{}}async createUserContext(e){const t={proxyServer:e["goog:proxyServer"]??void 0},r=e["goog:proxyBypassList"]??void 0;return r&&(t.proxyBypassList=r.join(",")),{userContext:(await s(this,St).sendCommand("Target.createBrowserContext",t)).browserContextId}}async removeUserContext(e){const t=e.userContext;if(t==="default")throw new zd.InvalidArgumentException("`default` user context cannot be removed");try{await s(this,St).sendCommand("Target.disposeBrowserContext",{browserContextId:t})}catch(r){throw r.message.startsWith("Failed to find context with id")?new zd.NoSuchUserContextException(r.message):r}return{}}async getUserContexts(){const e=await s(this,St).sendCommand("Target.getBrowserContexts");return{userContexts:[{userContext:"default"},...e.browserContextIds.map(t=>({userContext:t}))]}}async getClientWindows(){const e=s(this,ci).getTopLevelContexts().map(a=>a.cdpTarget.id),t=await Promise.all(e.map(async a=>await w(this,Mo,Ul).call(this,a))),r=new Set,n=new Array;for(const a of t)r.has(a.clientWindow)||(r.add(a.clientWindow),n.push(a));return{clientWindows:n}}}St=new WeakMap,ci=new WeakMap,Mo=new WeakSet,Ul=async function(e){const t=await s(this,St).sendCommand("Browser.getWindowForTarget",{targetId:e});return{active:!1,clientWindow:`${t.windowId}`,state:t.bounds.windowState??"normal",height:t.bounds.height??0,width:t.bounds.width??0,x:t.bounds.left??0,y:t.bounds.top??0}};gc.BrowserProcessor=Mm;var wc={};Object.defineProperty(wc,"__esModule",{value:!0});wc.CdpProcessor=void 0;const Fm=Z;var ui,di,li,hi;class jm{constructor(e,t,r,n){u(this,ui);u(this,di);u(this,li);u(this,hi);f(this,ui,e),f(this,di,t),f(this,li,r),f(this,hi,n)}getSession(e){const t=e.context,r=s(this,ui).getContext(t).cdpTarget.cdpSessionId;return r===void 0?{}:{session:r}}resolveRealm(e){const t=e.realm,r=s(this,di).getRealm({realmId:t});if(r===void 0)throw new Fm.UnknownErrorException(`Could not find realm ${e.realm}`);return{executionContextId:r.executionContextId}}async sendCommand(e){return{result:await(e.session?s(this,li).getCdpClient(e.session):s(this,hi)).sendCommand(e.method,e.params),session:e.session}}}ui=new WeakMap,di=new WeakMap,li=new WeakMap,hi=new WeakMap;wc.CdpProcessor=jm;var yc={};Object.defineProperty(yc,"__esModule",{value:!0});yc.BrowsingContextProcessor=void 0;const tt=Z;var pi,pe,Rr,Fo,Hl;class Bm{constructor(e,t,r){u(this,Fo);u(this,pi);u(this,pe);u(this,Rr);f(this,pi,e),f(this,pe,t),f(this,Rr,r),s(this,Rr).addSubscribeHook(tt.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,w(this,Fo,Hl).bind(this))}getTree(e){return{contexts:(e.root===void 0?s(this,pe).getTopLevelContexts():[s(this,pe).getContext(e.root)]).map(r=>r.serializeToBidiValue(e.maxDepth??Number.MAX_VALUE))}}async create(e){let t,r="default";if(e.referenceContext!==void 0){if(t=s(this,pe).getContext(e.referenceContext),!t.isTopLevelContext())throw new tt.InvalidArgumentException("referenceContext should be a top-level context");r=t.userContext}e.userContext!==void 0&&(r=e.userContext);const n=s(this,pe).getAllContexts().filter(h=>h.userContext===r);let a=!1;switch(e.type){case"tab":a=!1;break;case"window":a=!0;break}n.length||(a=!0);let o;try{o=await s(this,pi).sendCommand("Target.createTarget",{url:"about:blank",newWindow:a,browserContextId:r==="default"?void 0:r,background:e.background===!0})}catch(h){throw h.message.startsWith("Failed to find browser context with id")||h.message==="browserContextId"?new tt.NoSuchUserContextException(`The context ${r} was not found`):h}const c=await s(this,pe).waitForContext(o.targetId);return await c.lifecycleLoaded(),{context:c.id}}navigate(e){return s(this,pe).getContext(e.context).navigate(e.url,e.wait??"none")}reload(e){return s(this,pe).getContext(e.context).reload(e.ignoreCache??!1,e.wait??"none")}async activate(e){const t=s(this,pe).getContext(e.context);if(!t.isTopLevelContext())throw new tt.InvalidArgumentException("Activation is only supported on the top-level context");return await t.activate(),{}}async captureScreenshot(e){return await s(this,pe).getContext(e.context).captureScreenshot(e)}async print(e){return await s(this,pe).getContext(e.context).print(e)}async setViewport(e){const t=s(this,pe).getContext(e.context);if(!t.isTopLevelContext())throw new tt.InvalidArgumentException("Emulating viewport is only supported on the top-level context");return await t.setViewport(e.viewport,e.devicePixelRatio),{}}async traverseHistory(e){const t=s(this,pe).getContext(e.context);if(!t)throw new tt.InvalidArgumentException(`No browsing context with id ${e.context}`);if(!t.isTopLevelContext())throw new tt.InvalidArgumentException("Traversing history is only supported on the top-level context");return await t.traverseHistory(e.delta),{}}async handleUserPrompt(e){var r;const t=s(this,pe).getContext(e.context);try{await t.handleUserPrompt(e.accept,e.userText)}catch(n){throw(r=n.message)!=null&&r.includes("No dialog is showing")?new tt.NoSuchAlertException("No dialog is showing"):n}return{}}async close(e){const t=s(this,pe).getContext(e.context);if(!t.isTopLevelContext())throw new tt.InvalidArgumentException(`Non top-level browsing context ${t.id} cannot be closed.`);const r=t.cdpTarget.parentCdpClient;try{const n=new Promise(a=>{const o=c=>{c.targetId===e.context&&(r.off("Target.detachedFromTarget",o),a())};r.on("Target.detachedFromTarget",o)});try{e.promptUnload?await t.close():await r.sendCommand("Target.closeTarget",{targetId:e.context})}catch(a){if(!r.isCloseError(a))throw a}await n}catch(n){if(!(n.code===-32e3&&n.message==="Not attached to an active page"))throw n}return{}}async locateNodes(e){return await s(this,pe).getContext(e.context).locateNodes(e)}}pi=new WeakMap,pe=new WeakMap,Rr=new WeakMap,Fo=new WeakSet,Hl=function(e){return[s(this,pe).getContext(e),...s(this,pe).getContext(e).allChildren].forEach(n=>{s(this,Rr).registerEvent({type:"event",method:tt.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,params:n.serializeToBidiValue()},n.id)}),Promise.resolve()};yc.BrowsingContextProcessor=Bm;var vc={},Ut={};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.assert=Am;function Am(i,e){if(!i)throw new Error(e??"Internal assertion failed.")}var bc={},Cc={};Object.defineProperty(Cc,"__esModule",{value:!0});Cc.isSingleComplexGrapheme=$m;Cc.isSingleGrapheme=Kl;function $m(i){return Kl(i)&&i.length>1}function Kl(i){return[...new Intl.Segmenter("en",{granularity:"grapheme"}).segment(i)].length===1}var Ye={};Object.defineProperty(Ye,"__esModule",{value:!0});Ye.WheelSource=Ye.PointerSource=Ye.KeySource=Ye.NoneSource=void 0;class Lm{constructor(){F(this,"type","none")}}Ye.NoneSource=Lm;var nt,ks,Qn;class qm{constructor(){u(this,ks);F(this,"type","key");F(this,"pressed",new Set);u(this,nt,0)}get modifiers(){return s(this,nt)}get alt(){return(s(this,nt)&1)===1}set alt(e){w(this,ks,Qn).call(this,e,1)}get ctrl(){return(s(this,nt)&2)===2}set ctrl(e){w(this,ks,Qn).call(this,e,2)}get meta(){return(s(this,nt)&4)===4}set meta(e){w(this,ks,Qn).call(this,e,4)}get shift(){return(s(this,nt)&8)===8}set shift(e){w(this,ks,Qn).call(this,e,8)}}nt=new WeakMap,ks=new WeakSet,Qn=function(e,t){e?f(this,nt,s(this,nt)|t):f(this,nt,s(this,nt)&~t)};Ye.KeySource=qm;var yt,jo,fi,Or,Mr,Fr,jr;class zl{constructor(e,t){F(this,"type","pointer");F(this,"subtype");F(this,"pointerId");F(this,"pressed",new Set);F(this,"x",0);F(this,"y",0);F(this,"radiusX");F(this,"radiusY");F(this,"force");u(this,jr,new Map);this.pointerId=e,this.subtype=t}get buttons(){let e=0;for(const t of this.pressed)switch(t){case 0:e|=1;break;case 1:e|=4;break;case 2:e|=2;break;case 3:e|=8;break;case 4:e|=16;break}return e}setClickCount(e,t){let r=s(this,jr).get(e);return(!r||r.compare(t))&&(r=t),++r.count,s(this,jr).set(e,r),r.count}getClickCount(e){var t;return((t=s(this,jr).get(e))==null?void 0:t.count)??0}}jr=new WeakMap,F(zl,"ClickContext",(yt=class{constructor(t,r,n){F(this,"count",0);u(this,Or);u(this,Mr);u(this,Fr);f(this,Or,t),f(this,Mr,r),f(this,Fr,n)}compare(t){return s(t,Fr)-s(this,Fr)>s(yt,jo)||Math.abs(s(t,Or)-s(this,Or))>s(yt,fi)||Math.abs(s(t,Mr)-s(this,Mr))>s(yt,fi)}},jo=new WeakMap,fi=new WeakMap,Or=new WeakMap,Mr=new WeakMap,Fr=new WeakMap,u(yt,jo,500),u(yt,fi,2),yt));Ye.PointerSource=zl;class Um{constructor(){F(this,"type","wheel")}}Ye.WheelSource=Um;var $a={};Object.defineProperty($a,"__esModule",{value:!0});$a.getNormalizedKey=Hm;$a.getKeyCode=Km;$a.getKeyLocation=zm;function Hm(i){switch(i){case"":return"Unidentified";case"":return"Cancel";case"":return"Help";case"":return"Backspace";case"":return"Tab";case"":return"Clear";case"":case"":return"Enter";case"":return"Shift";case"":return"Control";case"":return"Alt";case"":return"Pause";case"":return"Escape";case"":return" ";case"":return"PageUp";case"":return"PageDown";case"":return"End";case"":return"Home";case"":return"ArrowLeft";case"":return"ArrowUp";case"":return"ArrowRight";case"":return"ArrowDown";case"":return"Insert";case"":return"Delete";case"":return";";case"":return"=";case"":return"0";case"":return"1";case"":return"2";case"":return"3";case"":return"4";case"":return"5";case"":return"6";case"":return"7";case"":return"8";case"":return"9";case"":return"*";case"":return"+";case"":return",";case"":return"-";case"":return".";case"":return"/";case"":return"F1";case"":return"F2";case"":return"F3";case"":return"F4";case"":return"F5";case"":return"F6";case"":return"F7";case"":return"F8";case"":return"F9";case"":return"F10";case"":return"F11";case"":return"F12";case"":return"Meta";case"":return"ZenkakuHankaku";case"":return"Shift";case"":return"Control";case"":return"Alt";case"":return"Meta";case"":return"PageUp";case"":return"PageDown";case"":return"End";case"":return"Home";case"":return"ArrowLeft";case"":return"ArrowUp";case"":return"ArrowRight";case"":return"ArrowDown";case"":return"Insert";case"":return"Delete";default:return i}}function Km(i){switch(i){case"`":case"~":return"Backquote";case"\\":case"|":return"Backslash";case"":return"Backspace";case"[":case"{":return"BracketLeft";case"]":case"}":return"BracketRight";case",":case"<":return"Comma";case"0":case")":return"Digit0";case"1":case"!":return"Digit1";case"2":case"@":return"Digit2";case"3":case"#":return"Digit3";case"4":case"$":return"Digit4";case"5":case"%":return"Digit5";case"6":case"^":return"Digit6";case"7":case"&":return"Digit7";case"8":case"*":return"Digit8";case"9":case"(":return"Digit9";case"=":case"+":return"Equal";case">":return"IntlBackslash";case"a":case"A":return"KeyA";case"b":case"B":return"KeyB";case"c":case"C":return"KeyC";case"d":case"D":return"KeyD";case"e":case"E":return"KeyE";case"f":case"F":return"KeyF";case"g":case"G":return"KeyG";case"h":case"H":return"KeyH";case"i":case"I":return"KeyI";case"j":case"J":return"KeyJ";case"k":case"K":return"KeyK";case"l":case"L":return"KeyL";case"m":case"M":return"KeyM";case"n":case"N":return"KeyN";case"o":case"O":return"KeyO";case"p":case"P":return"KeyP";case"q":case"Q":return"KeyQ";case"r":case"R":return"KeyR";case"s":case"S":return"KeyS";case"t":case"T":return"KeyT";case"u":case"U":return"KeyU";case"v":case"V":return"KeyV";case"w":case"W":return"KeyW";case"x":case"X":return"KeyX";case"y":case"Y":return"KeyY";case"z":case"Z":return"KeyZ";case"-":case"_":return"Minus";case".":return"Period";case"'":case'"':return"Quote";case";":case":":return"Semicolon";case"/":case"?":return"Slash";case"":return"AltLeft";case"":return"AltRight";case"":return"ControlLeft";case"":return"ControlRight";case"":return"Enter";case"":return"Pause";case"":return"MetaLeft";case"":return"MetaRight";case"":return"ShiftLeft";case"":return"ShiftRight";case" ":case"":return"Space";case"":return"Tab";case"":return"Delete";case"":return"End";case"":return"Help";case"":return"Home";case"":return"Insert";case"":return"PageDown";case"":return"PageUp";case"":return"ArrowDown";case"":return"ArrowLeft";case"":return"ArrowRight";case"":return"ArrowUp";case"":return"Escape";case"":return"F1";case"":return"F2";case"":return"F3";case"":return"F4";case"":return"F5";case"":return"F6";case"":return"F7";case"":return"F8";case"":return"F9";case"":return"F10";case"":return"F11";case"":return"F12";case"":return"NumpadEqual";case"":case"":return"Numpad0";case"":case"":return"Numpad1";case"":case"":return"Numpad2";case"":case"":return"Numpad3";case"":case"":return"Numpad4";case"":return"Numpad5";case"":case"":return"Numpad6";case"":case"":return"Numpad7";case"":case"":return"Numpad8";case"":case"":return"Numpad9";case"":return"NumpadAdd";case"":return"NumpadComma";case"":case"":return"NumpadDecimal";case"":return"NumpadDivide";case"":return"NumpadEnter";case"":return"NumpadMultiply";case"":return"NumpadSubtract";default:return}}function zm(i){switch(i){case"":case"":case"":case"":case"":return 1;case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":return 3;case"":case"":case"":case"":return 2;default:return 0}}var xc={};Object.defineProperty(xc,"__esModule",{value:!0});xc.KeyToKeyCode=void 0;xc.KeyToKeyCode={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,Abort:3,Help:6,Backspace:8,Tab:9,Numpad5:12,NumpadEnter:13,Enter:13,"\\r":13,"\\n":13,ShiftLeft:16,ShiftRight:16,ControlLeft:17,ControlRight:17,AltLeft:18,AltRight:18,Pause:19,CapsLock:20,Escape:27,Convert:28,NonConvert:29,Space:32,Numpad9:33,PageUp:33,Numpad3:34,PageDown:34,End:35,Numpad1:35,Home:36,Numpad7:36,ArrowLeft:37,Numpad4:37,Numpad8:38,ArrowUp:38,ArrowRight:39,Numpad6:39,Numpad2:40,ArrowDown:40,Select:41,Open:43,PrintScreen:44,Insert:45,Numpad0:45,Delete:46,NumpadDecimal:46,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,MetaLeft:91,MetaRight:92,ContextMenu:93,NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDivide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumLock:144,ScrollLock:145,AudioVolumeMute:173,AudioVolumeDown:174,AudioVolumeUp:175,MediaTrackNext:176,MediaTrackPrevious:177,MediaStop:178,MediaPlayPause:179,Semicolon:186,Equal:187,NumpadEqual:187,Comma:188,Minus:189,Period:190,Slash:191,Backquote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,AltGraph:225,Props:247,Cancel:3,Clear:12,Shift:16,Control:17,Alt:18,Accept:30,ModeChange:31," ":32,Print:42,Execute:43,"\\u0000":46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,Meta:91,"*":106,"+":107,"-":109,"/":111,";":186,"=":187,",":188,".":190,"`":192,"[":219,"\\\\":220,"]":221,"'":222,Attn:246,CrSel:247,ExSel:248,EraseEof:249,Play:250,ZoomOut:251,")":48,"!":49,"@":50,"#":51,$:52,"%":53,"^":54,"&":55,"(":57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,":":186,"<":188,_:189,">":190,"?":191,"~":192,"{":219,"|":220,"}":221,'"':222,Camera:44,EndCall:95,VolumeDown:182,VolumeUp:183};Object.defineProperty(bc,"__esModule",{value:!0});bc.ActionDispatcher=void 0;const xr=Z,ni=Ut,Va=Cc,Wm=Ye,fr=$a,Wd=xc,Vm=(i=>{const e=i.getClientRects()[0],t=Math.max(0,Math.min(e.x,e.x+e.width)),r=Math.min(window.innerWidth,Math.max(e.x,e.x+e.width)),n=Math.max(0,Math.min(e.y,e.y+e.height)),a=Math.min(window.innerHeight,Math.max(e.y,e.y+e.height));return[t+(r-t>>1),n+(a-n>>1)]}).toString(),Gm=(()=>navigator.platform.toLowerCase().includes("mac")).toString();async function Xm(i,e){var o,c,h,d;const r=await(await i.getOrCreateSandbox(void 0)).callFunction(Vm,!1,{type:"undefined"},[e]);if(r.type==="exception")throw new xr.NoSuchElementException(`Origin element ${e.sharedId} was not found`);(0,ni.assert)(r.result.type==="array"),(0,ni.assert)(((c=(o=r.result.value)==null?void 0:o[0])==null?void 0:c.type)==="number"),(0,ni.assert)(((d=(h=r.result.value)==null?void 0:h[1])==null?void 0:d.type)==="number");const{result:{value:[{value:n},{value:a}]}}=r;return{x:n,y:a}}var Br,Pt,_t,fe,Is,me,Vl,Gl,Xl,Jl,Yl,gu,Ql,Zl,eh;class Wl{constructor(e,t,r){u(this,me);u(this,Br,0);u(this,Pt,0);u(this,_t);u(this,fe);u(this,Is);f(this,_t,e),f(this,fe,t),f(this,Is,r)}async dispatchActions(e){await s(this,_t).queue.run(async()=>{for(const t of e)await this.dispatchTickActions(t)})}async dispatchTickActions(e){f(this,Br,performance.now()),f(this,Pt,0);for(const{action:r}of e)"duration"in r&&r.duration!==void 0&&f(this,Pt,Math.max(s(this,Pt),r.duration));const t=[new Promise(r=>setTimeout(r,s(this,Pt)))];for(const r of e)t.push(w(this,me,Vl).call(this,r));await Promise.all(t)}}Br=new WeakMap,Pt=new WeakMap,_t=new WeakMap,fe=new WeakMap,Is=new WeakMap,me=new WeakSet,Vl=async function({id:e,action:t}){const r=s(this,_t).get(e),n=s(this,_t).getGlobalKeyState();switch(t.type){case"keyDown":{await w(this,me,Zl).call(this,r,t),s(this,_t).cancelList.push({id:e,action:{...t,type:"keyUp"}});break}case"keyUp":{await w(this,me,eh).call(this,r,t);break}case"pause":break;case"pointerDown":{await w(this,me,Gl).call(this,r,n,t),s(this,_t).cancelList.push({id:e,action:{...t,type:"pointerUp"}});break}case"pointerMove":{await w(this,me,Jl).call(this,r,n,t);break}case"pointerUp":{await w(this,me,Xl).call(this,r,n,t);break}case"scroll":{await w(this,me,Ql).call(this,r,n,t);break}}},Gl=async function(e,t,r){const{button:n}=r;if(e.pressed.has(n))return;e.pressed.add(n);const{x:a,y:o,subtype:c}=e,{width:h,height:d,pressure:l,twist:p,tangentialPressure:m}=r,{tiltX:b,tiltY:x}=Xd(r),{modifiers:C}=t,{radiusX:y,radiusY:v}=Jd(h??1,d??1);switch(c){case"mouse":case"pen":await s(this,fe).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mousePressed",x:a,y:o,modifiers:C,button:Ga(n),buttons:e.buttons,clickCount:e.setClickCount(n,new Wm.PointerSource.ClickContext(a,o,performance.now())),pointerType:c,tangentialPressure:m,tiltX:b,tiltY:x,twist:p,force:l});break;case"touch":await s(this,fe).cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchStart",touchPoints:[{x:a,y:o,radiusX:y,radiusY:v,tangentialPressure:m,tiltX:b,tiltY:x,twist:p,force:l,id:e.pointerId}],modifiers:C});break}e.radiusX=y,e.radiusY=v,e.force=l},Xl=function(e,t,r){const{button:n}=r;if(!e.pressed.has(n))return;e.pressed.delete(n);const{x:a,y:o,force:c,radiusX:h,radiusY:d,subtype:l}=e,{modifiers:p}=t;switch(l){case"mouse":case"pen":return s(this,fe).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseReleased",x:a,y:o,modifiers:p,button:Ga(n),buttons:e.buttons,clickCount:e.getClickCount(n),pointerType:l});case"touch":return s(this,fe).cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchEnd",touchPoints:[{x:a,y:o,id:e.pointerId,force:c,radiusX:h,radiusY:d}],modifiers:p})}},Jl=async function(e,t,r){const{x:n,y:a,subtype:o}=e,{width:c,height:h,pressure:d,twist:l,tangentialPressure:p,x:m,y:b,origin:x="viewport",duration:C=s(this,Pt)}=r,{tiltX:y,tiltY:v}=Xd(r),{radiusX:N,radiusY:_}=Jd(c??1,h??1),{targetX:T,targetY:D}=await w(this,me,gu).call(this,x,m,b,n,a);if(T<0||D<0)throw new xr.MoveTargetOutOfBoundsException(`Cannot move beyond viewport (x: ${T}, y: ${D})`);let O;do{const E=C>0?(performance.now()-s(this,Br))/C:1;O=E>=1;let g,I;if(O?(g=T,I=D):(g=Math.round(E*(T-n)+n),I=Math.round(E*(D-a)+a)),e.x!==g||e.y!==I){const{modifiers:M}=t;switch(o){case"mouse":await s(this,fe).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseMoved",x:g,y:I,modifiers:M,clickCount:0,button:Ga(e.pressed.values().next().value??5),buttons:e.buttons,pointerType:o,tangentialPressure:p,tiltX:y,tiltY:v,twist:l,force:d});break;case"pen":e.pressed.size!==0&&await s(this,fe).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseMoved",x:g,y:I,modifiers:M,clickCount:0,button:Ga(e.pressed.values().next().value??5),buttons:e.buttons,pointerType:o,tangentialPressure:p,tiltX:y,tiltY:v,twist:l,force:d??.5});break;case"touch":e.pressed.size!==0&&await s(this,fe).cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchMove",touchPoints:[{x:g,y:I,radiusX:N,radiusY:_,tangentialPressure:p,tiltX:y,tiltY:v,twist:l,force:d,id:e.pointerId}],modifiers:M});break}e.x=g,e.y=I,e.radiusX=N,e.radiusY=_,e.force=d}}while(!O)},Yl=async function(){if(s(this,fe).id===s(this,fe).cdpTarget.id)return{x:0,y:0};const{backendNodeId:e}=await s(this,fe).cdpTarget.cdpClient.sendCommand("DOM.getFrameOwner",{frameId:s(this,fe).id}),{model:t}=await s(this,fe).cdpTarget.cdpClient.sendCommand("DOM.getBoxModel",{backendNodeId:e});return{x:t.content[0],y:t.content[1]}},gu=async function(e,t,r,n,a){let o,c;const h=await w(this,me,Yl).call(this);switch(e){case"viewport":o=t+h.x,c=r+h.y;break;case"pointer":o=n+t+h.x,c=a+r+h.y;break;default:{const{x:d,y:l}=await Xm(s(this,fe),e.element);o=d+t+h.x,c=l+r+h.y;break}}return{targetX:o,targetY:c}},Ql=async function(e,t,r){const{deltaX:n,deltaY:a,x:o,y:c,origin:h="viewport",duration:d=s(this,Pt)}=r;if(h==="pointer")throw new xr.InvalidArgumentException('"pointer" origin is invalid for scrolling.');const{targetX:l,targetY:p}=await w(this,me,gu).call(this,h,o,c,0,0);if(l<0||p<0)throw new xr.MoveTargetOutOfBoundsException(`Cannot move beyond viewport (x: ${l}, y: ${p})`);let m=0,b=0,x;do{const C=d>0?(performance.now()-s(this,Br))/d:1;x=C>=1;let y,v;if(x?(y=n-m,v=a-b):(y=Math.round(C*n-m),v=Math.round(C*a-b)),y!==0||v!==0){const{modifiers:N}=t;await s(this,fe).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseWheel",deltaX:y,deltaY:v,x:l,y:p,modifiers:N}),m+=y,b+=v}}while(!x)},Zl=async function(e,t){const r=t.value;if(!(0,Va.isSingleGrapheme)(r))throw new xr.InvalidArgumentException(`Invalid key value: ${r}`);const n=(0,Va.isSingleComplexGrapheme)(r),a=(0,fr.getNormalizedKey)(r),o=e.pressed.has(a),c=(0,fr.getKeyCode)(r),h=(0,fr.getKeyLocation)(r);switch(a){case"Alt":e.alt=!0;break;case"Shift":e.shift=!0;break;case"Control":e.ctrl=!0;break;case"Meta":e.meta=!0;break}e.pressed.add(a);const{modifiers:d}=e,l=Vd(a,e,n),p=Gd(c??"",e)??l;let m;if(s(this,Is)&&e.meta)switch(c){case"KeyA":m="SelectAll";break;case"KeyC":m="Copy";break;case"KeyV":m=e.shift?"PasteAndMatchStyle":"Paste";break;case"KeyX":m="Cut";break;case"KeyZ":m=e.shift?"Redo":"Undo";break}const b=[s(this,fe).cdpTarget.cdpClient.sendCommand("Input.dispatchKeyEvent",{type:p?"keyDown":"rawKeyDown",windowsVirtualKeyCode:Wd.KeyToKeyCode[a],key:a,code:c,text:p,unmodifiedText:l,autoRepeat:o,isSystemKey:e.alt||void 0,location:h<3?h:void 0,isKeypad:h===3,modifiers:d,commands:m?[m]:void 0})];a==="Escape"&&!e.alt&&(s(this,Is)&&!e.ctrl&&!e.meta||!s(this,Is))&&b.push(s(this,fe).cdpTarget.cdpClient.sendCommand("Input.cancelDragging")),await Promise.all(b)},eh=function(e,t){const r=t.value;if(!(0,Va.isSingleGrapheme)(r))throw new xr.InvalidArgumentException(`Invalid key value: ${r}`);const n=(0,Va.isSingleComplexGrapheme)(r),a=(0,fr.getNormalizedKey)(r);if(!e.pressed.has(a))return;const o=(0,fr.getKeyCode)(r),c=(0,fr.getKeyLocation)(r);switch(a){case"Alt":e.alt=!1;break;case"Shift":e.shift=!1;break;case"Control":e.ctrl=!1;break;case"Meta":e.meta=!1;break}e.pressed.delete(a);const{modifiers:h}=e,d=Vd(a,e,n),l=Gd(o??"",e)??d;return s(this,fe).cdpTarget.cdpClient.sendCommand("Input.dispatchKeyEvent",{type:"keyUp",windowsVirtualKeyCode:Wd.KeyToKeyCode[a],key:a,code:o,text:l,unmodifiedText:d,location:c<3?c:void 0,isSystemKey:e.alt||void 0,isKeypad:c===3,modifiers:h})},F(Wl,"isMacOS",async e=>{const t=await(await e.getOrCreateSandbox(void 0)).callFunction(Gm,!1);return(0,ni.assert)(t.type!=="exception"),(0,ni.assert)(t.result.type==="boolean"),t.result.value});bc.ActionDispatcher=Wl;const Vd=(i,e,t)=>t?i:i==="Enter"?"\r":[...i].length===1?e.shift?i.toLocaleUpperCase("en-US"):i:void 0,Gd=(i,e)=>{if(e.ctrl){switch(i){case"Digit2":if(e.shift)return"\0";break;case"KeyA":return"";case"KeyB":return"";case"KeyC":return"";case"KeyD":return"";case"KeyE":return"";case"KeyF":return"";case"KeyG":return"\x07";case"KeyH":return"\b";case"KeyI":return"	";case"KeyJ":return`
`;case"KeyK":return"\v";case"KeyL":return"\f";case"KeyM":return"\r";case"KeyN":return"";case"KeyO":return"";case"KeyP":return"";case"KeyQ":return"";case"KeyR":return"";case"KeyS":return"";case"KeyT":return"";case"KeyU":return"";case"KeyV":return"";case"KeyW":return"";case"KeyX":return"";case"KeyY":return"";case"KeyZ":return"";case"BracketLeft":return"\x1B";case"Backslash":return"";case"BracketRight":return"";case"Digit6":if(e.shift)return"";break;case"Minus":return""}return""}if(e.alt)return""};function Ga(i){switch(i){case 0:return"left";case 1:return"middle";case 2:return"right";case 3:return"back";case 4:return"forward";default:return"none"}}function Xd(i){const e=i.altitudeAngle??Math.PI/2,t=i.azimuthAngle??0;let r=0,n=0;if(e===0&&((t===0||t===2*Math.PI)&&(r=Math.PI/2),t===Math.PI/2&&(n=Math.PI/2),t===Math.PI&&(r=-Math.PI/2),t===3*Math.PI/2&&(n=-Math.PI/2),t>0&&t<Math.PI/2&&(r=Math.PI/2,n=Math.PI/2),t>Math.PI/2&&t<Math.PI&&(r=-Math.PI/2,n=Math.PI/2),t>Math.PI&&t<3*Math.PI/2&&(r=-Math.PI/2,n=-Math.PI/2),t>3*Math.PI/2&&t<2*Math.PI&&(r=Math.PI/2,n=-Math.PI/2)),e!==0){const o=Math.tan(e);r=Math.atan(Math.cos(t)/o),n=Math.atan(Math.sin(t)/o)}const a=180/Math.PI;return{tiltX:Math.round(r*a),tiltY:Math.round(n*a)}}function Jd(i,e){return{radiusX:i?i/2:.5,radiusY:e?e/2:.5}}var Ec={},Sc={},Pc={};Object.defineProperty(Pc,"__esModule",{value:!0});Pc.Mutex=void 0;var Ar,mi,gi,wu;class Jm{constructor(){u(this,gi);u(this,Ar,!1);u(this,mi,[])}acquire(){const e={resolved:!1};return s(this,Ar)?new Promise(t=>{s(this,mi).push(()=>t(w(this,gi,wu).bind(this,e)))}):(f(this,Ar,!0),Promise.resolve(w(this,gi,wu).bind(this,e)))}async run(e){const t=await this.acquire();try{return await e()}finally{t()}}}Ar=new WeakMap,mi=new WeakMap,gi=new WeakSet,wu=function(e){if(e.resolved)throw new Error("Cannot release more than once.");e.resolved=!0;const t=s(this,mi).shift();if(!t){f(this,Ar,!1);return}t()};Pc.Mutex=Jm;Object.defineProperty(Sc,"__esModule",{value:!0});Sc.InputState=void 0;const eu=Z,Ym=Pc,zn=Ye;var Wt,Bo;class Qm{constructor(){F(this,"cancelList",[]);u(this,Wt,new Map);u(this,Bo,new Ym.Mutex)}getOrCreate(e,t,r){let n=s(this,Wt).get(e);if(!n){switch(t){case"none":n=new zn.NoneSource;break;case"key":n=new zn.KeySource;break;case"pointer":{let a=r==="mouse"?0:2;const o=new Set;for(const[,c]of s(this,Wt))c.type==="pointer"&&o.add(c.pointerId);for(;o.has(a);)++a;n=new zn.PointerSource(a,r);break}case"wheel":n=new zn.WheelSource;break;default:throw new eu.InvalidArgumentException(`Expected "none", "key", "pointer", or "wheel". Found unknown source type ${t}.`)}return s(this,Wt).set(e,n),n}if(n.type!==t)throw new eu.InvalidArgumentException(`Input source type of ${e} is ${n.type}, but received ${t}.`);return n}get(e){const t=s(this,Wt).get(e);if(!t)throw new eu.UnknownErrorException("Internal error.");return t}getGlobalKeyState(){const e=new zn.KeySource;for(const[,t]of s(this,Wt))if(t.type==="key"){for(const r of t.pressed)e.pressed.add(r);e.alt||(e.alt=t.alt),e.ctrl||(e.ctrl=t.ctrl),e.meta||(e.meta=t.meta),e.shift||(e.shift=t.shift)}return e}get queue(){return s(this,Bo)}}Wt=new WeakMap,Bo=new WeakMap;Sc.InputState=Qm;Object.defineProperty(Ec,"__esModule",{value:!0});Ec.InputStateManager=void 0;const Zm=Ut,eg=Sc;class tg extends WeakMap{get(e){return(0,Zm.assert)(e.isTopLevelContext()),this.has(e)||this.set(e,new eg.InputState),super.get(e)}}Ec.InputStateManager=tg;Object.defineProperty(vc,"__esModule",{value:!0});vc.InputProcessor=void 0;const ws=Z,Xa=Ut,Ja=bc,sg=Ec;var Ts,$r,Ao,th;class rg{constructor(e){u(this,Ao);u(this,Ts);u(this,$r,new sg.InputStateManager);f(this,Ts,e)}async performActions(e){const t=s(this,Ts).getContext(e.context),r=s(this,$r).get(t.top),n=w(this,Ao,th).call(this,e,r);return await new Ja.ActionDispatcher(r,t,await Ja.ActionDispatcher.isMacOS(t).catch(()=>!1)).dispatchActions(n),{}}async releaseActions(e){const t=s(this,Ts).getContext(e.context),r=t.top,n=s(this,$r).get(r);return await new Ja.ActionDispatcher(n,t,await Ja.ActionDispatcher.isMacOS(t).catch(()=>!1)).dispatchTickActions(n.cancelList.reverse()),s(this,$r).delete(r),{}}async setFiles(e){const r=await s(this,Ts).getContext(e.context).getOrCreateSandbox(void 0);let n;try{n=await r.callFunction(String(function(h){if(!(this instanceof HTMLInputElement))return this instanceof Element?1:0;if(this.type!=="file")return 2;if(this.disabled)return 3;if(h>1&&!this.multiple)return 4}),!1,e.element,[{type:"number",value:e.files.length}])}catch{throw new ws.NoSuchNodeException(`Could not find element ${e.element.sharedId}`)}if((0,Xa.assert)(n.type==="success"),n.result.type==="number")switch(n.result.value){case 0:throw new ws.NoSuchElementException(`Could not find element ${e.element.sharedId}`);case 1:throw new ws.UnableToSetFileInputException(`Element ${e.element.sharedId} is not a input`);case 2:throw new ws.UnableToSetFileInputException(`Input element ${e.element.sharedId} is not a file type`);case 3:throw new ws.UnableToSetFileInputException(`Input element ${e.element.sharedId} is disabled`);case 4:throw new ws.UnableToSetFileInputException("Cannot set multiple files on a non-multiple input element")}if(e.files.length===0)return await r.callFunction(String(function(){var h;if(((h=this.files)==null?void 0:h.length)===0){this.dispatchEvent(new Event("cancel",{bubbles:!0}));return}this.files=new DataTransfer().files,this.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0}))}),!1,e.element),{};const a=[];for(let c=0;c<e.files.length;++c){const h=await r.callFunction(String(function(m){var b;return(b=this.files)==null?void 0:b.item(m)}),!1,e.element,[{type:"number",value:0}],"root");if((0,Xa.assert)(h.type==="success"),h.result.type!=="object")break;const{handle:d}=h.result;(0,Xa.assert)(d!==void 0);const{path:l}=await r.cdpClient.sendCommand("DOM.getFileInfo",{objectId:d});a.push(l),r.disown(d).catch(void 0)}a.sort();const o=[...e.files].sort();if(a.length!==e.files.length||o.some((c,h)=>a[h]!==c)){const{objectId:c}=await r.deserializeForCdp(e.element);(0,Xa.assert)(c!==void 0),await r.cdpClient.sendCommand("DOM.setFileInputFiles",{files:e.files,objectId:c})}else await r.callFunction(String(function(){this.dispatchEvent(new Event("cancel",{bubbles:!0}))}),!1,e.element);return{}}}Ts=new WeakMap,$r=new WeakMap,Ao=new WeakSet,th=function(e,t){var n;const r=[];for(const a of e.actions){switch(a.type){case"pointer":{a.parameters??(a.parameters={pointerType:"mouse"}),(n=a.parameters).pointerType??(n.pointerType="mouse");const c=t.getOrCreate(a.id,"pointer",a.parameters.pointerType);if(c.subtype!==a.parameters.pointerType)throw new ws.InvalidArgumentException(`Expected input source ${a.id} to be ${c.subtype}; got ${a.parameters.pointerType}.`);break}default:t.getOrCreate(a.id,a.type)}const o=a.actions.map(c=>({id:a.id,action:c}));for(let c=0;c<o.length;c++)r.length===c&&r.push([]),r[c].push(o[c])}return r};vc.InputProcessor=rg;var La={},ge={},wd={};Object.defineProperty(wd,"__esModule",{value:!0});wd.base64ToString=ng;function ng(i){return"atob"in globalThis?globalThis.atob(i):Buffer.from(i,"base64").toString("ascii")}Object.defineProperty(ge,"__esModule",{value:!0});ge.computeHeadersSize=og;ge.bidiNetworkHeadersFromCdpNetworkHeaders=cg;ge.bidiNetworkHeadersFromCdpNetworkHeadersEntries=ug;ge.cdpNetworkHeadersFromBidiNetworkHeaders=dg;ge.bidiNetworkHeadersFromCdpFetchHeaders=lg;ge.cdpFetchHeadersFromBidiNetworkHeaders=hg;ge.networkHeaderFromCookieHeaders=pg;ge.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction=fg;ge.cdpToBiDiCookie=mg;ge.deserializeByteValue=sh;ge.bidiToCdpCookie=gg;ge.sameSiteBiDiToCdp=rh;ge.isSpecialScheme=yg;ge.matchUrlPattern=bg;ge.bidiBodySizeFromCdpPostDataEntries=Cg;ge.getTiming=xg;const ig=B,ag=wd;function og(i){const e=i.reduce((t,r)=>`${t}${r.name}: ${r.value.value}\r
`,"");return new TextEncoder().encode(e).length}function cg(i){return i?Object.entries(i).map(([e,t])=>({name:e,value:{type:"string",value:t}})):[]}function ug(i){return i?i.map(({name:e,value:t})=>({name:e,value:{type:"string",value:t}})):[]}function dg(i){if(i!==void 0)return i.reduce((e,t)=>(e[t.name]=t.value.value,e),{})}function lg(i){return i?i.map(({name:e,value:t})=>({name:e,value:{type:"string",value:t}})):[]}function hg(i){if(i!==void 0)return i.map(({name:e,value:t})=>({name:e,value:t.value}))}function pg(i){return i===void 0?void 0:{name:"Cookie",value:{type:"string",value:i.reduce((t,r,n)=>{n>0&&(t+=";");const a=r.value.type==="base64"?btoa(r.value.value):r.value.value;return t+=`${r.name}=${a}`,t},"")}}}function fg(i){switch(i){case"default":return"Default";case"cancel":return"CancelAuth";case"provideCredentials":return"ProvideCredentials"}}function mg(i){const e={name:i.name,value:{type:"string",value:i.value},domain:i.domain,path:i.path,size:i.size,httpOnly:i.httpOnly,secure:i.secure,sameSite:i.sameSite===void 0?"none":wg(i.sameSite),...i.expires>=0?{expiry:i.expires}:void 0};return e["goog:session"]=i.session,e["goog:priority"]=i.priority,e["goog:sameParty"]=i.sameParty,e["goog:sourceScheme"]=i.sourceScheme,e["goog:sourcePort"]=i.sourcePort,i.partitionKey!==void 0&&(e["goog:partitionKey"]=i.partitionKey),i.partitionKeyOpaque!==void 0&&(e["goog:partitionKeyOpaque"]=i.partitionKeyOpaque),e}function sh(i){return i.type==="base64"?(0,ag.base64ToString)(i.value):i.value}function gg(i,e){const t=sh(i.cookie.value),r={name:i.cookie.name,value:t,domain:i.cookie.domain,path:i.cookie.path??"/",secure:i.cookie.secure??!1,httpOnly:i.cookie.httpOnly??!1,...e.sourceOrigin!==void 0&&{partitionKey:{hasCrossSiteAncestor:!1,topLevelSite:e.sourceOrigin}},...i.cookie.expiry!==void 0&&{expires:i.cookie.expiry},...i.cookie.sameSite!==void 0&&{sameSite:rh(i.cookie.sameSite)}};return i.cookie["goog:url"]!==void 0&&(r.url=i.cookie["goog:url"]),i.cookie["goog:priority"]!==void 0&&(r.priority=i.cookie["goog:priority"]),i.cookie["goog:sameParty"]!==void 0&&(r.sameParty=i.cookie["goog:sameParty"]),i.cookie["goog:sourceScheme"]!==void 0&&(r.sourceScheme=i.cookie["goog:sourceScheme"]),i.cookie["goog:sourcePort"]!==void 0&&(r.sourcePort=i.cookie["goog:sourcePort"]),r}function wg(i){switch(i){case"Strict":return"strict";case"None":return"none";case"Lax":return"lax";default:return"lax"}}function rh(i){switch(i){case"strict":return"Strict";case"lax":return"Lax";case"none":return"None"}throw new ig.InvalidArgumentException(`Unknown 'sameSite' value ${i}`)}function yg(i){return["ftp","file","http","https","ws","wss"].includes(i.replace(/:$/,""))}function vg(i){return i.protocol.replace(/:$/,"")}function bg(i,e){const t=new URL(e);return!(i.protocol!==void 0&&i.protocol!==vg(t)||i.hostname!==void 0&&i.hostname!==t.hostname||i.port!==void 0&&i.port!==t.port||i.pathname!==void 0&&i.pathname!==t.pathname||i.search!==void 0&&i.search!==t.search)}function Cg(i){let e=0;for(const t of i)e+=atob(t.bytes??"").length;return e}function xg(i){return!i||i<0?0:i}Object.defineProperty(La,"__esModule",{value:!0});La.NetworkProcessor=void 0;const le=Z,Yd=ge;var kt,Vt,vt,vu,Zn;const Ve=class Ve{constructor(e,t){u(this,vt);u(this,kt);u(this,Vt);f(this,kt,e),f(this,Vt,t)}async addIntercept(e){s(this,kt).verifyTopLevelContextsList(e.contexts);const t=e.urlPatterns??[],r=Ve.parseUrlPatterns(t),n=s(this,Vt).addIntercept({urlPatterns:r,phases:e.phases,contexts:e.contexts});return await Promise.all(s(this,kt).getAllContexts().map(a=>a.cdpTarget.toggleNetwork())),{intercept:n}}async continueRequest(e){if(e.url!==void 0&&Ve.parseUrlString(e.url),e.method!==void 0&&!Ve.isMethodValid(e.method))throw new le.InvalidArgumentException(`Method '${e.method}' is invalid.`);e.headers&&Ve.validateHeaders(e.headers);const t=w(this,vt,Zn).call(this,e.request,["beforeRequestSent"]);try{await t.continueRequest(e)}catch(r){throw Ve.wrapInterceptionError(r)}return{}}async continueResponse(e){e.headers&&Ve.validateHeaders(e.headers);const t=w(this,vt,Zn).call(this,e.request,["authRequired","responseStarted"]);try{await t.continueResponse(e)}catch(r){throw Ve.wrapInterceptionError(r)}return{}}async continueWithAuth(e){const t=e.request;return await w(this,vt,Zn).call(this,t,["authRequired"]).continueWithAuth(e),{}}async failRequest({request:e}){const t=w(this,vt,vu).call(this,e);if(t.interceptPhase==="authRequired")throw new le.InvalidArgumentException(`Request '${e}' in 'authRequired' phase cannot be failed`);if(!t.interceptPhase)throw new le.NoSuchRequestException(`No blocked request found for network id '${e}'`);return await t.failRequest("Failed"),{}}async provideResponse(e){e.headers&&Ve.validateHeaders(e.headers);const t=w(this,vt,Zn).call(this,e.request,["beforeRequestSent","responseStarted","authRequired"]);try{await t.provideResponse(e)}catch(r){throw Ve.wrapInterceptionError(r)}return{}}async removeIntercept(e){return s(this,Vt).removeIntercept(e.intercept),await Promise.all(s(this,kt).getAllContexts().map(t=>t.cdpTarget.toggleNetwork())),{}}async setCacheBehavior(e){const t=s(this,kt).verifyTopLevelContextsList(e.contexts);if(t.size===0)return s(this,Vt).defaultCacheBehavior=e.cacheBehavior,await Promise.all(s(this,kt).getAllContexts().map(n=>n.cdpTarget.toggleSetCacheDisabled())),{};const r=e.cacheBehavior==="bypass";return await Promise.all([...t.values()].map(n=>n.cdpTarget.toggleSetCacheDisabled(r))),{}}static validateHeaders(e){for(const t of e){let r;if(t.value.type==="string"?r=t.value.value:r=atob(t.value.value),r!==r.trim()||r.includes(`
`)||r.includes("\0"))throw new le.InvalidArgumentException(`Header value '${r}' is not acceptable value`)}}static isMethodValid(e){return/^[!#$%&'*+\-.^_`|~a-zA-Z\d]+$/.test(e)}static parseUrlString(e){try{return new URL(e)}catch(t){throw new le.InvalidArgumentException(`Invalid URL '${e}': ${t}`)}}static parseUrlPatterns(e){return e.map(t=>{let r="",n=!0,a=!0,o=!0,c=!0,h=!0;switch(t.type){case"string":{r=mr(t.pattern);break}case"pattern":{if(t.protocol===void 0)n=!1,r+="http";else{if(t.protocol==="")throw new le.InvalidArgumentException("URL pattern must specify a protocol");if(t.protocol=mr(t.protocol),!t.protocol.match(/^[a-zA-Z+-.]+$/))throw new le.InvalidArgumentException("Forbidden characters");r+=t.protocol}const l=r.toLocaleLowerCase();if(r+=":",(0,Yd.isSpecialScheme)(l)&&(r+="//"),t.hostname===void 0)l!=="file"&&(r+="placeholder"),a=!1;else{if(t.hostname==="")throw new le.InvalidArgumentException("URL pattern must specify a hostname");if(t.protocol==="file")throw new le.InvalidArgumentException("URL pattern protocol cannot be 'file'");t.hostname=mr(t.hostname);let p=!1;for(const m of t.hostname){if(m==="/"||m==="?"||m==="#")throw new le.InvalidArgumentException("'/', '?', '#' are forbidden in hostname");if(!p&&m===":")throw new le.InvalidArgumentException("':' is only allowed inside brackets in hostname");m==="["&&(p=!0),m==="]"&&(p=!1)}r+=t.hostname}if(t.port===void 0)o=!1;else{if(t.port==="")throw new le.InvalidArgumentException("URL pattern must specify a port");if(t.port=mr(t.port),r+=":",!t.port.match(/^\d+$/))throw new le.InvalidArgumentException("Forbidden characters");r+=t.port}if(t.pathname===void 0)c=!1;else{if(t.pathname=mr(t.pathname),t.pathname[0]!=="/"&&(r+="/"),t.pathname.includes("#")||t.pathname.includes("?"))throw new le.InvalidArgumentException("Forbidden characters");r+=t.pathname}if(t.search===void 0)h=!1;else{if(t.search=mr(t.search),t.search[0]!=="?"&&(r+="?"),t.search.includes("#"))throw new le.InvalidArgumentException("Forbidden characters");r+=t.search}break}}const d=l=>{const p={"ftp:":21,"file:":null,"http:":80,"https:":443,"ws:":80,"wss:":443};if((0,Yd.isSpecialScheme)(l.protocol)&&p[l.protocol]!==null&&(!l.port||String(p[l.protocol])===l.port))return"";if(l.port)return l.port};try{const l=new URL(r);return{protocol:n?l.protocol.replace(/:$/,""):void 0,hostname:a?l.hostname:void 0,port:o?d(l):void 0,pathname:c&&l.pathname?l.pathname:void 0,search:h?l.search:void 0}}catch(l){throw new le.InvalidArgumentException(`${l.message} '${r}'`)}})}static wrapInterceptionError(e){return e!=null&&e.message.includes("Invalid header")?new le.InvalidArgumentException("Invalid header"):e}};kt=new WeakMap,Vt=new WeakMap,vt=new WeakSet,vu=function(e){const t=s(this,Vt).getRequestById(e);if(!t)throw new le.NoSuchRequestException(`Network request with ID '${e}' doesn't exist`);return t},Zn=function(e,t){const r=w(this,vt,vu).call(this,e);if(!r.interceptPhase)throw new le.NoSuchRequestException(`No blocked request found for network id '${e}'`);if(r.interceptPhase&&!t.includes(r.interceptPhase))throw new le.InvalidArgumentException(`Blocked request for network id '${e}' is in '${r.interceptPhase}' phase`);return r};let yu=Ve;La.NetworkProcessor=yu;function mr(i){const e=new Set(["(",")","*","{","}"]);let t="",r=!1;for(const n of i){if(!r){if(e.has(n))throw new le.InvalidArgumentException("Forbidden characters");if(n==="\\"){r=!0;continue}}t+=n,r=!1}return t}var _c={};Object.defineProperty(_c,"__esModule",{value:!0});_c.PermissionsProcessor=void 0;const Eg=Z;var wi;class Sg{constructor(e){u(this,wi);f(this,wi,e)}async setPermissions(e){try{const t=e["goog:userContext"]||e.userContext;await s(this,wi).sendCommand("Browser.setPermission",{origin:e.origin,browserContextId:t&&t!=="default"?t:void 0,permission:{name:e.descriptor.name},setting:e.state})}catch(t){if(t.message==="Permission can't be granted to opaque origins.")return{};throw new Eg.InvalidArgumentException(t.message)}return{}}}wi=new WeakMap;_c.PermissionsProcessor=Sg;var kc={},Ic={},dr={};const Pg={},_g=Object.freeze(Object.defineProperty({__proto__:null,default:Pg},Symbol.toStringTag,{value:"Module"})),kg=Dl(_g);Object.defineProperty(dr,"__esModule",{value:!0});dr.uuidv4=Ig;function Wn(i){return i.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")}function Ig(){if("crypto"in globalThis&&"randomUUID"in globalThis.crypto)return globalThis.crypto.randomUUID();const i=new Uint8Array(16);return"crypto"in globalThis&&"getRandomValues"in globalThis.crypto?globalThis.crypto.getRandomValues(i):kg.webcrypto.getRandomValues(i),i[6]=i[6]&15|64,i[8]=i[8]&63|128,[Wn(i.subarray(0,4)),Wn(i.subarray(4,6)),Wn(i.subarray(6,8)),Wn(i.subarray(8,10)),Wn(i.subarray(10,16))].join("-")}var qa={};Object.defineProperty(qa,"__esModule",{value:!0});qa.ChannelProxy=void 0;const Tg=Z,Qd=Te,Ng=dr;var Ns,Lr,qr,Lt,Cu,nh,ih,cr,xu,ah;const Tr=class Tr{constructor(e,t){u(this,cr);u(this,Ns);u(this,Lr,(0,Ng.uuidv4)());u(this,qr);f(this,Ns,e),f(this,qr,t)}async init(e,t){var a,o;const r=await w(a=Tr,Lt,nh).call(a,e),n=await w(o=Tr,Lt,ih).call(o,e,r);return w(this,cr,xu).call(this,e,r,t),n}async startListenerFromWindow(e,t){var r;try{const n=await w(this,cr,ah).call(this,e);w(this,cr,xu).call(this,e,n,t)}catch(n){(r=s(this,qr))==null||r.call(this,Qd.LogType.debugError,n)}}getEvalInWindowStr(){var r;const e=String((n,a)=>{const o=window;return o[n]===void 0?o[n]=a:(o[n](a),delete o[n]),a.sendMessage}),t=w(r=Tr,Lt,Cu).call(r);return`(${e})('${s(this,Lr)}',${t})`}};Ns=new WeakMap,Lr=new WeakMap,qr=new WeakMap,Lt=new WeakSet,Cu=function(){return`(${String(()=>{const t=[];let r=null;return{async getMessage(){return await(t.length>0?Promise.resolve():new Promise(a=>{r=a})),t.shift()},sendMessage(n){t.push(n),r!==null&&(r(),r=null)}}})})()`},nh=async function(e){const t=await e.cdpClient.sendCommand("Runtime.evaluate",{expression:w(this,Lt,Cu).call(this),contextId:e.executionContextId,serializationOptions:{serialization:"idOnly"}});if(t.exceptionDetails||t.result.objectId===void 0)throw new Error("Cannot create channel");return t.result.objectId},ih=async function(e,t){return(await e.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(n=>n.sendMessage),arguments:[{objectId:t}],executionContextId:e.executionContextId,serializationOptions:{serialization:"idOnly"}})).result.objectId},cr=new WeakSet,xu=async function(e,t,r){var n,a;for(;;)try{const o=await e.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(async c=>await c.getMessage()),arguments:[{objectId:t}],awaitPromise:!0,executionContextId:e.executionContextId,serializationOptions:{serialization:"deep",maxDepth:((n=s(this,Ns).serializationOptions)==null?void 0:n.maxObjectDepth)??void 0}});if(o.exceptionDetails)throw new Error("Runtime.callFunctionOn in ChannelProxy",{cause:o.exceptionDetails});for(const c of e.associatedBrowsingContexts)r.registerEvent({type:"event",method:Tg.ChromiumBidi.Script.EventNames.Message,params:{channel:s(this,Ns).channel,data:e.cdpToBidiValue(o,s(this,Ns).ownership??"none"),source:e.source}},c.id)}catch(o){(a=s(this,qr))==null||a.call(this,Qd.LogType.debugError,o);break}},ah=async function(e){const t=await e.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(r=>{const n=window;if(n[r]===void 0)return new Promise(o=>n[r]=o);const a=n[r];return delete n[r],a}),arguments:[{value:s(this,Lr)}],executionContextId:e.executionContextId,awaitPromise:!0,serializationOptions:{serialization:"idOnly"}});if(t.exceptionDetails!==void 0||t.result.objectId===void 0)throw new Error(`ChannelHandle not found in window["${s(this,Lr)}"]`);return t.result.objectId},u(Tr,Lt);let bu=Tr;qa.ChannelProxy=bu;Object.defineProperty(Ic,"__esModule",{value:!0});Ic.PreloadScript=void 0;const Dg=dr,Rg=qa;var $o,Ds,yi,Ur,vi,bi,Ci,Lo,oh;class Og{constructor(e,t){u(this,Lo);u(this,$o,(0,Dg.uuidv4)());u(this,Ds,[]);u(this,yi);u(this,Ur,new Set);u(this,vi);u(this,bi);u(this,Ci);var r;f(this,vi,((r=e.arguments)==null?void 0:r.map(n=>new Rg.ChannelProxy(n.value,t)))??[]),f(this,yi,e.functionDeclaration),f(this,bi,e.sandbox),f(this,Ci,e.contexts)}get id(){return s(this,$o)}get targetIds(){return s(this,Ur)}get channels(){return s(this,vi)}get contexts(){return s(this,Ci)}async initInTargets(e,t){await Promise.all(Array.from(e).map(r=>this.initInTarget(r,t)))}async initInTarget(e,t){const r=await e.cdpClient.sendCommand("Page.addScriptToEvaluateOnNewDocument",{source:w(this,Lo,oh).call(this),worldName:s(this,bi),runImmediately:t});s(this,Ds).push({target:e,preloadScriptId:r.identifier}),s(this,Ur).add(e.id)}async remove(){await Promise.all([s(this,Ds).map(async e=>{const t=e.target,r=e.preloadScriptId;return await t.cdpClient.sendCommand("Page.removeScriptToEvaluateOnNewDocument",{identifier:r})})])}dispose(e){f(this,Ds,s(this,Ds).filter(t=>{var r;return((r=t.target)==null?void 0:r.id)!==e})),s(this,Ur).delete(e)}}$o=new WeakMap,Ds=new WeakMap,yi=new WeakMap,Ur=new WeakMap,vi=new WeakMap,bi=new WeakMap,Ci=new WeakMap,Lo=new WeakSet,oh=function(){const e=`[${this.channels.map(t=>t.getEvalInWindowStr()).join(", ")}]`;return`(()=>{(${s(this,yi)})(...${e})})()`};Ic.PreloadScript=Og;Object.defineProperty(kc,"__esModule",{value:!0});kc.ScriptProcessor=void 0;const tu=Z,Mg=Ic;var Hr,it,Rs,Os,xi,ps,ch,ro;class Fg{constructor(e,t,r,n,a){u(this,ps);u(this,Hr);u(this,it);u(this,Rs);u(this,Os);u(this,xi);f(this,it,t),f(this,Rs,r),f(this,Os,n),f(this,xi,a),f(this,Hr,e),s(this,Hr).addSubscribeHook(tu.ChromiumBidi.Script.EventNames.RealmCreated,w(this,ps,ch).bind(this))}async addPreloadScript(e){const t=s(this,it).verifyTopLevelContextsList(e.contexts),r=new Mg.PreloadScript(e,s(this,xi));s(this,Os).add(r);const n=t.size===0?new Set(s(this,it).getTopLevelContexts().map(a=>a.cdpTarget)):new Set([...t.values()].map(a=>a.cdpTarget));return await r.initInTargets(n,!1),{script:r.id}}async removePreloadScript(e){const{script:t}=e,r=s(this,Os).find({id:t});if(r.length===0)throw new tu.NoSuchScriptException(`No preload script with id '${t}'`);return await Promise.all(r.map(n=>n.remove())),s(this,Os).remove({id:t}),{}}async callFunction(e){return await(await w(this,ps,ro).call(this,e.target)).callFunction(e.functionDeclaration,e.awaitPromise,e.this,e.arguments,e.resultOwnership,e.serializationOptions,e.userActivation)}async evaluate(e){return await(await w(this,ps,ro).call(this,e.target)).evaluate(e.expression,e.awaitPromise,e.resultOwnership,e.serializationOptions,e.userActivation)}async disown(e){const t=await w(this,ps,ro).call(this,e.target);return await Promise.all(e.handles.map(async r=>await t.disown(r))),{}}getRealms(e){return e.context!==void 0&&s(this,it).getContext(e.context),{realms:s(this,Rs).findRealms({browsingContextId:e.context,type:e.type}).map(r=>r.realmInfo)}}}Hr=new WeakMap,it=new WeakMap,Rs=new WeakMap,Os=new WeakMap,xi=new WeakMap,ps=new WeakSet,ch=function(e){const t=s(this,it).getContext(e),r=[t,...s(this,it).getContext(e).allChildren],n=new Set;for(const a of r){const o=s(this,Rs).findRealms({browsingContextId:a.id});for(const c of o)n.add(c)}for(const a of n)s(this,Hr).registerEvent({type:"event",method:tu.ChromiumBidi.Script.EventNames.RealmCreated,params:a.realmInfo},t.id);return Promise.resolve()},ro=async function(e){return"context"in e?await s(this,it).getContext(e.context).getOrCreateSandbox(e.sandbox):s(this,Rs).getRealm({realmId:e.realm})};kc.ScriptProcessor=Fg;var Tc={};Object.defineProperty(Tc,"__esModule",{value:!0});Tc.SessionProcessor=void 0;const su=Z;var Kr,Ei,Si,Pi,Bn,uh,dh;class jg{constructor(e,t,r){u(this,Bn);u(this,Kr);u(this,Ei);u(this,Si);u(this,Pi,!1);f(this,Kr,e),f(this,Ei,t),f(this,Si,r)}status(){return{ready:!1,message:"already connected"}}async new(e){if(s(this,Pi))throw new Error("Session has been already created.");f(this,Pi,!0);const t=w(this,Bn,uh).call(this,e.capabilities);await s(this,Si).call(this,t);const r=await s(this,Ei).sendCommand("Browser.getVersion");return{sessionId:"unknown",capabilities:{...t,acceptInsecureCerts:t.acceptInsecureCerts??!1,browserName:r.product,browserVersion:r.revision,platformName:"",setWindowRect:!1,webSocketUrl:"",userAgent:r.userAgent}}}async subscribe(e,t=null){return await s(this,Kr).subscribe(e.events,e.contexts??[null],t),{}}async unsubscribe(e,t=null){return await s(this,Kr).unsubscribe(e.events,e.contexts??[null],t),{}}}Kr=new WeakMap,Ei=new WeakMap,Si=new WeakMap,Pi=new WeakMap,Bn=new WeakSet,uh=function(e){const t=[];for(const n of e.firstMatch??[{}]){const a={...e.alwaysMatch};for(const o of Object.keys(n)){if(a[o]!==void 0)throw new su.InvalidArgumentException(`Capability ${o} in firstMatch is already defined in alwaysMatch`);a[o]=n[o]}t.push(a)}const r=t.find(n=>n.browserName==="chrome")??t[0]??{};return r.unhandledPromptBehavior=w(this,Bn,dh).call(this,r.unhandledPromptBehavior),r},dh=function(e){if(e!==void 0){if(typeof e=="object")return e;if(typeof e!="string")throw new su.InvalidArgumentException(`Unexpected 'unhandledPromptBehavior' type: ${typeof e}`);switch(e){case"accept":case"accept and notify":return{default:"accept"};case"dismiss":case"dismiss and notify":return{default:"dismiss"};case"ignore":return{default:"ignore"};default:throw new su.InvalidArgumentException(`Unexpected 'unhandledPromptBehavior' value: ${e}`)}}};Tc.SessionProcessor=jg;var Nc={};Object.defineProperty(Nc,"__esModule",{value:!0});Nc.StorageProcessor=void 0;const Ya=Z,Bg=Ut,Zd=Te,Ag=La,Vn=ge;var Gt,_i,zr,ue,no,ei,lh,hh,io,Eu;class $g{constructor(e,t,r){u(this,ue);u(this,Gt);u(this,_i);u(this,zr);f(this,_i,t),f(this,Gt,e),f(this,zr,r)}async deleteCookies(e){const t=w(this,ue,io).call(this,e.partition);let r;try{r=await s(this,Gt).sendCommand("Storage.getCookies",{browserContextId:w(this,ue,ei).call(this,t)})}catch(a){throw w(this,ue,no).call(this,a)?new Ya.NoSuchUserContextException(a.message):a}const n=r.cookies.filter(a=>{var o;return t.sourceOrigin===void 0||((o=a.partitionKey)==null?void 0:o.topLevelSite)===t.sourceOrigin}).filter(a=>{const o=(0,Vn.cdpToBiDiCookie)(a);return w(this,ue,Eu).call(this,o,e.filter)}).map(a=>({...a,expires:1}));return await s(this,Gt).sendCommand("Storage.setCookies",{cookies:n,browserContextId:w(this,ue,ei).call(this,t)}),{partitionKey:t}}async getCookies(e){const t=w(this,ue,io).call(this,e.partition);let r;try{r=await s(this,Gt).sendCommand("Storage.getCookies",{browserContextId:w(this,ue,ei).call(this,t)})}catch(a){throw w(this,ue,no).call(this,a)?new Ya.NoSuchUserContextException(a.message):a}return{cookies:r.cookies.filter(a=>{var o;return t.sourceOrigin===void 0||((o=a.partitionKey)==null?void 0:o.topLevelSite)===t.sourceOrigin}).map(a=>(0,Vn.cdpToBiDiCookie)(a)).filter(a=>w(this,ue,Eu).call(this,a,e.filter)),partitionKey:t}}async setCookie(e){var n;const t=w(this,ue,io).call(this,e.partition),r=(0,Vn.bidiToCdpCookie)(e,t);try{await s(this,Gt).sendCommand("Storage.setCookies",{cookies:[r],browserContextId:w(this,ue,ei).call(this,t)})}catch(a){throw w(this,ue,no).call(this,a)?new Ya.NoSuchUserContextException(a.message):((n=s(this,zr))==null||n.call(this,Zd.LogType.debugError,a),new Ya.UnableToSetCookieException(a.toString()))}return{partitionKey:t}}}Gt=new WeakMap,_i=new WeakMap,zr=new WeakMap,ue=new WeakSet,no=function(e){var t;return(t=e.message)==null?void 0:t.startsWith("Failed to find browser context for id")},ei=function(e){return e.userContext==="default"?void 0:e.userContext},lh=function(e){const t=e.context;return{userContext:s(this,_i).getContext(t).userContext}},hh=function(e){var a;const t=new Map;let r=e.sourceOrigin;if(r!==void 0){const o=Ag.NetworkProcessor.parseUrlString(r);o.origin==="null"?r=o.origin:r=`${o.protocol}//${o.hostname}`}for(const[o,c]of Object.entries(e))o!==void 0&&c!==void 0&&!["type","sourceOrigin","userContext"].includes(o)&&t.set(o,c);return t.size>0&&((a=s(this,zr))==null||a.call(this,Zd.LogType.debugInfo,`Unsupported partition keys: ${JSON.stringify(Object.fromEntries(t))}`)),{userContext:e.userContext??"default",...r===void 0?{}:{sourceOrigin:r}}},io=function(e){return e===void 0?{userContext:"default"}:e.type==="context"?w(this,ue,lh).call(this,e):((0,Bg.assert)(e.type==="storageKey","Unknown partition type"),w(this,ue,hh).call(this,e))},Eu=function(e,t){return t===void 0?!0:(t.domain===void 0||t.domain===e.domain)&&(t.name===void 0||t.name===e.name)&&(t.value===void 0||(0,Vn.deserializeByteValue)(t.value)===(0,Vn.deserializeByteValue)(e.value))&&(t.path===void 0||t.path===e.path)&&(t.size===void 0||t.size===e.size)&&(t.httpOnly===void 0||t.httpOnly===e.httpOnly)&&(t.secure===void 0||t.secure===e.secure)&&(t.sameSite===void 0||t.sameSite===e.sameSite)&&(t.expiry===void 0||t.expiry===e.expiry)};Nc.StorageProcessor=$g;var qn={};Object.defineProperty(qn,"__esModule",{value:!0});qn.OutgoingMessage=void 0;var ki,Ii;const qo=class qo{constructor(e,t=null){u(this,ki);u(this,Ii);f(this,ki,e),f(this,Ii,t)}static createFromPromise(e,t){return e.then(r=>r.kind==="success"?{kind:"success",value:new qo(r.value,t)}:r)}static createResolved(e,t){return Promise.resolve({kind:"success",value:new qo(e,t)})}get message(){return s(this,ki)}get channel(){return s(this,Ii)}};ki=new WeakMap,Ii=new WeakMap;let Su=qo;qn.OutgoingMessage=Su;Object.defineProperty(fc,"__esModule",{value:!0});fc.CommandProcessor=void 0;const ys=Z,Lg=qt,qg=Te,Ug=mc,Hg=gc,Kg=wc,zg=yc,Wg=vc,Vg=La,Gg=_c,Xg=kc,Jg=Tc,Yg=Nc,ru=qn;var Xt,It,Ee,at,Ms,$e,Ti,ot,Jt,Fs,$,Ni,fs,ph,ao;class Qg extends Lg.EventEmitter{constructor(t,r,n,a,o,c,h,d,l=new Ug.BidiNoOpParser,p,m){super();u(this,fs);u(this,Xt);u(this,It);u(this,Ee);u(this,at);u(this,Ms);u(this,$e);u(this,Ti);u(this,ot);u(this,Jt);u(this,Fs);u(this,$);u(this,Ni);f(this,$,l),f(this,Ni,m),f(this,Xt,d),f(this,It,new Hg.BrowserProcessor(r,a)),f(this,Ee,new zg.BrowsingContextProcessor(r,a,n)),f(this,at,new Kg.CdpProcessor(a,o,t,r)),f(this,Ms,new Wg.InputProcessor(a)),f(this,$e,new Vg.NetworkProcessor(a,h)),f(this,Ti,new Gg.PermissionsProcessor(r)),f(this,ot,new Xg.ScriptProcessor(n,a,o,c,m)),f(this,Jt,new Jg.SessionProcessor(n,r,p)),f(this,Fs,new Yg.StorageProcessor(r,a,m))}async processCommand(t){var r;try{const n=await w(this,fs,ph).call(this,t),a={type:"success",id:t.id,result:n};this.emit("response",{message:ru.OutgoingMessage.createResolved(a,t.channel),event:t.method})}catch(n){if(n instanceof ys.Exception)this.emit("response",{message:ru.OutgoingMessage.createResolved(n.toErrorResponse(t.id),t.channel),event:t.method});else{const a=n;(r=s(this,Ni))==null||r.call(this,qg.LogType.bidi,a),this.emit("response",{message:ru.OutgoingMessage.createResolved(new ys.UnknownErrorException(a.message,a.stack).toErrorResponse(t.id),t.channel),event:t.method})}}}}Xt=new WeakMap,It=new WeakMap,Ee=new WeakMap,at=new WeakMap,Ms=new WeakMap,$e=new WeakMap,Ti=new WeakMap,ot=new WeakMap,Jt=new WeakMap,Fs=new WeakMap,$=new WeakMap,Ni=new WeakMap,fs=new WeakSet,ph=async function(t){switch(t.method){case"bluetooth.handleRequestDevicePrompt":return await s(this,Xt).handleRequestDevicePrompt(s(this,$).parseHandleRequestDevicePromptParams(t.params));case"bluetooth.simulateAdapter":return await s(this,Xt).simulateAdapter(s(this,$).parseSimulateAdapterParameters(t.params));case"bluetooth.simulateAdvertisement":return await s(this,Xt).simulateAdvertisement(s(this,$).parseSimulateAdvertisementParameters(t.params));case"bluetooth.simulatePreconnectedPeripheral":return await s(this,Xt).simulatePreconnectedPeripheral(s(this,$).parseSimulatePreconnectedPeripheralParameters(t.params));case"browser.close":return s(this,It).close();case"browser.createUserContext":return await s(this,It).createUserContext(t.params);case"browser.getClientWindows":return await s(this,It).getClientWindows();case"browser.getUserContexts":return await s(this,It).getUserContexts();case"browser.removeUserContext":return await s(this,It).removeUserContext(s(this,$).parseRemoveUserContextParams(t.params));case"browser.setClientWindowState":throw new ys.UnknownErrorException(`Method ${t.method} is not implemented.`);case"browsingContext.activate":return await s(this,Ee).activate(s(this,$).parseActivateParams(t.params));case"browsingContext.captureScreenshot":return await s(this,Ee).captureScreenshot(s(this,$).parseCaptureScreenshotParams(t.params));case"browsingContext.close":return await s(this,Ee).close(s(this,$).parseCloseParams(t.params));case"browsingContext.create":return await s(this,Ee).create(s(this,$).parseCreateParams(t.params));case"browsingContext.getTree":return s(this,Ee).getTree(s(this,$).parseGetTreeParams(t.params));case"browsingContext.handleUserPrompt":return await s(this,Ee).handleUserPrompt(s(this,$).parseHandleUserPromptParams(t.params));case"browsingContext.locateNodes":return await s(this,Ee).locateNodes(s(this,$).parseLocateNodesParams(t.params));case"browsingContext.navigate":return await s(this,Ee).navigate(s(this,$).parseNavigateParams(t.params));case"browsingContext.print":return await s(this,Ee).print(s(this,$).parsePrintParams(t.params));case"browsingContext.reload":return await s(this,Ee).reload(s(this,$).parseReloadParams(t.params));case"browsingContext.setViewport":return await s(this,Ee).setViewport(s(this,$).parseSetViewportParams(t.params));case"browsingContext.traverseHistory":return await s(this,Ee).traverseHistory(s(this,$).parseTraverseHistoryParams(t.params));case"goog:cdp.getSession":return s(this,at).getSession(s(this,$).parseGetSessionParams(t.params));case"goog:cdp.resolveRealm":return s(this,at).resolveRealm(s(this,$).parseResolveRealmParams(t.params));case"goog:cdp.sendCommand":return await s(this,at).sendCommand(s(this,$).parseSendCommandParams(t.params));case"cdp.getSession":return s(this,at).getSession(s(this,$).parseGetSessionParams(t.params));case"cdp.resolveRealm":return s(this,at).resolveRealm(s(this,$).parseResolveRealmParams(t.params));case"cdp.sendCommand":return await s(this,at).sendCommand(s(this,$).parseSendCommandParams(t.params));case"input.performActions":return await s(this,Ms).performActions(s(this,$).parsePerformActionsParams(t.params));case"input.releaseActions":return await s(this,Ms).releaseActions(s(this,$).parseReleaseActionsParams(t.params));case"input.setFiles":return await s(this,Ms).setFiles(s(this,$).parseSetFilesParams(t.params));case"network.addIntercept":return await s(this,$e).addIntercept(s(this,$).parseAddInterceptParams(t.params));case"network.continueRequest":return await s(this,$e).continueRequest(s(this,$).parseContinueRequestParams(t.params));case"network.continueResponse":return await s(this,$e).continueResponse(s(this,$).parseContinueResponseParams(t.params));case"network.continueWithAuth":return await s(this,$e).continueWithAuth(s(this,$).parseContinueWithAuthParams(t.params));case"network.failRequest":return await s(this,$e).failRequest(s(this,$).parseFailRequestParams(t.params));case"network.provideResponse":return await s(this,$e).provideResponse(s(this,$).parseProvideResponseParams(t.params));case"network.removeIntercept":return await s(this,$e).removeIntercept(s(this,$).parseRemoveInterceptParams(t.params));case"network.setCacheBehavior":return await s(this,$e).setCacheBehavior(s(this,$).parseSetCacheBehavior(t.params));case"permissions.setPermission":return await s(this,Ti).setPermissions(s(this,$).parseSetPermissionsParams(t.params));case"script.addPreloadScript":return await s(this,ot).addPreloadScript(s(this,$).parseAddPreloadScriptParams(t.params));case"script.callFunction":return await s(this,ot).callFunction(s(this,$).parseCallFunctionParams(w(this,fs,ao).call(this,t.params)));case"script.disown":return await s(this,ot).disown(s(this,$).parseDisownParams(w(this,fs,ao).call(this,t.params)));case"script.evaluate":return await s(this,ot).evaluate(s(this,$).parseEvaluateParams(w(this,fs,ao).call(this,t.params)));case"script.getRealms":return s(this,ot).getRealms(s(this,$).parseGetRealmsParams(t.params));case"script.removePreloadScript":return await s(this,ot).removePreloadScript(s(this,$).parseRemovePreloadScriptParams(t.params));case"session.end":throw new ys.UnknownErrorException(`Method ${t.method} is not implemented.`);case"session.new":return await s(this,Jt).new(t.params);case"session.status":return s(this,Jt).status();case"session.subscribe":return await s(this,Jt).subscribe(s(this,$).parseSubscribeParams(t.params),t.channel);case"session.unsubscribe":return await s(this,Jt).unsubscribe(s(this,$).parseSubscribeParams(t.params),t.channel);case"storage.deleteCookies":return await s(this,Fs).deleteCookies(s(this,$).parseDeleteCookiesParams(t.params));case"storage.getCookies":return await s(this,Fs).getCookies(s(this,$).parseGetCookiesParams(t.params));case"storage.setCookie":return await s(this,Fs).setCookie(s(this,$).parseSetCookieParams(t.params));case"webExtension.install":throw new ys.UnknownErrorException(`Method ${t.method} is not implemented.`);case"webExtension.uninstall":throw new ys.UnknownErrorException(`Method ${t.method} is not implemented.`)}throw new ys.UnknownCommandException(`Unknown command '${t==null?void 0:t.method}'.`)},ao=function(t){return typeof t=="object"&&t&&"target"in t&&typeof t.target=="object"&&t.target&&"context"in t.target&&delete t.target.realm,t};fc.CommandProcessor=Qg;var Dc={};Object.defineProperty(Dc,"__esModule",{value:!0});Dc.BluetoothProcessor=void 0;var Di,Yt;class Zg{constructor(e,t){u(this,Di);u(this,Yt);f(this,Di,e),f(this,Yt,t)}async simulateAdapter(e){const t=s(this,Yt).getContext(e.context);return await t.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.disable"),await t.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.enable",{state:e.state}),{}}async simulatePreconnectedPeripheral(e){return await s(this,Yt).getContext(e.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulatePreconnectedPeripheral",{address:e.address,name:e.name,knownServiceUuids:e.knownServiceUuids,manufacturerData:e.manufacturerData}),{}}async simulateAdvertisement(e){return await s(this,Yt).getContext(e.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulateAdvertisement",{entry:e.scanEntry}),{}}onCdpTargetCreated(e){e.cdpClient.on("DeviceAccess.deviceRequestPrompted",t=>{s(this,Di).registerEvent({type:"event",method:"bluetooth.requestDevicePromptUpdated",params:{context:e.id,prompt:t.id,devices:t.devices}},e.id)})}async handleRequestDevicePrompt(e){const t=s(this,Yt).getContext(e.context);return e.accept?await t.cdpTarget.cdpClient.sendCommand("DeviceAccess.selectPrompt",{id:e.prompt,deviceId:e.device}):await t.cdpTarget.cdpClient.sendCommand("DeviceAccess.cancelPrompt",{id:e.prompt}),{}}}Di=new WeakMap,Yt=new WeakMap;Dc.BluetoothProcessor=Zg;var Rc={},Un={},lr={};Object.defineProperty(lr,"__esModule",{value:!0});lr.Deferred=void 0;var Il,Tt,Qt,Ri,Oi,Mi;Il=Symbol.toStringTag;class ew{constructor(){u(this,Tt,!1);u(this,Qt);u(this,Ri);u(this,Oi);u(this,Mi);F(this,Il,"Promise");f(this,Qt,new Promise((e,t)=>{f(this,Oi,e),f(this,Mi,t)})),s(this,Qt).catch(e=>{})}get isFinished(){return s(this,Tt)}get result(){if(!s(this,Tt))throw new Error("Deferred is not finished yet");return s(this,Ri)}then(e,t){return s(this,Qt).then(e,t)}catch(e){return s(this,Qt).catch(e)}resolve(e){f(this,Ri,e),s(this,Tt)||(f(this,Tt,!0),s(this,Oi).call(this,e))}reject(e){s(this,Tt)||(f(this,Tt,!0),s(this,Mi).call(this,e))}finally(e){return s(this,Qt).finally(e)}}Tt=new WeakMap,Qt=new WeakMap,Ri=new WeakMap,Oi=new WeakMap,Mi=new WeakMap;lr.Deferred=ew;var Oc={};Object.defineProperty(Oc,"__esModule",{value:!0});Oc.getTimestamp=tw;function tw(){return new Date().getTime()}var yd={};Object.defineProperty(yd,"__esModule",{value:!0});yd.inchesFromCm=sw;function sw(i){return i/2.54}var Ua={},Ha={};Object.defineProperty(Ha,"__esModule",{value:!0});Ha.Realm=void 0;const Qa=Z,rw=Te,nw=dr,iw=qa;var Fi,js,ji,Wr,Bi,Ai,Zt,ve,Pu,Qe,Je,fh,_u,ku,mh,Iu,Tu,gh,wh,Nu;let aw=(Je=class{constructor(e,t,r,n,a,o,c){u(this,ve);u(this,Fi);u(this,js);u(this,ji);u(this,Wr);u(this,Bi);u(this,Ai);u(this,Zt);f(this,Fi,e),f(this,js,t),f(this,ji,r),f(this,Wr,n),f(this,Bi,a),f(this,Ai,o),f(this,Zt,c),s(this,Zt).addRealm(this)}cdpToBidiValue(e,t){const r=this.serializeForBiDi(e.result.deepSerializedValue,new Map);if(e.result.objectId){const n=e.result.objectId;t==="root"?(r.handle=n,s(this,Zt).knownHandlesToRealmMap.set(n,this.realmId)):w(this,ve,Nu).call(this,n).catch(a=>{var o;return(o=s(this,Wr))==null?void 0:o.call(this,rw.LogType.debugError,a)})}return r}serializeForBiDi(e,t){if(Object.hasOwn(e,"weakLocalObjectReference")){const n=e.weakLocalObjectReference;t.has(n)||t.set(n,(0,nw.uuidv4)()),e.internalId=t.get(n),delete e.weakLocalObjectReference}if(e.type==="node"&&Object.hasOwn(e==null?void 0:e.value,"frameId")&&delete e.value.frameId,e.type==="platformobject")return{type:"object"};const r=e.value;if(r===void 0)return e;if(["array","set","htmlcollection","nodelist"].includes(e.type))for(const n in r)r[n]=this.serializeForBiDi(r[n],t);if(["object","map"].includes(e.type))for(const n in r)r[n]=[this.serializeForBiDi(r[n][0],t),this.serializeForBiDi(r[n][1],t)];return e}get realmId(){return s(this,Ai)}get executionContextId(){return s(this,ji)}get origin(){return s(this,Bi)}get source(){return{realm:this.realmId}}get cdpClient(){return s(this,Fi)}get baseInfo(){return{realm:this.realmId,origin:this.origin}}async evaluate(e,t,r="none",n={},a=!1,o=!1){var h;const c=await this.cdpClient.sendCommand("Runtime.evaluate",{contextId:this.executionContextId,expression:e,awaitPromise:t,serializationOptions:w(h=Je,Qe,Tu).call(h,"deep",n),userGesture:a,includeCommandLineAPI:o});return c.exceptionDetails?await w(this,ve,Iu).call(this,c.exceptionDetails,0,r):{realm:this.realmId,result:this.cdpToBidiValue(c,r),type:"success"}}initialize(){w(this,ve,Pu).call(this,{type:"event",method:Qa.ChromiumBidi.Script.EventNames.RealmCreated,params:this.realmInfo})}async serializeCdpObject(e,t){var a;const r=w(a=Je,Qe,fh).call(a,e),n=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(o=>o),awaitPromise:!1,arguments:[r],serializationOptions:{serialization:"deep"},executionContextId:this.executionContextId});return this.cdpToBidiValue(n,t)}async stringifyObject(e){const{result:t}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(r=>String(r)),awaitPromise:!1,arguments:[e],returnByValue:!0,executionContextId:this.executionContextId});return t.value}async callFunction(e,t,r={type:"undefined"},n=[],a="none",o={},c=!1){var p;const h=`(...args) => {
      function callFunction(f, args) {
        const deserializedThis = args.shift();
        const deserializedArgs = args;
        return f.apply(deserializedThis, deserializedArgs);
      }
      return callFunction((
        ${e}
      ), args);
    }`,d=[await this.deserializeForCdp(r),...await Promise.all(n.map(async m=>await this.deserializeForCdp(m)))];let l;try{l=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:h,awaitPromise:t,arguments:d,serializationOptions:w(p=Je,Qe,Tu).call(p,"deep",o),executionContextId:this.executionContextId,userGesture:c})}catch(m){throw m.code===-32e3&&["Could not find object with given id","Argument should belong to the same JavaScript world as target object","Invalid remote object id"].includes(m.message)?new Qa.NoSuchHandleException("Handle was not found."):m}return l.exceptionDetails?await w(this,ve,Iu).call(this,l.exceptionDetails,1,a):{type:"success",result:this.cdpToBidiValue(l,a),realm:this.realmId}}async deserializeForCdp(e){if("handle"in e&&e.handle)return{objectId:e.handle};if("handle"in e||"sharedId"in e)throw new Qa.NoSuchHandleException("Handle was not found.");switch(e.type){case"undefined":return{unserializableValue:"undefined"};case"null":return{unserializableValue:"null"};case"string":return{value:e.value};case"number":return e.value==="NaN"?{unserializableValue:"NaN"}:e.value==="-0"?{unserializableValue:"-0"}:e.value==="Infinity"?{unserializableValue:"Infinity"}:e.value==="-Infinity"?{unserializableValue:"-Infinity"}:{value:e.value};case"boolean":return{value:!!e.value};case"bigint":return{unserializableValue:`BigInt(${JSON.stringify(e.value)})`};case"date":return{unserializableValue:`new Date(Date.parse(${JSON.stringify(e.value)}))`};case"regexp":return{unserializableValue:`new RegExp(${JSON.stringify(e.value.pattern)}, ${JSON.stringify(e.value.flags)})`};case"map":{const t=await w(this,ve,_u).call(this,e.value),{result:r}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...n)=>{const a=new Map;for(let o=0;o<n.length;o+=2)a.set(n[o],n[o+1]);return a}),awaitPromise:!1,arguments:t,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:r.objectId}}case"object":{const t=await w(this,ve,_u).call(this,e.value),{result:r}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...n)=>{const a={};for(let o=0;o<n.length;o+=2){const c=n[o];a[c]=n[o+1]}return a}),awaitPromise:!1,arguments:t,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:r.objectId}}case"array":{const t=await w(this,ve,ku).call(this,e.value),{result:r}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...n)=>n),awaitPromise:!1,arguments:t,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:r.objectId}}case"set":{const t=await w(this,ve,ku).call(this,e.value),{result:r}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...n)=>new Set(n)),awaitPromise:!1,arguments:t,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:r.objectId}}case"channel":return{objectId:await new iw.ChannelProxy(e.value,s(this,Wr)).init(this,s(this,js))}}throw new Error(`Value ${JSON.stringify(e)} is not deserializable.`)}async disown(e){s(this,Zt).knownHandlesToRealmMap.get(e)===this.realmId&&(await w(this,ve,Nu).call(this,e),s(this,Zt).knownHandlesToRealmMap.delete(e))}dispose(){w(this,ve,Pu).call(this,{type:"event",method:Qa.ChromiumBidi.Script.EventNames.RealmDestroyed,params:{realm:this.realmId}})}},Fi=new WeakMap,js=new WeakMap,ji=new WeakMap,Wr=new WeakMap,Bi=new WeakMap,Ai=new WeakMap,Zt=new WeakMap,ve=new WeakSet,Pu=function(e){if(this.associatedBrowsingContexts.length===0)s(this,js).registerEvent(e,null);else for(const t of this.associatedBrowsingContexts)s(this,js).registerEvent(e,t.id)},Qe=new WeakSet,fh=function(e){return e.objectId!==void 0?{objectId:e.objectId}:e.unserializableValue!==void 0?{unserializableValue:e.unserializableValue}:{value:e.value}},_u=async function(e){return(await Promise.all(e.map(async([r,n])=>{let a;typeof r=="string"?a={value:r}:a=await this.deserializeForCdp(r);const o=await this.deserializeForCdp(n);return[a,o]}))).flat()},ku=async function(e){return await Promise.all(e.map(t=>this.deserializeForCdp(t)))},mh=async function(e,t,r){var o;const n=((o=e.stackTrace)==null?void 0:o.callFrames.map(c=>({url:c.url,functionName:c.functionName,lineNumber:c.lineNumber-t,columnNumber:c.columnNumber})))??[],a=e.exception;return{exception:await this.serializeCdpObject(a,r),columnNumber:e.columnNumber,lineNumber:e.lineNumber-t,stackTrace:{callFrames:n},text:await this.stringifyObject(a)||e.text}},Iu=async function(e,t,r){return{exceptionDetails:await w(this,ve,mh).call(this,e,t,r),realm:this.realmId,type:"exception"}},Tu=function(e,t){var r,n;return{serialization:e,additionalParameters:w(r=Je,Qe,gh).call(r,t),...w(n=Je,Qe,wh).call(n,t)}},gh=function(e){const t={};return e.maxDomDepth!==void 0&&(t.maxNodeDepth=e.maxDomDepth===null?1e3:e.maxDomDepth),e.includeShadowTree!==void 0&&(t.includeShadowTree=e.includeShadowTree),t},wh=function(e){return e.maxObjectDepth===void 0||e.maxObjectDepth===null?{}:{maxDepth:e.maxObjectDepth}},Nu=async function(e){try{await this.cdpClient.sendCommand("Runtime.releaseObject",{objectId:e})}catch(t){if(!(t.code===-32e3&&t.message==="Invalid remote object id"))throw t}},u(Je,Qe),Je);Ha.Realm=aw;var Mc={};Object.defineProperty(Mc,"__esModule",{value:!0});Mc.getSharedId=cw;Mc.parseSharedId=dw;const ow="_element_";function cw(i,e,t){return`f.${i}.d.${e}.e.${t}`}function uw(i){const e=i.match(new RegExp(`(.*)${ow}(.*)`));if(!e)return null;const t=e[1],r=e[2];if(t===void 0||r===void 0)return null;const n=parseInt(r??"");return isNaN(n)?null:{documentId:t,backendNodeId:n}}function dw(i){const e=uw(i);if(e!==null)return{...e,frameId:void 0};const t=i.match(/f\.(.*)\.d\.(.*)\.e\.([0-9]*)/);if(!t)return null;const r=t[1],n=t[2],a=t[3];if(r===void 0||n===void 0||a===void 0)return null;const o=parseInt(a??"");return isNaN(o)?null:{frameId:r,documentId:n,backendNodeId:o}}Object.defineProperty(Ua,"__esModule",{value:!0});Ua.WindowRealm=void 0;const Za=Z,lw=Ha,el=Mc;var es,ts,Uo,yh,Tl;let hw=(Tl=class extends lw.Realm{constructor(t,r,n,a,o,c,h,d,l,p){super(n,a,o,c,h,d,l);u(this,Uo);u(this,es);u(this,ts);F(this,"sandbox");f(this,es,t),f(this,ts,r),this.sandbox=p,this.initialize()}get browsingContext(){return s(this,ts).getContext(s(this,es))}get associatedBrowsingContexts(){return[this.browsingContext]}get realmType(){return"window"}get realmInfo(){return{...this.baseInfo,type:this.realmType,context:s(this,es),sandbox:this.sandbox}}get source(){return{realm:this.realmId,context:this.browsingContext.id}}serializeForBiDi(t,r){const n=t.value;if(t.type==="node"&&n!==void 0){if(Object.hasOwn(n,"backendNodeId")){let a=this.browsingContext.navigableId??"UNKNOWN";Object.hasOwn(n,"loaderId")&&(a=n.loaderId,delete n.loaderId),t.sharedId=(0,el.getSharedId)(w(this,Uo,yh).call(this,a),a,n.backendNodeId),delete n.backendNodeId}if(Object.hasOwn(n,"children"))for(const a in n.children)n.children[a]=this.serializeForBiDi(n.children[a],r);Object.hasOwn(n,"shadowRoot")&&n.shadowRoot!==null&&(n.shadowRoot=this.serializeForBiDi(n.shadowRoot,r)),n.namespaceURI===""&&(n.namespaceURI=null)}return super.serializeForBiDi(t,r)}async deserializeForCdp(t){if("sharedId"in t&&t.sharedId){const r=(0,el.parseSharedId)(t.sharedId);if(r===null)throw new Za.NoSuchNodeException(`SharedId "${t.sharedId}" was not found.`);const{documentId:n,backendNodeId:a}=r;if(this.browsingContext.navigableId!==n)throw new Za.NoSuchNodeException(`SharedId "${t.sharedId}" belongs to different document. Current document is ${this.browsingContext.navigableId}.`);try{const{object:o}=await this.cdpClient.sendCommand("DOM.resolveNode",{backendNodeId:a,executionContextId:this.executionContextId});return{objectId:o.objectId}}catch(o){throw o.code===-32e3&&o.message==="No node with given id found"?new Za.NoSuchNodeException(`SharedId "${t.sharedId}" was not found.`):new Za.UnknownErrorException(o.message,o.stack)}}return await super.deserializeForCdp(t)}async evaluate(t,r,n,a,o,c){return await s(this,ts).getContext(s(this,es)).targetUnblockedOrThrow(),await super.evaluate(t,r,n,a,o,c)}async callFunction(t,r,n,a,o,c,h){return await s(this,ts).getContext(s(this,es)).targetUnblockedOrThrow(),await super.callFunction(t,r,n,a,o,c,h)}},es=new WeakMap,ts=new WeakMap,Uo=new WeakSet,yh=function(t){const r=s(this,ts).getAllContexts().find(n=>n.navigableId===t);return(r==null?void 0:r.id)??"UNKNOWN"},Tl);Ua.WindowRealm=hw;var jn={},vd={};Object.defineProperty(vd,"__esModule",{value:!0});vd.urlMatchesAboutBlank=pw;function pw(i){if(i==="")return!0;try{const e=new URL(i);return e.protocol.replace(/:$/,"").toLowerCase()==="about"&&e.pathname.toLowerCase()==="blank"&&e.username===""&&e.password===""&&e.host===""}catch(e){if(e instanceof TypeError)return!1;throw e}}Object.defineProperty(jn,"__esModule",{value:!0});jn.NavigationTracker=jn.NavigationResult=void 0;const fw=Z,vh=lr,We=Te,mw=Oc,tl=vd,gw=dr;class oo{constructor(e,t){F(this,"eventName");F(this,"message");this.eventName=e,this.message=t}}jn.NavigationResult=oo;var Bs,Vr,Gr,Xr,Jr,Yr,Qr,co;class nu{constructor(e,t,r,n){u(this,Qr);F(this,"navigationId",(0,gw.uuidv4)());u(this,Bs);u(this,Vr,!1);u(this,Gr,new vh.Deferred);F(this,"url");F(this,"loaderId");u(this,Xr);u(this,Jr);u(this,Yr,!1);f(this,Bs,t),this.url=e,f(this,Xr,r),f(this,Jr,n)}get finished(){return s(this,Gr)}navigationInfo(){return{context:s(this,Bs),navigation:this.navigationId,timestamp:(0,mw.getTimestamp)(),url:this.url}}start(){!s(this,Xr)&&!s(this,Vr)&&s(this,Jr).registerEvent({type:"event",method:fw.ChromiumBidi.BrowsingContext.EventNames.NavigationStarted,params:this.navigationInfo()},s(this,Bs)),f(this,Vr,!0)}frameNavigated(){f(this,Yr,!0)}fragmentNavigated(){f(this,Yr,!0),w(this,Qr,co).call(this,new oo("browsingContext.fragmentNavigated"))}load(){w(this,Qr,co).call(this,new oo("browsingContext.load"))}fail(e){w(this,Qr,co).call(this,new oo(s(this,Yr)?"browsingContext.navigationAborted":"browsingContext.navigationFailed",e))}}Bs=new WeakMap,Vr=new WeakMap,Gr=new WeakMap,Xr=new WeakMap,Jr=new WeakMap,Yr=new WeakMap,Qr=new WeakSet,co=function(e){f(this,Vr,!0),!s(this,Xr)&&!s(this,Gr).isFinished&&e.eventName!=="browsingContext.load"&&s(this,Jr).registerEvent({type:"event",method:e.eventName,params:this.navigationInfo()},s(this,Bs)),s(this,Gr).resolve(e)};var As,Pe,Le,Zr,_e,ae,Nt,Ho,bh;class ww{constructor(e,t,r,n){u(this,Ho);u(this,As);u(this,Pe);u(this,Le,new Map);u(this,Zr);u(this,_e);u(this,ae);u(this,Nt,!0);F(this,"navigation",{withinDocument:new vh.Deferred});f(this,Zr,t),f(this,As,r),f(this,Pe,n),f(this,Nt,!0),f(this,_e,new nu(e,t,(0,tl.urlMatchesAboutBlank)(e),s(this,As)))}get currentNavigationId(){var e;return((e=s(this,ae))==null?void 0:e.loaderId)!==void 0?s(this,ae).navigationId:s(this,_e).navigationId}get isInitialNavigation(){return s(this,Nt)}get url(){return s(this,_e).url}createPendingNavigation(e,t=!1){var n,a;(n=s(this,Pe))==null||n.call(this,We.LogType.debug,"createCommandNavigation"),f(this,Nt,t&&s(this,Nt)&&(0,tl.urlMatchesAboutBlank)(e)),(a=s(this,ae))==null||a.fail("navigation canceled by concurrent navigation");const r=new nu(e,s(this,Zr),s(this,Nt),s(this,As));return f(this,ae,r),r}dispose(){var e;(e=s(this,ae))==null||e.fail("navigation canceled by context disposal"),s(this,_e).fail("navigation canceled by context disposal")}onTargetInfoChanged(e){var t;(t=s(this,Pe))==null||t.call(this,We.LogType.debug,`onTargetInfoChanged ${e}`),s(this,_e).url=e}frameNavigated(e,t,r){var a;if((a=s(this,Pe))==null||a.call(this,We.LogType.debug,`frameNavigated ${e}`),r!==void 0&&!s(this,Le).has(t)){const o=s(this,ae)??this.createPendingNavigation(r,!0);o.url=r,o.start(),o.fail("the requested url is unreachable");return}const n=w(this,Ho,bh).call(this,e,t);n.frameNavigated(),n!==s(this,_e)&&s(this,_e).fail("navigation canceled by concurrent navigation"),n.url=e,n.loaderId=t,s(this,Le).set(t,n),n.start(),f(this,_e,n),s(this,ae)===n&&f(this,ae,void 0)}navigatedWithinDocument(e,t){var n;if((n=s(this,Pe))==null||n.call(this,We.LogType.debug,`navigatedWithinDocument ${e}, ${t}`),s(this,_e).url=e,t!=="fragment")return;const r=s(this,ae)!==void 0&&s(this,ae).loaderId===void 0?s(this,ae):new nu(e,s(this,Zr),!1,s(this,As));r.fragmentNavigated(),r===s(this,ae)&&f(this,ae,void 0)}frameRequestedNavigation(e){var t;(t=s(this,Pe))==null||t.call(this,We.LogType.debug,`Page.frameRequestedNavigation ${e}`),this.createPendingNavigation(e,!0)}loadPageEvent(e){var t,r;(t=s(this,Pe))==null||t.call(this,We.LogType.debug,"loadPageEvent"),f(this,Nt,!1),(r=s(this,Le).get(e))==null||r.load()}failNavigation(e,t){var r;(r=s(this,Pe))==null||r.call(this,We.LogType.debug,"failCommandNavigation"),e.fail(t)}navigationCommandFinished(e,t){var r;(r=s(this,Pe))==null||r.call(this,We.LogType.debug,`finishCommandNavigation ${e.navigationId}, ${t}`),t!==void 0&&(e.loaderId=t,s(this,Le).set(t,e)),!(t===void 0||s(this,_e)===e)&&(s(this,_e).fail("navigation canceled by concurrent navigation"),e.start(),f(this,_e,e),s(this,ae)===e&&f(this,ae,void 0))}frameStartedNavigating(e,t){var n;if((n=s(this,Pe))==null||n.call(this,We.LogType.debug,`frameStartedNavigating ${e}, ${t}`),s(this,Le).has(t))return;const r=s(this,ae)??this.createPendingNavigation(e,!0);r.url=e,r.start(),r.loaderId=t,s(this,Le).set(t,r)}beforeunload(){var e,t;if((e=s(this,Pe))==null||e.call(this,We.LogType.debug,"beforeunload"),s(this,ae)===void 0){(t=s(this,Pe))==null||t.call(this,We.LogType.debugError,"Unexpectedly no pending navigation on beforeunload");return}s(this,ae).start()}networkLoadingFailed(e,t){var r;(r=s(this,Le).get(e))==null||r.fail(t)}}As=new WeakMap,Pe=new WeakMap,Le=new WeakMap,Zr=new WeakMap,_e=new WeakMap,ae=new WeakMap,Nt=new WeakMap,Ho=new WeakSet,bh=function(e,t){var r;return s(this,Le).has(t)?s(this,Le).get(t):s(this,ae)!==void 0&&((r=s(this,ae))==null?void 0:r.loaderId)===void 0?s(this,ae):this.createPendingNavigation(e,!0)};jn.NavigationTracker=ww;var Er;Object.defineProperty(Un,"__esModule",{value:!0});Un.BrowsingContextImpl=void 0;Un.serializeOrigin=kh;const G=Z,Gn=Ut,vs=lr,Xn=Te,sl=Oc,gr=yd,yw=Ua,iu=jn;var en,tn,ct,Dt,$s,$i,Se,H,ke,ss,Fe,qe,Q,ut,Ue,Ls,J,uo,Du,Ko,Ch,xh,lo,Ru,Eh,Ou,Sh,Ph,_h;class _o{constructor(e,t,r,n,a,o,c,h,d,l,p){u(this,J);u(this,en,new Set);u(this,tn);F(this,"userContext");u(this,ct);u(this,Dt,null);u(this,$s,{width:0,height:0});u(this,$i);u(this,Se,{DOMContentLoaded:new vs.Deferred,load:new vs.Deferred});u(this,H);u(this,ke,new vs.Deferred);u(this,ss);u(this,Fe);u(this,qe);u(this,Q);u(this,ut);u(this,Ue);u(this,Ls);f(this,H,n),f(this,tn,e),f(this,Dt,t),this.userContext=r,f(this,Fe,a),f(this,ss,o),f(this,ut,c),f(this,Ue,l),f(this,qe,p),f(this,$i,d),f(this,Q,new iu.NavigationTracker(h,e,a,p))}static create(e,t,r,n,a,o,c,h,d,l,p){var b;const m=new Er(e,t,r,n,a,o,c,h,d,l,p);return w(b=m,J,Du).call(b),o.addContext(m),m.isTopLevelContext()||m.parent.addChild(m.id),a.registerPromiseEvent(m.targetUnblockedOrThrow().then(()=>({kind:"success",value:{type:"event",method:G.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,params:{...m.serializeToBidiValue(),url:h}}}),x=>({kind:"error",error:x})),m.id,G.ChromiumBidi.BrowsingContext.EventNames.ContextCreated),m}get navigableId(){return s(this,ct)}get navigationId(){return s(this,Q).currentNavigationId}dispose(e){s(this,Q).dispose(),w(this,J,uo).call(this),s(this,ut).deleteRealms({browsingContextId:this.id}),this.isTopLevelContext()||s(this.parent,en).delete(this.id),w(this,J,Eh).call(this),e&&s(this,Fe).registerEvent({type:"event",method:G.ChromiumBidi.BrowsingContext.EventNames.ContextDestroyed,params:this.serializeToBidiValue()},this.id),s(this,Fe).clearBufferedEvents(this.id),s(this,ss).deleteContextById(this.id)}get id(){return s(this,tn)}get parentId(){return s(this,Dt)}set parentId(e){var t;if(s(this,Dt)!==null){(t=s(this,qe))==null||t.call(this,Xn.LogType.debugError,"Parent context already set");return}f(this,Dt,e),this.isTopLevelContext()||this.parent.addChild(this.id)}get parent(){return this.parentId===null?null:s(this,ss).getContext(this.parentId)}get directChildren(){return[...s(this,en)].map(e=>s(this,ss).getContext(e))}get allChildren(){const e=this.directChildren;return e.concat(...e.map(t=>t.allChildren))}isTopLevelContext(){return s(this,Dt)===null}get top(){let e=this,t=e.parent;for(;t;)e=t,t=e.parent;return e}addChild(e){s(this,en).add(e)}get cdpTarget(){return s(this,H)}updateCdpTarget(e){f(this,H,e),w(this,J,Du).call(this)}get url(){return s(this,Q).url}async lifecycleLoaded(){await s(this,Se).load}async targetUnblockedOrThrow(){const e=await s(this,H).unblocked;if(e.kind==="error")throw e.error}async getOrCreateSandbox(e){if(e===void 0||e==="")return await s(this,ke);let t=s(this,ut).findRealms({browsingContextId:this.id,sandbox:e});return t.length===0&&(await s(this,H).cdpClient.sendCommand("Page.createIsolatedWorld",{frameId:this.id,worldName:e}),t=s(this,ut).findRealms({browsingContextId:this.id,sandbox:e}),(0,Gn.assert)(t.length!==0)),t[0]}serializeToBidiValue(e=0,t=!0){return{context:s(this,tn),url:this.url,userContext:this.userContext,originalOpener:s(this,$i)??null,clientWindow:"",children:e>0?this.directChildren.map(r=>r.serializeToBidiValue(e-1,!1)):null,...t?{parent:s(this,Dt)}:{}}}onTargetInfoChanged(e){s(this,Q).onTargetInfoChanged(e.targetInfo.url)}async navigate(e,t){try{new URL(e)}catch{throw new G.InvalidArgumentException(`Invalid URL: ${e}`)}const r=s(this,Q).createPendingNavigation(e),n=(async()=>{const o=await s(this,H).cdpClient.sendCommand("Page.navigate",{url:e,frameId:this.id});if(o.errorText)throw s(this,Q).failNavigation(r,o.errorText),new G.UnknownErrorException(o.errorText);s(this,Q).navigationCommandFinished(r,o.loaderId),w(this,J,lo).call(this,o.loaderId)})();if(t==="none")return{navigation:r.navigationId,url:e};const a=await Promise.race([w(this,J,Ou).call(this,t,n),r.finished]);if(a instanceof iu.NavigationResult&&(a.eventName==="browsingContext.navigationAborted"||a.eventName==="browsingContext.navigationFailed"))throw new G.UnknownErrorException(a.message??"unknown exception");return{navigation:r.navigationId,url:r.url}}async reload(e,t){await this.targetUnblockedOrThrow(),w(this,J,Ru).call(this);const r=s(this,Q).createPendingNavigation(s(this,Q).url),n=s(this,H).cdpClient.sendCommand("Page.reload",{ignoreCache:e}),a=await Promise.race([w(this,J,Ou).call(this,t,n),r.finished]);if(a instanceof iu.NavigationResult&&(a.eventName==="browsingContext.navigationAborted"||a.eventName==="browsingContext.navigationFailed"))throw new G.UnknownErrorException(a.message??"unknown exception");return{navigation:r.navigationId,url:r.url}}async setViewport(e,t){if(e===null&&t===null)await s(this,H).cdpClient.sendCommand("Emulation.clearDeviceMetricsOverride");else try{let r;e===void 0?r=s(this,$s):e===null?r={width:0,height:0}:r=e,f(this,$s,r),await s(this,H).cdpClient.sendCommand("Emulation.setDeviceMetricsOverride",{width:s(this,$s).width,height:s(this,$s).height,deviceScaleFactor:t||0,mobile:!1,dontSetVisibleSize:!0})}catch(r){throw r.message.startsWith("Width and height values must be positive")?new G.UnsupportedOperationException("Provided viewport dimensions are not supported"):r}}async handleUserPrompt(e,t){await s(this,H).cdpClient.sendCommand("Page.handleJavaScriptDialog",{accept:e??!0,promptText:t})}async activate(){await s(this,H).cdpClient.sendCommand("Page.bringToFront")}async captureScreenshot(e){if(!this.isTopLevelContext())throw new G.UnsupportedOperationException(`Non-top-level 'context' (${e.context}) is currently not supported`);const t=vw(e);let r=!1,n;switch(e.origin??(e.origin="viewport"),e.origin){case"document":{n=String(()=>{const d=document.documentElement;return{x:0,y:0,width:d.scrollWidth,height:d.scrollHeight}}),r=!0;break}case"viewport":{n=String(()=>{const d=window.visualViewport;return{x:d.pageLeft,y:d.pageTop,width:d.width,height:d.height}});break}}const o=await(await this.getOrCreateSandbox(void 0)).callFunction(n,!1);(0,Gn.assert)(o.type==="success");const c=rl(o.result);(0,Gn.assert)(c);let h=c;if(e.clip){const d=e.clip;e.origin==="viewport"&&d.type==="box"&&(d.x+=c.x,d.y+=c.y),h=bw(await w(this,J,Sh).call(this,d),c)}if(h.width===0||h.height===0)throw new G.UnableToCaptureScreenException(`Unable to capture screenshot with zero dimensions: width=${h.width}, height=${h.height}`);return await s(this,H).cdpClient.sendCommand("Page.captureScreenshot",{clip:{...h,scale:1},...t,captureBeyondViewport:r})}async print(e){var r,n,a,o,c,h;if(!this.isTopLevelContext())throw new G.UnsupportedOperationException("Printing of non-top level contexts is not supported");const t={};if(e.background!==void 0&&(t.printBackground=e.background),((r=e.margin)==null?void 0:r.bottom)!==void 0&&(t.marginBottom=(0,gr.inchesFromCm)(e.margin.bottom)),((n=e.margin)==null?void 0:n.left)!==void 0&&(t.marginLeft=(0,gr.inchesFromCm)(e.margin.left)),((a=e.margin)==null?void 0:a.right)!==void 0&&(t.marginRight=(0,gr.inchesFromCm)(e.margin.right)),((o=e.margin)==null?void 0:o.top)!==void 0&&(t.marginTop=(0,gr.inchesFromCm)(e.margin.top)),e.orientation!==void 0&&(t.landscape=e.orientation==="landscape"),((c=e.page)==null?void 0:c.height)!==void 0&&(t.paperHeight=(0,gr.inchesFromCm)(e.page.height)),((h=e.page)==null?void 0:h.width)!==void 0&&(t.paperWidth=(0,gr.inchesFromCm)(e.page.width)),e.pageRanges!==void 0){for(const d of e.pageRanges){if(typeof d=="number")continue;const l=d.split("-");if(l.length<1||l.length>2)throw new G.InvalidArgumentException(`Invalid page range: ${d} is not a valid integer range.`);if(l.length===1){au(l[0]??"");continue}let p,m;const[b="",x=""]=l;if(b===""?p=1:p=au(b),x===""?m=Number.MAX_SAFE_INTEGER:m=au(x),p>m)throw new G.InvalidArgumentException(`Invalid page range: ${b} > ${x}`)}t.pageRanges=e.pageRanges.join(",")}e.scale!==void 0&&(t.scale=e.scale),e.shrinkToFit!==void 0&&(t.preferCSSPageSize=!e.shrinkToFit);try{return{data:(await s(this,H).cdpClient.sendCommand("Page.printToPDF",t)).data}}catch(d){throw d.message==="invalid print parameters: content area is empty"?new G.UnsupportedOperationException(d.message):d}}async close(){await s(this,H).cdpClient.sendCommand("Page.close")}async traverseHistory(e){if(e===0)return;const t=await s(this,H).cdpClient.sendCommand("Page.getNavigationHistory"),r=t.entries[t.currentIndex+e];if(!r)throw new G.NoSuchHistoryEntryException(`No history entry at delta ${e}`);await s(this,H).cdpClient.sendCommand("Page.navigateToHistoryEntry",{entryId:r.id})}async toggleModulesIfNeeded(){await Promise.all([s(this,H).toggleNetworkIfNeeded(),s(this,H).toggleDeviceAccessIfNeeded()])}async locateNodes(e){return await w(this,J,_h).call(this,await s(this,ke),e.locator,e.startNodes??[],e.maxNodeCount,e.serializationOptions)}}en=new WeakMap,tn=new WeakMap,ct=new WeakMap,Dt=new WeakMap,$s=new WeakMap,$i=new WeakMap,Se=new WeakMap,H=new WeakMap,ke=new WeakMap,ss=new WeakMap,Fe=new WeakMap,qe=new WeakMap,Q=new WeakMap,ut=new WeakMap,Ue=new WeakMap,Ls=new WeakMap,J=new WeakSet,uo=function(e=!1){this.directChildren.map(t=>t.dispose(e))},Du=function(){s(this,H).cdpClient.on("Network.loadingFailed",e=>{s(this,Q).networkLoadingFailed(e.requestId,e.errorText)}),s(this,H).cdpClient.on("Page.frameNavigated",e=>{this.id===e.frame.id&&(s(this,Q).frameNavigated(e.frame.url+(e.frame.urlFragment??""),e.frame.loaderId,e.frame.unreachableUrl),w(this,J,uo).call(this),w(this,J,lo).call(this,e.frame.loaderId))}),s(this,H).on("frameStartedNavigating",e=>{var r;(r=s(this,qe))==null||r.call(this,Xn.LogType.debugInfo,"Received frameStartedNavigating event",e),[this.id,...this.cdpTarget.id===this.id?[void 0]:[]].includes(e.frameId)&&s(this,Q).frameStartedNavigating(e.url,e.loaderId)}),s(this,H).cdpClient.on("Page.navigatedWithinDocument",e=>{if(this.id===e.frameId&&(s(this,Q).navigatedWithinDocument(e.url,e.navigationType),e.navigationType==="historyApi")){s(this,Fe).registerEvent({type:"event",method:"browsingContext.historyUpdated",params:{context:this.id,url:s(this,Q).url}},this.id);return}}),s(this,H).cdpClient.on("Page.frameRequestedNavigation",e=>{this.id===e.frameId&&s(this,Q).frameRequestedNavigation(e.url)}),s(this,H).cdpClient.on("Page.lifecycleEvent",e=>{if(this.id===e.frameId){if(e.name==="init"){w(this,J,lo).call(this,e.loaderId);return}if(e.name==="commit"){f(this,ct,e.loaderId);return}if(s(this,ct)||f(this,ct,e.loaderId),e.loaderId===s(this,ct))switch(e.name){case"DOMContentLoaded":s(this,Q).isInitialNavigation||s(this,Fe).registerEvent({type:"event",method:G.ChromiumBidi.BrowsingContext.EventNames.DomContentLoaded,params:{context:this.id,navigation:s(this,Q).currentNavigationId,timestamp:(0,sl.getTimestamp)(),url:s(this,Q).url}},this.id),s(this,Se).DOMContentLoaded.resolve();break;case"load":s(this,Q).isInitialNavigation||s(this,Fe).registerEvent({type:"event",method:G.ChromiumBidi.BrowsingContext.EventNames.Load,params:{context:this.id,navigation:s(this,Q).currentNavigationId,timestamp:(0,sl.getTimestamp)(),url:s(this,Q).url}},this.id),s(this,Q).loadPageEvent(e.loaderId),s(this,Se).load.resolve();break}}}),s(this,H).cdpClient.on("Runtime.executionContextCreated",e=>{var d;const{auxData:t,name:r,uniqueId:n,id:a}=e.context;if(!t||t.frameId!==this.id)return;let o,c;switch(t.type){case"isolated":c=r,s(this,ke).isFinished||(d=s(this,qe))==null||d.call(this,Xn.LogType.debugError,"Unexpectedly, isolated realm created before the default one"),o=s(this,ke).isFinished?s(this,ke).result.origin:"";break;case"default":o=kh(e.context.origin);break;default:return}const h=new yw.WindowRealm(this.id,s(this,ss),s(this,H).cdpClient,s(this,Fe),a,s(this,qe),o,n,s(this,ut),c);t.isDefault&&(s(this,ke).resolve(h),Promise.all(s(this,H).getChannels().map(l=>l.startListenerFromWindow(h,s(this,Fe)))))}),s(this,H).cdpClient.on("Runtime.executionContextDestroyed",e=>{s(this,ke).isFinished&&s(this,ke).result.executionContextId===e.executionContextId&&f(this,ke,new vs.Deferred),s(this,ut).deleteRealms({cdpSessionId:s(this,H).cdpSessionId,executionContextId:e.executionContextId})}),s(this,H).cdpClient.on("Runtime.executionContextsCleared",()=>{s(this,ke).isFinished||s(this,ke).reject(new G.UnknownErrorException("execution contexts cleared")),f(this,ke,new vs.Deferred),s(this,ut).deleteRealms({cdpSessionId:s(this,H).cdpSessionId})}),s(this,H).cdpClient.on("Page.javascriptDialogClosed",e=>{var r;const t=e.result;s(this,Ls)===void 0&&((r=s(this,qe))==null||r.call(this,Xn.LogType.debugError,"Unexpectedly no opening prompt event before closing one")),s(this,Fe).registerEvent({type:"event",method:G.ChromiumBidi.BrowsingContext.EventNames.UserPromptClosed,params:{context:this.id,accepted:t,type:s(this,Ls)??"UNKNOWN",userText:t&&e.userInput?e.userInput:void 0}},this.id),f(this,Ls,void 0)}),s(this,H).cdpClient.on("Page.javascriptDialogOpening",e=>{var n;const t=w(n=Er,Ko,Ch).call(n,e.type);e.type==="beforeunload"&&s(this,Q).beforeunload(),f(this,Ls,t);const r=w(this,J,xh).call(this,t);switch(s(this,Fe).registerEvent({type:"event",method:G.ChromiumBidi.BrowsingContext.EventNames.UserPromptOpened,params:{context:this.id,handler:r,type:t,message:e.message,...e.type==="prompt"?{defaultValue:e.defaultPrompt}:{}}},this.id),r){case"accept":this.handleUserPrompt(!0);break;case"dismiss":this.handleUserPrompt(!1);break}})},Ko=new WeakSet,Ch=function(e){switch(e){case"alert":return"alert";case"beforeunload":return"beforeunload";case"confirm":return"confirm";case"prompt":return"prompt"}},xh=function(e){var r,n,a,o,c,h,d,l;const t="dismiss";switch(e){case"alert":return((r=s(this,Ue))==null?void 0:r.alert)??((n=s(this,Ue))==null?void 0:n.default)??t;case"beforeunload":return((a=s(this,Ue))==null?void 0:a.beforeUnload)??((o=s(this,Ue))==null?void 0:o.default)??"accept";case"confirm":return((c=s(this,Ue))==null?void 0:c.confirm)??((h=s(this,Ue))==null?void 0:h.default)??t;case"prompt":return((d=s(this,Ue))==null?void 0:d.prompt)??((l=s(this,Ue))==null?void 0:l.default)??t}},lo=function(e){e===void 0||s(this,ct)===e||(w(this,J,Ru).call(this),f(this,ct,e),w(this,J,uo).call(this,!0))},Ru=function(){var e,t;s(this,Se).DOMContentLoaded.isFinished?s(this,Se).DOMContentLoaded=new vs.Deferred:(e=s(this,qe))==null||e.call(this,Er.LOGGER_PREFIX,"Document changed (DOMContentLoaded)"),s(this,Se).load.isFinished?s(this,Se).load=new vs.Deferred:(t=s(this,qe))==null||t.call(this,Er.LOGGER_PREFIX,"Document changed (load)")},Eh=function(){s(this,Se).DOMContentLoaded.isFinished||s(this,Se).DOMContentLoaded.reject(new G.UnknownErrorException("navigation canceled")),s(this,Se).load.isFinished||s(this,Se).load.reject(new G.UnknownErrorException("navigation canceled"))},Ou=async function(e,t){switch(e){case"none":return;case"interactive":await t,await s(this,Se).DOMContentLoaded;return;case"complete":await t,await s(this,Se).load;return}},Sh=async function(e){switch(e.type){case"box":return{x:e.x,y:e.y,width:e.width,height:e.height};case"element":{const t=await this.getOrCreateSandbox(void 0),r=await t.callFunction(String(n=>n instanceof Element),!1,{type:"undefined"},[e.element]);if(r.type==="exception")throw new G.NoSuchElementException(`Element '${e.element.sharedId}' was not found`);if((0,Gn.assert)(r.result.type==="boolean"),!r.result.value)throw new G.NoSuchElementException(`Node '${e.element.sharedId}' is not an Element`);{const n=await t.callFunction(String(o=>{const c=o.getBoundingClientRect();return{x:c.x,y:c.y,height:c.height,width:c.width}}),!1,{type:"undefined"},[e.element]);(0,Gn.assert)(n.type==="success");const a=rl(n.result);if(!a)throw new G.UnableToCaptureScreenException(`Could not get bounding box for Element '${e.element.sharedId}'`);return a}}}},Ph=async function(e,t,r,n){switch(t.type){case"css":return{functionDeclaration:String((a,o,...c)=>{const h=l=>{if(!(l instanceof HTMLElement||l instanceof Document||l instanceof DocumentFragment))throw new Error("startNodes in css selector should be HTMLElement, Document or DocumentFragment");return[...l.querySelectorAll(a)]};c=c.length>0?c:[document];const d=c.map(l=>h(l)).flat(1);return o===0?d:d.slice(0,o)}),argumentsLocalValues:[{type:"string",value:t.value},{type:"number",value:r??0},...n]};case"xpath":return{functionDeclaration:String((a,o,...c)=>{const d=new XPathEvaluator().createExpression(a),l=m=>{const b=d.evaluate(m,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE),x=[];for(let C=0;C<b.snapshotLength;C++)x.push(b.snapshotItem(C));return x};c=c.length>0?c:[document];const p=c.map(m=>l(m)).flat(1);return o===0?p:p.slice(0,o)}),argumentsLocalValues:[{type:"string",value:t.value},{type:"number",value:r??0},...n]};case"innerText":if(t.value==="")throw new G.InvalidSelectorException("innerText locator cannot be empty");return{functionDeclaration:String((a,o,c,h,d,...l)=>{const p=c?a.toUpperCase():a,m=(x,C)=>{var T;const y=[];if(x instanceof DocumentFragment||x instanceof Document)return[...x.children].forEach(O=>y.push(...m(O,C))),y;if(!(x instanceof HTMLElement))return[];const v=x,N=c?(T=v.innerText)==null?void 0:T.toUpperCase():v.innerText;if(!N.includes(p))return[];const _=[];for(const D of v.children)D instanceof HTMLElement&&_.push(D);if(_.length===0)o&&N===p?y.push(v):o||y.push(v);else{const D=C<=0?[]:_.map(O=>m(O,C-1)).flat(1);D.length===0?(!o||N===p)&&y.push(v):y.push(...D)}return y};l=l.length>0?l:[document];const b=l.map(x=>m(x,d)).flat(1);return h===0?b:b.slice(0,h)}),argumentsLocalValues:[{type:"string",value:t.value},{type:"boolean",value:t.matchType!=="partial"},{type:"boolean",value:t.ignoreCase===!0},{type:"number",value:r??0},{type:"number",value:t.maxDepth??1e3},...n]};case"accessibility":{if(!t.value.name&&!t.value.role)throw new G.InvalidSelectorException("Either name or role has to be specified");await Promise.all([s(this,H).cdpClient.sendCommand("Accessibility.enable"),s(this,H).cdpClient.sendCommand("Accessibility.getRootAXNode")]);const a=await e.evaluate("({getAccessibleName, getAccessibleRole})",!1,"root",void 0,!1,!0);if(a.type!=="success")throw new Error("Could not get bindings");if(a.result.type!=="object")throw new Error("Could not get bindings");return{functionDeclaration:String((o,c,h,d,...l)=>{const p=[];let m=!1;function b(x,C){if(!m)for(const y of x){let v=!0;if(C.role){const _=h.getAccessibleRole(y);C.role!==_&&(v=!1)}if(C.name){const _=h.getAccessibleName(y);C.name!==_&&(v=!1)}if(v){if(d!==0&&p.length===d){m=!0;break}p.push(y)}const N=[];for(const _ of y.children)_ instanceof HTMLElement&&N.push(_);b(N,C)}}return l=l.length>0?l:Array.from(document.documentElement.children).filter(x=>x instanceof HTMLElement),b(l,{role:c,name:o}),p}),argumentsLocalValues:[{type:"string",value:t.value.name||""},{type:"string",value:t.value.role||""},{handle:a.result.handle},{type:"number",value:r??0},...n]}}}},_h=async function(e,t,r,n,a){var d,l,p;const o=await w(this,J,Ph).call(this,e,t,n,r);a={...a,maxObjectDepth:1};const c=await e.callFunction(o.functionDeclaration,!1,{type:"undefined"},o.argumentsLocalValues,"none",a);if(c.type!=="success")throw(d=s(this,qe))==null||d.call(this,Er.LOGGER_PREFIX,"Failed locateNodesByLocator",c),(l=c.exceptionDetails.text)!=null&&l.endsWith("is not a valid selector.")||(p=c.exceptionDetails.text)!=null&&p.endsWith("is not a valid XPath expression.")?new G.InvalidSelectorException(`Not valid selector ${typeof t.value=="string"?t.value:JSON.stringify(t.value)}`):c.exceptionDetails.text==="Error: startNodes in css selector should be HTMLElement, Document or DocumentFragment"?new G.InvalidArgumentException("startNodes in css selector should be HTMLElement, Document or DocumentFragment"):new G.UnknownErrorException(`Unexpected error in selector script: ${c.exceptionDetails.text}`);if(c.result.type!=="array")throw new G.UnknownErrorException(`Unexpected selector script result type: ${c.result.type}`);return{nodes:c.result.value.map(m=>{if(m.type!=="node")throw new G.UnknownErrorException(`Unexpected selector script result element: ${m.type}`);return m})}},u(_o,Ko),F(_o,"LOGGER_PREFIX",`${Xn.LogType.debug}:browsingContext`);Un.BrowsingContextImpl=_o;Er=_o;function kh(i){return["://",""].includes(i)&&(i="null"),i}function vw(i){const{quality:e,type:t}=i.format??{type:"image/png"};switch(t){case"image/png":return{format:"png"};case"image/jpeg":return{format:"jpeg",...e===void 0?{}:{quality:Math.round(e*100)}};case"image/webp":return{format:"webp",...e===void 0?{}:{quality:Math.round(e*100)}}}throw new G.InvalidArgumentException(`Image format '${t}' is not a supported format`)}function rl(i){var a,o,c,h;if(i.type!=="object"||i.value===void 0)return;const e=(a=i.value.find(([d])=>d==="x"))==null?void 0:a[1],t=(o=i.value.find(([d])=>d==="y"))==null?void 0:o[1],r=(c=i.value.find(([d])=>d==="height"))==null?void 0:c[1],n=(h=i.value.find(([d])=>d==="width"))==null?void 0:h[1];if(!((e==null?void 0:e.type)!=="number"||(t==null?void 0:t.type)!=="number"||(r==null?void 0:r.type)!=="number"||(n==null?void 0:n.type)!=="number"))return{x:e.value,y:t.value,width:n.value,height:r.value}}function nl(i){return{...i.width<0?{x:i.x+i.width,width:-i.width}:{x:i.x,width:i.width},...i.height<0?{y:i.y+i.height,height:-i.height}:{y:i.y,height:i.height}}}function bw(i,e){i=nl(i),e=nl(e);const t=Math.max(i.x,e.x),r=Math.max(i.y,e.y);return{x:t,y:r,width:Math.max(Math.min(i.x+i.width,e.x+e.width)-t,0),height:Math.max(Math.min(i.y+i.height,e.y+e.height)-r,0)}}function au(i){if(i=i.trim(),!/^[0-9]+$/.test(i))throw new G.InvalidArgumentException(`Invalid integer: ${i}`);return parseInt(i)}var Fc={};Object.defineProperty(Fc,"__esModule",{value:!0});Fc.WorkerRealm=void 0;const Cw=Ha;var Li,sn;class xw extends Cw.Realm{constructor(t,r,n,a,o,c,h,d,l){super(t,r,n,a,o,h,d);u(this,Li);u(this,sn);f(this,sn,c),f(this,Li,l),this.initialize()}get associatedBrowsingContexts(){return s(this,sn).flatMap(t=>t.associatedBrowsingContexts)}get realmType(){return s(this,Li)}get source(){var t;return{realm:this.realmId,context:(t=this.associatedBrowsingContexts[0])==null?void 0:t.id}}get realmInfo(){const t=s(this,sn).map(n=>n.realmId),{realmType:r}=this;switch(r){case"dedicated-worker":{const n=t[0];if(n===void 0||t.length!==1)throw new Error("Dedicated worker must have exactly one owner");return{...this.baseInfo,type:r,owners:[n]}}case"service-worker":case"shared-worker":return{...this.baseInfo,type:r}}}}Li=new WeakMap,sn=new WeakMap;Fc.WorkerRealm=xw;var jc={},Bc={},Ac={};Object.defineProperty(Ac,"__esModule",{value:!0});Ac.logMessageFormatter=Nh;Ac.getRemoteValuesText=Fu;const Ew=Ut,Ih=["%s","%d","%i","%f","%o","%O","%c"];function Th(i){return Ih.some(e=>i.includes(e))}function Nh(i){let e="";const t=i[0].value.toString(),r=i.slice(1,void 0),n=t.split(new RegExp(Ih.map(a=>`(${a})`).join("|"),"g"));for(const a of n)if(!(a===void 0||a===""))if(Th(a)){const o=r.shift();(0,Ew.assert)(o,`Less value is provided: "${Fu(i,!1)}"`),a==="%s"?e+=bd(o):a==="%d"||a==="%i"?o.type==="bigint"||o.type==="number"||o.type==="string"?e+=parseInt(o.value.toString(),10):e+="NaN":a==="%f"?o.type==="bigint"||o.type==="number"||o.type==="string"?e+=parseFloat(o.value.toString()):e+="NaN":e+=Mu(o)}else e+=a;if(r.length>0)throw new Error(`More value is provided: "${Fu(i,!1)}"`);return e}function Mu(i){var e;if(i.type!=="array"&&i.type!=="bigint"&&i.type!=="date"&&i.type!=="number"&&i.type!=="object"&&i.type!=="string")return bd(i);if(i.type==="bigint")return`${i.value.toString()}n`;if(i.type==="number")return i.value.toString();if(["date","string"].includes(i.type))return JSON.stringify(i.value);if(i.type==="object")return`{${i.value.map(t=>`${JSON.stringify(t[0])}:${Mu(t[1])}`).join(",")}}`;if(i.type==="array")return`[${((e=i.value)==null?void 0:e.map(t=>Mu(t)).join(","))??""}]`;throw Error(`Invalid value type: ${i}`)}function bd(i){var e,t,r,n;if(!Object.hasOwn(i,"value"))return i.type;switch(i.type){case"string":case"number":case"boolean":case"bigint":return String(i.value);case"regexp":return`/${i.value.pattern}/${i.value.flags??""}`;case"date":return new Date(i.value).toString();case"object":return`Object(${((e=i.value)==null?void 0:e.length)??""})`;case"array":return`Array(${((t=i.value)==null?void 0:t.length)??""})`;case"map":return`Map(${(r=i.value)==null?void 0:r.length})`;case"set":return`Set(${(n=i.value)==null?void 0:n.length})`;default:return i.type}}function Fu(i,e){const t=i[0];return t?t.type==="string"&&Th(t.value.toString())&&e?Nh(i):i.map(r=>bd(r)).join(" "):""}var ju;Object.defineProperty(Bc,"__esModule",{value:!0});Bc.LogManager=void 0;const eo=Z,il=Te,Sw=Ac;function al(i){const e=i==null?void 0:i.callFrames.map(t=>({columnNumber:t.columnNumber,functionName:t.functionName,lineNumber:t.lineNumber,url:t.url}));return e?{callFrames:e}:void 0}function Pw(i){return["error","assert"].includes(i)?"error":["debug","trace"].includes(i)?"debug":["warn","warning"].includes(i)?"warn":"info"}function _w(i){switch(i){case"warning":return"warn";case"startGroup":return"group";case"startGroupCollapsed":return"groupCollapsed";case"endGroup":return"groupEnd"}return i}var rn,nn,rs,an,An,Dh,Rh,zo,Oh;class Cd{constructor(e,t,r,n){u(this,An);u(this,rn);u(this,nn);u(this,rs);u(this,an);f(this,rs,e),f(this,nn,t),f(this,rn,r),f(this,an,n)}static create(e,t,r,n){var o;const a=new ju(e,t,r,n);return w(o=a,An,Rh).call(o),a}}rn=new WeakMap,nn=new WeakMap,rs=new WeakMap,an=new WeakMap,An=new WeakSet,Dh=async function(e,t){switch(e.type){case"undefined":return{type:"undefined"};case"boolean":return{type:"boolean",value:e.value};case"string":return{type:"string",value:e.value};case"number":return{type:"number",value:e.unserializableValue??e.value};case"bigint":if(e.unserializableValue!==void 0&&e.unserializableValue[e.unserializableValue.length-1]==="n")return{type:e.type,value:e.unserializableValue.slice(0,-1)};break;case"object":if(e.subtype==="null")return{type:"null"};break}return await t.serializeCdpObject(e,"none")},Rh=function(){s(this,rs).cdpClient.on("Runtime.consoleAPICalled",e=>{var n;const t=s(this,nn).findRealm({cdpSessionId:s(this,rs).cdpSessionId,executionContextId:e.executionContextId});if(t===void 0){(n=s(this,an))==null||n.call(this,il.LogType.cdp,e);return}const r=Promise.all(e.args.map(a=>w(this,An,Dh).call(this,a,t)));for(const a of t.associatedBrowsingContexts)s(this,rn).registerPromiseEvent(r.then(o=>({kind:"success",value:{type:"event",method:eo.ChromiumBidi.Log.EventNames.LogEntryAdded,params:{level:Pw(e.type),source:t.source,text:(0,Sw.getRemoteValuesText)(o,!0),timestamp:Math.round(e.timestamp),stackTrace:al(e.stackTrace),type:"console",method:_w(e.type),args:o}}}),o=>({kind:"error",error:o})),a.id,eo.ChromiumBidi.Log.EventNames.LogEntryAdded)}),s(this,rs).cdpClient.on("Runtime.exceptionThrown",e=>{var r,n;const t=s(this,nn).findRealm({cdpSessionId:s(this,rs).cdpSessionId,executionContextId:e.exceptionDetails.executionContextId});if(t===void 0){(r=s(this,an))==null||r.call(this,il.LogType.cdp,e);return}for(const a of t.associatedBrowsingContexts)s(this,rn).registerPromiseEvent(w(n=ju,zo,Oh).call(n,e,t).then(o=>({kind:"success",value:{type:"event",method:eo.ChromiumBidi.Log.EventNames.LogEntryAdded,params:{level:"error",source:t.source,text:o,timestamp:Math.round(e.timestamp),stackTrace:al(e.exceptionDetails.stackTrace),type:"javascript"}}}),o=>({kind:"error",error:o})),a.id,eo.ChromiumBidi.Log.EventNames.LogEntryAdded)})},zo=new WeakSet,Oh=async function(e,t){return e.exceptionDetails.exception?t===void 0?JSON.stringify(e.exceptionDetails.exception):await t.stringifyObject(e.exceptionDetails.exception):e.exceptionDetails.text},u(Cd,zo);Bc.LogManager=Cd;ju=Cd;Object.defineProperty(jc,"__esModule",{value:!0});jc.CdpTarget=void 0;const kw=xe,Iw=lr,Tw=qt,wr=Te,Nw=Un,Dw=Bc;var qi,oe,Ui,on,Hi,ns,cn,is,Ki,dt,un,zi,Ge,dn,ln,Ne,ye,Mh,Au,ho,Fh,jh,Bh,Ah;const Pd=class Pd extends Tw.EventEmitter{constructor(t,r,n,a,o,c,h,d,l,p,m,b){super();u(this,ye);u(this,qi);u(this,oe);u(this,Ui);u(this,on);u(this,Hi);u(this,ns);u(this,cn);u(this,is);u(this,Ki);u(this,dt);u(this,un,new Iw.Deferred);u(this,zi);u(this,Ge);u(this,dn,!1);u(this,ln,!1);u(this,Ne,{request:!1,response:!1,auth:!1});f(this,qi,t),f(this,oe,r),f(this,Ui,n),f(this,on,a),f(this,ns,o),f(this,Hi,c),f(this,cn,h),f(this,dt,l),f(this,is,d),f(this,Ki,p),f(this,zi,m),f(this,Ge,b)}static create(t,r,n,a,o,c,h,d,l,p,m,b){var C,y;const x=new Pd(t,r,n,a,c,o,h,d,l,p,m,b);return Dw.LogManager.create(x,o,c,b),w(C=x,ye,Fh).call(C),w(y=x,ye,Mh).call(y),x}get unblocked(){return s(this,un)}get id(){return s(this,qi)}get cdpClient(){return s(this,oe)}get parentCdpClient(){return s(this,on)}get browserCdpClient(){return s(this,Ui)}get cdpSessionId(){return s(this,oe).sessionId}async toggleFetchIfNeeded(){const t=s(this,dt).getInterceptionStages(this.topLevelId);if(s(this,Ne).request===t.request&&s(this,Ne).response===t.response&&s(this,Ne).auth===t.auth)return;const r=[];if(f(this,Ne,t),(t.request||t.auth)&&r.push({urlPattern:"*",requestStage:"Request"}),t.response&&r.push({urlPattern:"*",requestStage:"Response"}),r.length)await s(this,oe).sendCommand("Fetch.enable",{patterns:r,handleAuthRequests:t.auth});else{const n=s(this,dt).getRequestsByTarget(this).filter(a=>a.interceptPhase);Promise.allSettled(n.map(a=>a.waitNextPhase)).then(async()=>s(this,dt).getRequestsByTarget(this).filter(o=>o.interceptPhase).length?await this.toggleFetchIfNeeded():await s(this,oe).sendCommand("Fetch.disable")).catch(a=>{var o;(o=s(this,Ge))==null||o.call(this,wr.LogType.bidi,"Disable failed",a)})}}async toggleNetworkIfNeeded(){var t;try{await Promise.all([this.toggleSetCacheDisabled(),this.toggleFetchIfNeeded()])}catch(r){if((t=s(this,Ge))==null||t.call(this,wr.LogType.debugError,r),!w(this,ye,ho).call(this,r))throw r}}async toggleSetCacheDisabled(t){var a;const r=s(this,dt).defaultCacheBehavior==="bypass",n=t??r;if(s(this,ln)!==n){f(this,ln,n);try{await s(this,oe).sendCommand("Network.setCacheDisabled",{cacheDisabled:n})}catch(o){if((a=s(this,Ge))==null||a.call(this,wr.LogType.debugError,o),f(this,ln,!n),!w(this,ye,ho).call(this,o))throw o}}}async toggleDeviceAccessIfNeeded(){var r;const t=this.isSubscribedTo(kw.BiDiModule.Bluetooth);if(s(this,dn)!==t){f(this,dn,t);try{await s(this,oe).sendCommand(t?"DeviceAccess.enable":"DeviceAccess.disable")}catch(n){if((r=s(this,Ge))==null||r.call(this,wr.LogType.debugError,n),f(this,dn,!t),!w(this,ye,ho).call(this,n))throw n}}}async toggleNetwork(){var a;const t=s(this,dt).getInterceptionStages(this.topLevelId),r=Object.values(t).some(o=>o),n=s(this,Ne).request!==t.request||s(this,Ne).response!==t.response||s(this,Ne).auth!==t.auth;(a=s(this,Ge))==null||a.call(this,wr.LogType.debugInfo,"Toggle Network",`Fetch (${r}) ${n}`),r&&n&&await w(this,ye,jh).call(this,t),!r&&n&&await w(this,ye,Bh).call(this)}getChannels(){return s(this,cn).find().flatMap(t=>t.channels)}get topLevelId(){return s(this,is).findTopLevelContextId(this.id)??this.id}isSubscribedTo(t){return s(this,ns).subscriptionManager.isSubscribedTo(t,this.topLevelId)}};qi=new WeakMap,oe=new WeakMap,Ui=new WeakMap,on=new WeakMap,Hi=new WeakMap,ns=new WeakMap,cn=new WeakMap,is=new WeakMap,Ki=new WeakMap,dt=new WeakMap,un=new WeakMap,zi=new WeakMap,Ge=new WeakMap,dn=new WeakMap,ln=new WeakMap,Ne=new WeakMap,ye=new WeakSet,Mh=async function(){var t;try{await Promise.all([s(this,oe).sendCommand("Page.enable"),s(this,oe).sendCommand("Page.getFrameTree").then(r=>w(this,ye,Au).call(this,r.frameTree)),s(this,oe).sendCommand("Runtime.enable"),s(this,oe).sendCommand("Page.setLifecycleEventsEnabled",{enabled:!0}),s(this,oe).sendCommand("Page.setPrerenderingAllowed",{isAllowed:!s(this,Ki)}).catch(()=>{}),s(this,oe).sendCommand("Network.enable").then(()=>this.toggleNetworkIfNeeded()),s(this,oe).sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}),w(this,ye,Ah).call(this),s(this,oe).sendCommand("Runtime.runIfWaitingForDebugger"),s(this,on).sendCommand("Runtime.runIfWaitingForDebugger"),this.toggleDeviceAccessIfNeeded()])}catch(r){if((t=s(this,Ge))==null||t.call(this,wr.LogType.debugError,"Failed to unblock target",r),!s(this,oe).isCloseError(r)){s(this,un).resolve({kind:"error",error:r});return}}s(this,un).resolve({kind:"success",value:void 0})},Au=function(t){var a;const r=t.frame,n=s(this,is).findContext(r.id);if(n!==void 0&&n.parentId===null&&r.parentId!==null&&r.parentId!==void 0&&(n.parentId=r.parentId),n===void 0&&r.parentId!==void 0){const o=s(this,is).getContext(r.parentId);Nw.BrowsingContextImpl.create(r.id,r.parentId,o.userContext,o.cdpTarget,s(this,ns),s(this,is),s(this,Hi),r.url,void 0,s(this,zi),s(this,Ge))}(a=t.childFrames)==null||a.map(o=>w(this,ye,Au).call(this,o))},ho=function(t){const r=t;return r.code===-32001&&r.message==="Session with given id not found."||s(this,oe).isCloseError(t)},Fh=function(){s(this,oe).on("Network.requestWillBeSent",t=>{t.loaderId===t.requestId&&this.emit("frameStartedNavigating",{loaderId:t.loaderId,url:t.request.url,frameId:t.frameId})}),s(this,oe).on("*",(t,r)=>{typeof t=="string"&&(s(this,ns).registerEvent({type:"event",method:`goog:cdp.${t}`,params:{event:t,params:r,session:this.cdpSessionId}},this.id),s(this,ns).registerEvent({type:"event",method:`cdp.${t}`,params:{event:t,params:r,session:this.cdpSessionId}},this.id))})},jh=async function(t){const r=[];if((t.request||t.auth)&&r.push({urlPattern:"*",requestStage:"Request"}),t.response&&r.push({urlPattern:"*",requestStage:"Response"}),r.length){const n=s(this,Ne);f(this,Ne,t);try{await s(this,oe).sendCommand("Fetch.enable",{patterns:r,handleAuthRequests:t.auth})}catch{f(this,Ne,n)}}},Bh=async function(){s(this,dt).getRequestsByTarget(this).filter(r=>r.interceptPhase).length===0&&(f(this,Ne,{request:!1,response:!1,auth:!1}),await s(this,oe).sendCommand("Fetch.disable"))},Ah=async function(){await Promise.all(s(this,cn).find({targetId:this.topLevelId,global:!0}).map(t=>t.initInTarget(this,!0)))};let Bu=Pd;jc.CdpTarget=Bu;Object.defineProperty(Rc,"__esModule",{value:!0});Rc.CdpTargetManager=void 0;const Rw=Te,ou=Un,Ow=Fc,Mw=jc,ol={service_worker:"service-worker",shared_worker:"shared-worker",worker:"dedicated-worker"};var Wi,Vi,hn,Gi,as,De,pn,Xi,fn,Xe,Ji,Rt,qs,Yi,Y,po,$h,Lh,qh,Uh,Hh,fo,Qi,$u,Kh,zh,Wh;class Fw{constructor(e,t,r,n,a,o,c,h,d,l,p,m,b){u(this,Y);u(this,Wi);u(this,Vi);u(this,hn,new Set);u(this,Gi);u(this,as);u(this,De);u(this,pn);u(this,Xi);u(this,fn);u(this,Xe);u(this,Ji);u(this,Rt);u(this,qs);u(this,Yi);u(this,Qi,new Map);f(this,Vi,e),f(this,Wi,t),s(this,hn).add(r),f(this,Gi,r),f(this,as,n),f(this,De,a),f(this,fn,d),f(this,pn,c),f(this,Xi,h),f(this,Xe,o),f(this,Ji,l),f(this,Yi,p),f(this,qs,m),f(this,Rt,b),w(this,Y,po).call(this,t)}}Wi=new WeakMap,Vi=new WeakMap,hn=new WeakMap,Gi=new WeakMap,as=new WeakMap,De=new WeakMap,pn=new WeakMap,Xi=new WeakMap,fn=new WeakMap,Xe=new WeakMap,Ji=new WeakMap,Rt=new WeakMap,qs=new WeakMap,Yi=new WeakMap,Y=new WeakSet,po=function(e){e.on("Target.attachedToTarget",t=>{w(this,Y,Uh).call(this,t,e)}),e.on("Target.detachedFromTarget",w(this,Y,Kh).bind(this)),e.on("Target.targetInfoChanged",w(this,Y,zh).bind(this)),e.on("Inspector.targetCrashed",()=>{w(this,Y,Wh).call(this,e)}),e.on("Page.frameAttached",w(this,Y,$h).bind(this)),e.on("Page.frameDetached",w(this,Y,Lh).bind(this)),e.on("Page.frameSubtreeWillBeDetached",w(this,Y,qh).bind(this))},$h=function(e){const t=s(this,De).findContext(e.parentFrameId);t!==void 0&&ou.BrowsingContextImpl.create(e.frameId,e.parentFrameId,t.userContext,t.cdpTarget,s(this,as),s(this,De),s(this,Xe),"about:blank",void 0,s(this,qs),s(this,Rt))},Lh=function(e){var t;e.reason!=="swap"&&((t=s(this,De).findContext(e.frameId))==null||t.dispose(!0))},qh=function(e){var t;(t=s(this,De).findContext(e.frameId))==null||t.dispose(!0)},Uh=function(e,t){const{sessionId:r,targetInfo:n}=e,a=s(this,Vi).getCdpClient(r),o=async()=>{await a.sendCommand("Runtime.runIfWaitingForDebugger").then(()=>t.sendCommand("Target.detachFromTarget",e)).catch(h=>{var d;return(d=s(this,Rt))==null?void 0:d.call(this,Rw.LogType.debugError,h)})};if(s(this,Gi)===n.targetId){o();return}const c=n.type==="service_worker"?`${t.sessionId}_${n.targetId}`:n.targetId;if(!s(this,hn).has(c)){switch(s(this,hn).add(c),n.type){case"tab":w(this,Y,po).call(this,a),(async()=>await a.sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}))();return;case"page":case"iframe":{const h=w(this,Y,fo).call(this,a,t,n),d=s(this,De).findContext(n.targetId);if(d&&n.type==="iframe")d.updateCdpTarget(h);else{const l=w(this,Y,Hh).call(this,n,t.sessionId),p=n.browserContextId&&n.browserContextId!==s(this,Ji)?n.browserContextId:"default";ou.BrowsingContextImpl.create(n.targetId,l,p,h,s(this,as),s(this,De),s(this,Xe),n.url===""?"about:blank":n.url,n.openerFrameId??n.openerId,s(this,qs),s(this,Rt))}return}case"service_worker":case"worker":{const h=s(this,Xe).findRealm({cdpSessionId:t.sessionId});if(!h){o();return}const d=w(this,Y,fo).call(this,a,t,n);w(this,Y,$u).call(this,ol[n.type],d,h);return}case"shared_worker":{const h=w(this,Y,fo).call(this,a,t,n);w(this,Y,$u).call(this,ol[n.type],h);return}}o()}},Hh=function(e,t){var n;if(e.type!=="iframe")return null;const r=e.openerFrameId??e.openerId;return r!==void 0?r:t!==void 0?((n=s(this,De).findContextBySession(t))==null?void 0:n.id)??null:null},fo=function(e,t,r){w(this,Y,po).call(this,e);const n=Mw.CdpTarget.create(r.targetId,e,s(this,Wi),t,s(this,Xe),s(this,as),s(this,fn),s(this,De),s(this,pn),s(this,Yi),s(this,qs),s(this,Rt));return s(this,pn).onCdpTargetCreated(n),s(this,Xi).onCdpTargetCreated(n),n},Qi=new WeakMap,$u=function(e,t,r){t.cdpClient.on("Runtime.executionContextCreated",n=>{const{uniqueId:a,id:o,origin:c}=n.context,h=new Ow.WorkerRealm(t.cdpClient,s(this,as),o,s(this,Rt),(0,ou.serializeOrigin)(c),r?[r]:[],a,s(this,Xe),e);s(this,Qi).set(t.cdpSessionId,h)})},Kh=function({sessionId:e,targetId:t}){t&&s(this,fn).find({targetId:t}).map(a=>{a.dispose(t)});const r=s(this,De).findContextBySession(e);if(r){r.dispose(!0);return}const n=s(this,Qi).get(e);n&&s(this,Xe).deleteRealms({cdpSessionId:n.cdpClient.sessionId})},zh=function(e){const t=s(this,De).findContext(e.targetInfo.targetId);t&&t.onTargetInfoChanged(e)},Wh=function(e){const t=s(this,Xe).findRealms({cdpSessionId:e.sessionId});for(const r of t)r.dispose()};Rc.CdpTargetManager=Fw;var $c={};Object.defineProperty($c,"__esModule",{value:!0});$c.BrowsingContextStorage=void 0;const cl=Z,jw=qt;var lt,mn;class Bw{constructor(){u(this,lt,new Map);u(this,mn,new jw.EventEmitter)}getTopLevelContexts(){return this.getAllContexts().filter(e=>e.isTopLevelContext())}getAllContexts(){return Array.from(s(this,lt).values())}deleteContextById(e){s(this,lt).delete(e)}deleteContext(e){s(this,lt).delete(e.id)}addContext(e){s(this,lt).set(e.id,e),s(this,mn).emit("added",{browsingContext:e})}waitForContext(e){return new Promise(t=>{const r=n=>{n.browsingContext.id===e&&(s(this,mn).off("added",r),t(n.browsingContext))};s(this,mn).on("added",r)})}hasContext(e){return s(this,lt).has(e)}findContext(e){return s(this,lt).get(e)}findTopLevelContextId(e){if(e===null)return null;const t=this.findContext(e),r=(t==null?void 0:t.parentId)??null;return r===null?e:this.findTopLevelContextId(r)}findContextBySession(e){for(const t of s(this,lt).values())if(t.cdpTarget.cdpSessionId===e)return t}getContext(e){const t=this.findContext(e);if(t===void 0)throw new cl.NoSuchFrameException(`Context ${e} not found`);return t}verifyTopLevelContextsList(e){const t=new Set;if(!e)return t;for(const r of e){const n=this.getContext(r);if(n.isTopLevelContext())t.add(n);else throw new cl.InvalidArgumentException(`Non top-level context '${r}' given.`)}return t}}lt=new WeakMap,mn=new WeakMap;$c.BrowsingContextStorage=Bw;var Lc={},qc={},mo;Object.defineProperty(qc,"__esModule",{value:!0});qc.NetworkRequest=void 0;const Me=Z,yr=Ut,ul=lr,Aw=Te,te=ge,$w=new RegExp('(?<=realm=").*(?=")');var gn,we,je,os,wn,L,ht,yn,A,Zi,Us,Hs,ea,Ks,R,Lu,Vh,Gh,Xh,Jh,go,Sr,qu,Yh,Qh,Zh,Uu,Pr,Et,wo,Hu,_r,kr,Ir,yo,ep,tp,sp,rp,np,vo,Wo,ip;class ko{constructor(e,t,r,n,a=0,o){u(this,R);u(this,gn);u(this,we);u(this,je);u(this,os,!1);u(this,wn);u(this,L,{});u(this,ht);u(this,yn);u(this,A,{});u(this,Zi);u(this,Us);u(this,Hs);u(this,ea);u(this,Ks,{[Me.ChromiumBidi.Network.EventNames.AuthRequired]:!1,[Me.ChromiumBidi.Network.EventNames.BeforeRequestSent]:!1,[Me.ChromiumBidi.Network.EventNames.FetchError]:!1,[Me.ChromiumBidi.Network.EventNames.ResponseCompleted]:!1,[Me.ChromiumBidi.Network.EventNames.ResponseStarted]:!1});F(this,"waitNextPhase",new ul.Deferred);f(this,gn,e),f(this,Zi,t),f(this,Us,r),f(this,Hs,n),f(this,wn,a),f(this,ea,o)}get id(){return s(this,gn)}get fetchId(){return s(this,we)}get interceptPhase(){return s(this,je)}get url(){var r,n,a,o,c,h,d,l;const e=((r=s(this,L).info)==null?void 0:r.request.urlFragment)??((n=s(this,L).paused)==null?void 0:n.request.urlFragment)??"";return`${((a=s(this,A).info)==null?void 0:a.url)??((o=s(this,A).paused)==null?void 0:o.request.url)??((c=s(this,ht))==null?void 0:c.url)??((h=s(this,L).auth)==null?void 0:h.request.url)??((d=s(this,L).info)==null?void 0:d.request.url)??((l=s(this,L).paused)==null?void 0:l.request.url)??mo.unknownParameter}${e}`}get redirectCount(){return s(this,wn)}get cdpTarget(){return s(this,Hs)}get cdpClient(){return s(this,Hs).cdpClient}isRedirecting(){return!!s(this,L).info}handleRedirect(e){s(this,A).hasExtraInfo=!1,s(this,A).info=e.redirectResponse,w(this,R,Et).call(this,{wasRedirected:!0})}onRequestWillBeSentEvent(e){s(this,L).info=e,w(this,R,Et).call(this)}onRequestWillBeSentExtraInfoEvent(e){s(this,L).extraInfo=e,w(this,R,Et).call(this)}onResponseReceivedExtraInfoEvent(e){e.statusCode>=300&&e.statusCode<=399&&s(this,L).info&&e.headers.location===s(this,L).info.request.url||(s(this,A).extraInfo=e,w(this,R,Et).call(this))}onResponseReceivedEvent(e){s(this,A).hasExtraInfo=e.hasExtraInfo,s(this,A).info=e.response,w(this,R,Et).call(this)}onServedFromCache(){f(this,os,!0),w(this,R,Et).call(this)}onLoadingFailedEvent(e){w(this,R,Et).call(this,{hasFailed:!0}),w(this,R,kr).call(this,()=>({method:Me.ChromiumBidi.Network.EventNames.FetchError,params:{...w(this,R,Ir).call(this),errorText:e.errorText}}))}async failRequest(e){(0,yr.assert)(s(this,we),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.failRequest",{requestId:s(this,we),errorReason:e}),f(this,je,void 0)}onRequestPaused(e){f(this,we,e.requestId),e.responseStatusCode||e.responseErrorReason?(s(this,A).paused=e,w(this,R,Pr).call(this,"responseStarted")&&!s(this,Ks)[Me.ChromiumBidi.Network.EventNames.ResponseStarted]&&s(this,we)!==this.id?f(this,je,"responseStarted"):w(this,R,Hu).call(this)):(s(this,L).paused=e,w(this,R,Pr).call(this,"beforeRequestSent")&&!s(this,Ks)[Me.ChromiumBidi.Network.EventNames.BeforeRequestSent]&&s(this,we)!==this.id?f(this,je,"beforeRequestSent"):w(this,R,wo).call(this)),w(this,R,Et).call(this)}onAuthRequired(e){f(this,we,e.requestId),s(this,L).auth=e,w(this,R,Pr).call(this,"authRequired")&&s(this,we)!==this.id?f(this,je,"authRequired"):w(this,R,_r).call(this,{response:"Default"}),w(this,R,kr).call(this,()=>({method:Me.ChromiumBidi.Network.EventNames.AuthRequired,params:{...w(this,R,Ir).call(this,"authRequired"),response:w(this,R,yo).call(this)}}))}async continueRequest(e={}){const t=w(this,R,vo).call(this,e.headers,e.cookies),r=(0,te.cdpFetchHeadersFromBidiNetworkHeaders)(t),n=dl(e.body);await w(this,R,wo).call(this,{url:e.url,method:e.method,headers:r,postData:n}),f(this,ht,{url:e.url,method:e.method,headers:e.headers,cookies:e.cookies,bodySize:Lw(e.body)})}async continueResponse(e={}){var t,r,n;if(this.interceptPhase==="authRequired")if(e.credentials)await Promise.all([this.waitNextPhase,await w(this,R,_r).call(this,{response:"ProvideCredentials",username:e.credentials.username,password:e.credentials.password})]);else return await w(this,R,_r).call(this,{response:"ProvideCredentials"});if(s(this,je)==="responseStarted"){const a=w(this,R,vo).call(this,e.headers,e.cookies),o=(0,te.cdpFetchHeadersFromBidiNetworkHeaders)(a);await w(this,R,Hu).call(this,{responseCode:e.statusCode??((t=s(this,A).paused)==null?void 0:t.responseStatusCode),responsePhrase:e.reasonPhrase??((r=s(this,A).paused)==null?void 0:r.responseStatusText),responseHeaders:o??((n=s(this,A).paused)==null?void 0:n.responseHeaders)}),f(this,yn,{statusCode:e.statusCode,headers:a})}}async continueWithAuth(e){let t,r;if(e.action==="provideCredentials"){const{credentials:a}=e;t=a.username,r=a.password}const n=(0,te.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction)(e.action);await w(this,R,_r).call(this,{response:n,username:t,password:r})}async provideResponse(e){if((0,yr.assert)(s(this,we),"Network Interception not set-up."),this.interceptPhase==="authRequired")return await w(this,R,_r).call(this,{response:"ProvideCredentials"});if(!e.body&&!e.headers)return await w(this,R,wo).call(this);const t=w(this,R,vo).call(this,e.headers,e.cookies),r=(0,te.cdpFetchHeadersFromBidiNetworkHeaders)(t),n=e.statusCode??s(this,R,Sr)??200;await this.cdpClient.sendCommand("Fetch.fulfillRequest",{requestId:s(this,we),responseCode:n,responsePhrase:e.reasonPhrase,responseHeaders:r,body:dl(e.body)}),f(this,je,void 0)}dispose(){this.waitNextPhase.reject(new Error("waitNextPhase disposed"))}}gn=new WeakMap,we=new WeakMap,je=new WeakMap,os=new WeakMap,wn=new WeakMap,L=new WeakMap,ht=new WeakMap,yn=new WeakMap,A=new WeakMap,Zi=new WeakMap,Us=new WeakMap,Hs=new WeakMap,ea=new WeakMap,Ks=new WeakMap,R=new WeakSet,Lu=function(){return this.url.startsWith("data:")},Vh=function(){var e,t,r,n,a;return((e=s(this,ht))==null?void 0:e.method)??((t=s(this,L).info)==null?void 0:t.request.method)??((r=s(this,L).paused)==null?void 0:r.request.method)??((n=s(this,L).auth)==null?void 0:n.request.method)??((a=s(this,A).paused)==null?void 0:a.request.method)},Gh=function(){return!s(this,L).info||!s(this,L).info.loaderId||s(this,L).info.loaderId!==s(this,L).info.requestId?null:s(this,Us).getNavigationId(s(this,R,go)??void 0)},Xh=function(){let e=[];return s(this,L).extraInfo&&(e=s(this,L).extraInfo.associatedCookies.filter(({blockedReasons:t})=>!Array.isArray(t)||t.length===0).map(({cookie:t})=>(0,te.cdpToBiDiCookie)(t))),e},Jh=function(){var t,r;let e=0;return typeof((t=s(this,ht))==null?void 0:t.bodySize)=="number"?e=s(this,ht).bodySize:e=(0,te.bidiBodySizeFromCdpPostDataEntries)(((r=s(this,L).info)==null?void 0:r.request.postDataEntries)??[]),e},go=function(){var e,t,r,n;return((e=s(this,A).paused)==null?void 0:e.frameId)??((t=s(this,L).info)==null?void 0:t.frameId)??((r=s(this,L).paused)==null?void 0:r.frameId)??((n=s(this,L).auth)==null?void 0:n.frameId)??null},Sr=function(){var e,t,r,n;return((e=s(this,yn))==null?void 0:e.statusCode)??((t=s(this,A).paused)==null?void 0:t.responseStatusCode)??((r=s(this,A).extraInfo)==null?void 0:r.statusCode)??((n=s(this,A).info)==null?void 0:n.status)},qu=function(){var t,r,n;let e=[];return(t=s(this,ht))!=null&&t.headers?e=s(this,ht).headers:e=[...(0,te.bidiNetworkHeadersFromCdpNetworkHeaders)((r=s(this,L).info)==null?void 0:r.request.headers),...(0,te.bidiNetworkHeadersFromCdpNetworkHeaders)((n=s(this,L).extraInfo)==null?void 0:n.headers)],e},Yh=function(){var r;if(!s(this,A).info||!(s(this,R,Sr)===401||s(this,R,Sr)===407))return;const e=s(this,R,Sr)===401?"WWW-Authenticate":"Proxy-Authenticate",t=[];for(const[n,a]of Object.entries(s(this,A).info.headers))n.localeCompare(e,void 0,{sensitivity:"base"})===0&&t.push({scheme:a.split(" ").at(0)??"",realm:((r=a.match($w))==null?void 0:r.at(0))??""});return t},Qh=function(){var e,t,r,n,a,o,c,h,d,l,p,m,b,x,C,y,v,N,_,T,D,O;return{timeOrigin:(0,te.getTiming)((t=(e=s(this,A).info)==null?void 0:e.timing)==null?void 0:t.requestTime),requestTime:(0,te.getTiming)((n=(r=s(this,A).info)==null?void 0:r.timing)==null?void 0:n.requestTime),redirectStart:0,redirectEnd:0,fetchStart:(0,te.getTiming)((o=(a=s(this,A).info)==null?void 0:a.timing)==null?void 0:o.requestTime),dnsStart:(0,te.getTiming)((h=(c=s(this,A).info)==null?void 0:c.timing)==null?void 0:h.dnsStart),dnsEnd:(0,te.getTiming)((l=(d=s(this,A).info)==null?void 0:d.timing)==null?void 0:l.dnsEnd),connectStart:(0,te.getTiming)((m=(p=s(this,A).info)==null?void 0:p.timing)==null?void 0:m.connectStart),connectEnd:(0,te.getTiming)((x=(b=s(this,A).info)==null?void 0:b.timing)==null?void 0:x.connectEnd),tlsStart:(0,te.getTiming)((y=(C=s(this,A).info)==null?void 0:C.timing)==null?void 0:y.sslStart),requestStart:(0,te.getTiming)((N=(v=s(this,A).info)==null?void 0:v.timing)==null?void 0:N.sendStart),responseStart:(0,te.getTiming)((T=(_=s(this,A).info)==null?void 0:_.timing)==null?void 0:T.receiveHeadersStart),responseEnd:(0,te.getTiming)((O=(D=s(this,A).info)==null?void 0:D.timing)==null?void 0:O.receiveHeadersEnd)}},Zh=function(){this.waitNextPhase.resolve(),this.waitNextPhase=new ul.Deferred},Uu=function(e){return s(this,Hs).isSubscribedTo(`network.${e}`)?s(this,Us).getInterceptsForPhase(this,e):new Set},Pr=function(e){return w(this,R,Uu).call(this,e).size>0},Et=function(e={}){const t=e.wasRedirected||e.hasFailed||w(this,R,Lu).call(this)||!!s(this,L).extraInfo||s(this,os)||!!(s(this,A).info&&!s(this,A).hasExtraInfo),r=w(this,R,Lu).call(this)||s(this,os),n=!r&&w(this,R,Pr).call(this,"beforeRequestSent"),a=!n||n&&!!s(this,L).paused;s(this,L).info&&(n?a:t)&&w(this,R,kr).call(this,w(this,R,tp).bind(this));const o=!!s(this,A).extraInfo||s(this,os)||!!(s(this,A).info&&!s(this,A).hasExtraInfo),c=!r&&w(this,R,Pr).call(this,"responseStarted");(s(this,A).info||c&&s(this,A).paused)&&w(this,R,kr).call(this,w(this,R,sp).bind(this));const h=!c||c&&!!s(this,A).paused;s(this,A).info&&o&&h&&(w(this,R,kr).call(this,w(this,R,rp).bind(this)),s(this,Us).deleteRequest(this.id))},wo=async function(e={}){(0,yr.assert)(s(this,we),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueRequest",{requestId:s(this,we),url:e.url,method:e.method,headers:e.headers,postData:e.postData}),f(this,je,void 0)},Hu=async function({responseCode:e,responsePhrase:t,responseHeaders:r}={}){(0,yr.assert)(s(this,we),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueResponse",{requestId:s(this,we),responseCode:e,responsePhrase:t,responseHeaders:r}),f(this,je,void 0)},_r=async function(e){(0,yr.assert)(s(this,we),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueWithAuth",{requestId:s(this,we),authChallengeResponse:e}),f(this,je,void 0)},kr=function(e){var r;let t;try{t=e()}catch(n){(r=s(this,ea))==null||r.call(this,Aw.LogType.debugError,n);return}w(this,R,np).call(this)||s(this,Ks)[t.method]&&t.method!==Me.ChromiumBidi.Network.EventNames.AuthRequired||(w(this,R,Zh).call(this),s(this,Ks)[t.method]=!0,s(this,Zi).registerEvent(Object.assign(t,{type:"event"}),s(this,R,go)))},Ir=function(e){var r;const t={isBlocked:!1};if(e){const n=w(this,R,Uu).call(this,e);t.isBlocked=n.size>0,t.isBlocked&&(t.intercepts=[...n])}return{context:s(this,R,go),navigation:s(this,R,Gh),redirectCount:s(this,wn),request:w(this,R,ep).call(this),timestamp:Math.round((0,te.getTiming)((r=s(this,L).info)==null?void 0:r.wallTime)*1e3),...t}},yo=function(){var n,a,o,c,h,d,l,p,m,b,x,C;(n=s(this,A).info)!=null&&n.fromDiskCache&&(s(this,A).extraInfo=void 0);const e=[...(0,te.bidiNetworkHeadersFromCdpNetworkHeaders)((a=s(this,A).info)==null?void 0:a.headers),...(0,te.bidiNetworkHeadersFromCdpNetworkHeaders)((o=s(this,A).extraInfo)==null?void 0:o.headers)],t=s(this,R,Yh);return{...{url:this.url,protocol:((c=s(this,A).info)==null?void 0:c.protocol)??"",status:s(this,R,Sr)??-1,statusText:((h=s(this,A).info)==null?void 0:h.statusText)||((d=s(this,A).paused)==null?void 0:d.responseStatusText)||"",fromCache:((l=s(this,A).info)==null?void 0:l.fromDiskCache)||((p=s(this,A).info)==null?void 0:p.fromPrefetchCache)||s(this,os),headers:((m=s(this,yn))==null?void 0:m.headers)??e,mimeType:((b=s(this,A).info)==null?void 0:b.mimeType)||"",bytesReceived:((x=s(this,A).info)==null?void 0:x.encodedDataLength)||0,headersSize:(0,te.computeHeadersSize)(e),bodySize:0,content:{size:0},...t?{authChallenges:t}:{}},"goog:securityDetails":(C=s(this,A).info)==null?void 0:C.securityDetails}},ep=function(){var r,n,a,o,c;const e=s(this,R,qu);return{...{request:s(this,gn),url:this.url,method:s(this,R,Vh)??mo.unknownParameter,headers:e,cookies:s(this,R,Xh),headersSize:(0,te.computeHeadersSize)(e),bodySize:s(this,R,Jh),destination:"",initiatorType:null,timings:s(this,R,Qh)},"goog:postData":(n=(r=s(this,L).info)==null?void 0:r.request)==null?void 0:n.postData,"goog:hasPostData":(o=(a=s(this,L).info)==null?void 0:a.request)==null?void 0:o.hasPostData,"goog:resourceType":(c=s(this,L).info)==null?void 0:c.type}},tp=function(){var e;return(0,yr.assert)(s(this,L).info,"RequestWillBeSentEvent is not set"),{method:Me.ChromiumBidi.Network.EventNames.BeforeRequestSent,params:{...w(this,R,Ir).call(this,"beforeRequestSent"),initiator:{type:w(e=mo,Wo,ip).call(e,s(this,L).info.initiator.type),columnNumber:s(this,L).info.initiator.columnNumber,lineNumber:s(this,L).info.initiator.lineNumber,stackTrace:s(this,L).info.initiator.stack,request:s(this,L).info.initiator.requestId}}}},sp=function(){return{method:Me.ChromiumBidi.Network.EventNames.ResponseStarted,params:{...w(this,R,Ir).call(this,"responseStarted"),response:w(this,R,yo).call(this)}}},rp=function(){return{method:Me.ChromiumBidi.Network.EventNames.ResponseCompleted,params:{...w(this,R,Ir).call(this),response:w(this,R,yo).call(this)}}},np=function(){var t,r;const e="/favicon.ico";return((t=s(this,L).paused)==null?void 0:t.request.url.endsWith(e))??((r=s(this,L).info)==null?void 0:r.request.url.endsWith(e))??!1},vo=function(e,t){if(!e&&!t)return;let r=e;const n=(0,te.networkHeaderFromCookieHeaders)(t);return n&&!r&&(r=s(this,R,qu)),n&&r&&(r.filter(a=>a.name.localeCompare("cookie",void 0,{sensitivity:"base"})!==0),r.push(n)),r},Wo=new WeakSet,ip=function(e){switch(e){case"parser":case"script":case"preflight":return e;default:return"other"}},u(ko,Wo),F(ko,"unknownParameter","UNKNOWN");qc.NetworkRequest=ko;mo=ko;function dl(i){let e;return(i==null?void 0:i.type)==="string"?e=btoa(i.value):(i==null?void 0:i.type)==="base64"&&(e=i.value),e}function Lw(i){return(i==null?void 0:i.type)==="string"?i.value.length:(i==null?void 0:i.type)==="base64"?atob(i.value).length:0}Object.defineProperty(Lc,"__esModule",{value:!0});Lc.NetworkStorage=void 0;const qw=Z,Uw=dr,ll=qc,Hw=ge;var ta,sa,ra,pt,cs,na,He,st;class Kw{constructor(e,t,r,n){u(this,He);u(this,ta);u(this,sa);u(this,ra);u(this,pt,new Map);u(this,cs,new Map);u(this,na,"default");f(this,ta,t),f(this,sa,e),r.on("Target.detachedFromTarget",({sessionId:a})=>{this.disposeRequestMap(a)}),f(this,ra,n)}onCdpTargetCreated(e){const t=e.cdpClient,r=[["Network.requestWillBeSent",n=>{const a=this.getRequestById(n.requestId);a&&a.isRedirecting()?(a.handleRedirect(n),this.deleteRequest(n.requestId),w(this,He,st).call(this,n.requestId,e,a.redirectCount+1).onRequestWillBeSentEvent(n)):w(this,He,st).call(this,n.requestId,e).onRequestWillBeSentEvent(n)}],["Network.requestWillBeSentExtraInfo",n=>{w(this,He,st).call(this,n.requestId,e).onRequestWillBeSentExtraInfoEvent(n)}],["Network.responseReceived",n=>{w(this,He,st).call(this,n.requestId,e).onResponseReceivedEvent(n)}],["Network.responseReceivedExtraInfo",n=>{w(this,He,st).call(this,n.requestId,e).onResponseReceivedExtraInfoEvent(n)}],["Network.requestServedFromCache",n=>{w(this,He,st).call(this,n.requestId,e).onServedFromCache()}],["Network.loadingFailed",n=>{w(this,He,st).call(this,n.requestId,e).onLoadingFailedEvent(n)}],["Fetch.requestPaused",n=>{w(this,He,st).call(this,n.networkId??n.requestId,e).onRequestPaused(n)}],["Fetch.authRequired",n=>{let a=this.getRequestByFetchId(n.requestId);a||(a=w(this,He,st).call(this,n.requestId,e)),a.onAuthRequired(n)}]];for(const[n,a]of r)t.on(n,a)}getInterceptionStages(e){const t={request:!1,response:!1,auth:!1};for(const r of s(this,cs).values())r.contexts&&!r.contexts.includes(e)||(t.request||(t.request=r.phases.includes("beforeRequestSent")),t.response||(t.response=r.phases.includes("responseStarted")),t.auth||(t.auth=r.phases.includes("authRequired")));return t}getInterceptsForPhase(e,t){if(e.url===ll.NetworkRequest.unknownParameter)return new Set;const r=new Set;for(const[n,a]of s(this,cs).entries())if(!(!a.phases.includes(t)||a.contexts&&!a.contexts.includes(e.cdpTarget.topLevelId))){if(a.urlPatterns.length===0){r.add(n);continue}for(const o of a.urlPatterns)if((0,Hw.matchUrlPattern)(o,e.url)){r.add(n);break}}return r}disposeRequestMap(e){for(const t of s(this,pt).values())t.cdpClient.sessionId===e&&(s(this,pt).delete(t.id),t.dispose())}addIntercept(e){const t=(0,Uw.uuidv4)();return s(this,cs).set(t,e),t}removeIntercept(e){if(!s(this,cs).has(e))throw new qw.NoSuchInterceptException(`Intercept '${e}' does not exist.`);s(this,cs).delete(e)}getRequestsByTarget(e){const t=[];for(const r of s(this,pt).values())r.cdpTarget===e&&t.push(r);return t}getRequestById(e){return s(this,pt).get(e)}getRequestByFetchId(e){for(const t of s(this,pt).values())if(t.fetchId===e)return t}addRequest(e){s(this,pt).set(e.id,e)}deleteRequest(e){s(this,pt).delete(e)}getNavigationId(e){var t;return e===void 0?null:((t=s(this,ta).findContext(e))==null?void 0:t.navigationId)??null}set defaultCacheBehavior(e){f(this,na,e)}get defaultCacheBehavior(){return s(this,na)}}ta=new WeakMap,sa=new WeakMap,ra=new WeakMap,pt=new WeakMap,cs=new WeakMap,na=new WeakMap,He=new WeakSet,st=function(e,t,r){let n=this.getRequestById(e);return n||(n=new ll.NetworkRequest(e,s(this,sa),this,t,r,s(this,ra)),this.addRequest(n),n)};Lc.NetworkStorage=Kw;var Uc={};Object.defineProperty(Uc,"__esModule",{value:!0});Uc.PreloadScriptStorage=void 0;var zs;class zw{constructor(){u(this,zs,new Set)}find(e){return e?[...s(this,zs)].filter(t=>!!(e.id!==void 0&&e.id===t.id||e.targetId!==void 0&&t.targetIds.has(e.targetId)||e.global!==void 0&&(e.global&&t.contexts===void 0||!e.global&&t.contexts!==void 0))):[...s(this,zs)]}add(e){s(this,zs).add(e)}remove(e){for(const t of this.find(e))s(this,zs).delete(t)}}zs=new WeakMap;Uc.PreloadScriptStorage=zw;var Hc={};Object.defineProperty(Hc,"__esModule",{value:!0});Hc.RealmStorage=void 0;const Ww=Z,Vw=Ua;var Vo,vn;class Gw{constructor(){u(this,Vo,new Map);u(this,vn,new Map)}get knownHandlesToRealmMap(){return s(this,Vo)}addRealm(e){s(this,vn).set(e.realmId,e)}findRealms(e){return Array.from(s(this,vn).values()).filter(t=>!(e.realmId!==void 0&&e.realmId!==t.realmId||e.browsingContextId!==void 0&&!t.associatedBrowsingContexts.map(r=>r.id).includes(e.browsingContextId)||e.sandbox!==void 0&&(!(t instanceof Vw.WindowRealm)||e.sandbox!==t.sandbox)||e.executionContextId!==void 0&&e.executionContextId!==t.executionContextId||e.origin!==void 0&&e.origin!==t.origin||e.type!==void 0&&e.type!==t.realmType||e.cdpSessionId!==void 0&&e.cdpSessionId!==t.cdpClient.sessionId))}findRealm(e){const t=this.findRealms(e);if(t.length===1)return t[0]}getRealm(e){const t=this.findRealm(e);if(t===void 0)throw new Ww.NoSuchFrameException(`Realm ${JSON.stringify(e)} not found`);return t}deleteRealms(e){this.findRealms(e).map(t=>{t.dispose(),s(this,vn).delete(t.realmId),Array.from(this.knownHandlesToRealmMap.entries()).filter(([,r])=>r===t.realmId).map(([r])=>this.knownHandlesToRealmMap.delete(r))})}}Vo=new WeakMap,vn=new WeakMap;Hc.RealmStorage=Gw;var Kc={},zc={};Object.defineProperty(zc,"__esModule",{value:!0});zc.Buffer=void 0;var ia,Ws,aa,Nl;let Xw=(Nl=class{constructor(e,t){u(this,ia);u(this,Ws,[]);u(this,aa);f(this,ia,e),f(this,aa,t)}get(){return s(this,Ws)}add(e){var t;for(s(this,Ws).push(e);s(this,Ws).length>s(this,ia);){const r=s(this,Ws).shift();r!==void 0&&((t=s(this,aa))==null||t.call(this,r))}}},ia=new WeakMap,Ws=new WeakMap,aa=new WeakMap,Nl);zc.Buffer=Xw;var Wc={};Object.defineProperty(Wc,"__esModule",{value:!0});Wc.DefaultMap=void 0;var oa;class Jw extends Map{constructor(t,r){super(r);u(this,oa);f(this,oa,t)}get(t){return this.has(t)||this.set(t,s(this,oa).call(this,t)),super.get(t)}}oa=new WeakMap;Wc.DefaultMap=Jw;var Vc={};Object.defineProperty(Vc,"__esModule",{value:!0});Vc.distinctValues=Yw;Vc.deterministicJSONStringify=ap;function Yw(i){const e=new Map;for(const t of i)e.set(ap(t),t);return Array.from(e.values())}function ap(i){return JSON.stringify(op(i))}function op(i){if(i==null||Array.isArray(i)||typeof i!="object")return i;const e={};for(const t of Object.keys(i).sort()){const r=i[t];e[t]=op(r)}return e}var Gc={};Object.defineProperty(Gc,"__esModule",{value:!0});Gc.IdWrapper=void 0;var Go,ca;const Xo=class Xo{constructor(){u(this,ca);f(this,ca,++Yc(Xo,Go)._)}get id(){return s(this,ca)}};Go=new WeakMap,ca=new WeakMap,u(Xo,Go,0);let Ku=Xo;Gc.IdWrapper=Ku;var Hn={};Object.defineProperty(Hn,"__esModule",{value:!0});Hn.isCdpEvent=cp;Hn.isDeprecatedCdpEvent=up;Hn.assertSupportedEvent=Qw;const Io=Z;function cp(i){var e;return((e=i.split(".").at(0))==null?void 0:e.startsWith(Io.ChromiumBidi.BiDiModule.Cdp))??!1}function up(i){var e;return((e=i.split(".").at(0))==null?void 0:e.startsWith(Io.ChromiumBidi.BiDiModule.DeprecatedCdp))??!1}function Qw(i){if(!Io.ChromiumBidi.EVENT_NAMES.has(i)&&!cp(i)&&!up(i))throw new Io.InvalidArgumentException(`Unknown event: ${i}`)}var Kn={};Object.defineProperty(Kn,"__esModule",{value:!0});Kn.SubscriptionManager=void 0;Kn.cartesianProduct=dp;Kn.unrollEvents=lp;const se=Z,hl=Hn;function dp(...i){return i.reduce((e,t)=>e.flatMap(r=>t.map(n=>[r,n].flat())))}function lp(i){const e=new Set;function t(r){for(const n of r)e.add(n)}for(const r of i)switch(r){case se.ChromiumBidi.BiDiModule.Bluetooth:t(Object.values(se.ChromiumBidi.Bluetooth.EventNames));break;case se.ChromiumBidi.BiDiModule.BrowsingContext:t(Object.values(se.ChromiumBidi.BrowsingContext.EventNames));break;case se.ChromiumBidi.BiDiModule.Log:t(Object.values(se.ChromiumBidi.Log.EventNames));break;case se.ChromiumBidi.BiDiModule.Network:t(Object.values(se.ChromiumBidi.Network.EventNames));break;case se.ChromiumBidi.BiDiModule.Script:t(Object.values(se.ChromiumBidi.Script.EventNames));break;default:e.add(r)}return[...e.values()]}var Jo,Ke,ft,$n,hp,pp;class Zw{constructor(e){u(this,$n);u(this,Jo,0);u(this,Ke,new Map);u(this,ft);f(this,ft,e)}getChannelsSubscribedToEvent(e,t){return Array.from(s(this,Ke).keys()).map(n=>({priority:w(this,$n,hp).call(this,e,t,n),channel:n})).filter(({priority:n})=>n!==null).sort((n,a)=>n.priority-a.priority).map(({channel:n})=>n)}isSubscribedTo(e,t=null){const r=s(this,ft).findTopLevelContextId(t);for(const n of s(this,Ke).values())for(const[a,o]of n.entries())if(!(r!==a&&a!==null)){for(const c of o.keys())if(c===e||c===e.split(".").at(0)||c.split(".").at(0)===e)return!0}return!1}subscribe(e,t,r){switch(t=s(this,ft).findTopLevelContextId(t),e){case se.ChromiumBidi.BiDiModule.BrowsingContext:return Object.values(se.ChromiumBidi.BrowsingContext.EventNames).map(c=>this.subscribe(c,t,r)).flat();case se.ChromiumBidi.BiDiModule.Log:return Object.values(se.ChromiumBidi.Log.EventNames).map(c=>this.subscribe(c,t,r)).flat();case se.ChromiumBidi.BiDiModule.Network:return Object.values(se.ChromiumBidi.Network.EventNames).map(c=>this.subscribe(c,t,r)).flat();case se.ChromiumBidi.BiDiModule.Script:return Object.values(se.ChromiumBidi.Script.EventNames).map(c=>this.subscribe(c,t,r)).flat();case se.ChromiumBidi.BiDiModule.Bluetooth:return Object.values(se.ChromiumBidi.Bluetooth.EventNames).map(c=>this.subscribe(c,t,r)).flat()}s(this,Ke).has(r)||s(this,Ke).set(r,new Map);const n=s(this,Ke).get(r);n.has(t)||n.set(t,new Map);const a=n.get(t),o=(t===null?s(this,ft).getTopLevelContexts().map(c=>c.id):[t]).filter(c=>!this.isSubscribedTo(e,c));return a.has(e)||a.set(e,Yc(this,Jo)._++),o.map(c=>({event:e,contextId:c}))}unsubscribeAll(e,t,r){for(const a of t)a!==null&&s(this,ft).getContext(a);dp(lp(e),t).map(([a,o])=>w(this,$n,pp).call(this,a,o,r)).forEach(a=>a())}unsubscribe(e,t,r){this.unsubscribeAll([e],[t],r)}}Jo=new WeakMap,Ke=new WeakMap,ft=new WeakMap,$n=new WeakSet,hp=function(e,t,r){const n=s(this,Ke).get(r);if(n===void 0)return null;const a=s(this,ft).findTopLevelContextId(t),c=[...new Set([null,a])].map(h=>{var l,p,m;const d=(l=n.get(h))==null?void 0:l.get(e);if((0,hl.isCdpEvent)(e)){const b=(p=n.get(h))==null?void 0:p.get(se.ChromiumBidi.BiDiModule.Cdp);return d&&b?Math.min(d,b):d??b}if((0,hl.isDeprecatedCdpEvent)(e)){const b=(m=n.get(h))==null?void 0:m.get(se.ChromiumBidi.BiDiModule.DeprecatedCdp);return d&&b?Math.min(d,b):d??b}return d}).filter(h=>h!==void 0);return c.length===0?null:Math.min(...c)},pp=function(e,t,r){if(t=s(this,ft).findTopLevelContextId(t),!s(this,Ke).has(r))throw new se.InvalidArgumentException(`Cannot unsubscribe from ${e}, ${t===null?"null":t}. No subscription found.`);const n=s(this,Ke).get(r);if(!n.has(t))throw new se.InvalidArgumentException(`Cannot unsubscribe from ${e}, ${t===null?"null":t}. No subscription found.`);const a=n.get(t);if(!a.has(e))throw new se.InvalidArgumentException(`Cannot unsubscribe from ${e}, ${t===null?"null":t}. No subscription found.`);return()=>{a.delete(e),a.size===0&&n.delete(e),n.size===0&&s(this,Ke).delete(r)}};Kn.SubscriptionManager=Zw;var ti;Object.defineProperty(Kc,"__esModule",{value:!0});Kc.EventManager=void 0;const ey=Z,ty=zc,pl=Wc,sy=Vc,ry=qt,ny=Gc,fl=qn,ml=Hn,iy=Kn;var Yo,ua,da;class ay{constructor(e,t){u(this,Yo,new ny.IdWrapper);u(this,ua);u(this,da);f(this,da,e),f(this,ua,t)}get id(){return s(this,Yo).id}get contextId(){return s(this,ua)}get event(){return s(this,da)}}Yo=new WeakMap,ua=new WeakMap,da=new WeakMap;const to=new Map([[ey.ChromiumBidi.Log.EventNames.LogEntryAdded,100]]);var la,us,Vs,ds,Gs,bn,Xs,si,Ct,fp,zu,Wu;class xd extends ry.EventEmitter{constructor(t){super();u(this,Ct);u(this,la,new pl.DefaultMap(()=>new Set));u(this,us,new Map);u(this,Vs,new Map);u(this,ds);u(this,Gs);u(this,bn);f(this,Gs,t),f(this,ds,new iy.SubscriptionManager(t)),f(this,bn,new pl.DefaultMap(()=>[]))}get subscriptionManager(){return s(this,ds)}addSubscribeHook(t,r){s(this,bn).get(t).push(r)}registerEvent(t,r){this.registerPromiseEvent(Promise.resolve({kind:"success",value:t}),r,t.method)}registerPromiseEvent(t,r,n){const a=new ay(t,r),o=s(this,ds).getChannelsSubscribedToEvent(n,r);w(this,Ct,fp).call(this,a,n);for(const c of o)this.emit("event",{message:fl.OutgoingMessage.createFromPromise(t,c),event:n}),w(this,Ct,zu).call(this,a,c,n)}async subscribe(t,r,n){for(const o of t)(0,ml.assertSupportedEvent)(o);for(const o of r)o!==null&&s(this,Gs).getContext(o);const a=[];for(const o of t)for(const c of r){a.push(...s(this,ds).subscribe(o,c,n));for(const h of w(this,Ct,Wu).call(this,o,c,n))this.emit("event",{message:fl.OutgoingMessage.createFromPromise(h.event,n),event:o}),w(this,Ct,zu).call(this,h,n,o)}(0,sy.distinctValues)(a).forEach(({contextId:o,event:c})=>{s(this,bn).get(c).forEach(h=>h(o))}),await this.toggleModulesIfNeeded()}async unsubscribe(t,r,n){for(const a of t)(0,ml.assertSupportedEvent)(a);s(this,ds).unsubscribeAll(t,r,n),await this.toggleModulesIfNeeded()}async toggleModulesIfNeeded(){await Promise.all(s(this,Gs).getAllContexts().map(async t=>await t.toggleModulesIfNeeded()))}clearBufferedEvents(t){var r;for(const n of to.keys()){const a=w(r=ti,Xs,si).call(r,n,t);s(this,us).delete(a)}}}la=new WeakMap,us=new WeakMap,Vs=new WeakMap,ds=new WeakMap,Gs=new WeakMap,bn=new WeakMap,Xs=new WeakSet,si=function(t,r){return JSON.stringify({eventName:t,browsingContext:r})},Ct=new WeakSet,fp=function(t,r){var a;if(!to.has(r))return;const n=w(a=ti,Xs,si).call(a,r,t.contextId);s(this,us).has(n)||s(this,us).set(n,new ty.Buffer(to.get(r))),s(this,us).get(n).add(t),s(this,la).get(r).add(t.contextId)},zu=function(t,r,n){var h,d;if(!to.has(n))return;const a=w(h=ti,Xs,si).call(h,n,t.contextId),o=Math.max(((d=s(this,Vs).get(a))==null?void 0:d.get(r))??0,t.id),c=s(this,Vs).get(a);c?c.set(r,o):s(this,Vs).set(a,new Map([[r,o]]))},Wu=function(t,r,n){var h,d,l;const a=w(h=ti,Xs,si).call(h,t,r),o=((d=s(this,Vs).get(a))==null?void 0:d.get(n))??-1/0,c=((l=s(this,us).get(a))==null?void 0:l.get().filter(p=>p.id>o))??[];return r===null&&Array.from(s(this,la).get(t).keys()).filter(p=>p!==null&&s(this,Gs).hasContext(p)).map(p=>w(this,Ct,Wu).call(this,t,p,n)).forEach(p=>c.push(...p)),c.sort((p,m)=>p.id-m.id)},u(xd,Xs);Kc.EventManager=xd;ti=xd;Object.defineProperty(hc,"__esModule",{value:!0});hc.BidiServer=void 0;const oy=qt,cy=Te,uy=pc,dy=fc,ly=Dc,hy=Rc,py=$c,fy=Lc,my=Uc,gy=Hc,wy=Kc;var ha,Js,Cn,Ot,Mt,pa,fa,xn,Ys,Qo,Zo,ec,mp;const _d=class _d extends oy.EventEmitter{constructor(t,r,n,a,o,c,h){super();u(this,ec);u(this,ha);u(this,Js);u(this,Cn);u(this,Ot);u(this,Mt,new py.BrowsingContextStorage);u(this,pa,new gy.RealmStorage);u(this,fa,new my.PreloadScriptStorage);u(this,xn);u(this,Ys);u(this,Qo,t=>{s(this,Cn).processCommand(t).catch(r=>{var n;(n=s(this,Ys))==null||n.call(this,cy.LogType.debugError,r)})});u(this,Zo,async t=>{const r=t.message;t.channel!==null&&(r.channel=t.channel),await s(this,Js).sendMessage(r)});f(this,Ys,h),f(this,ha,new uy.ProcessingQueue(s(this,Zo),s(this,Ys))),f(this,Js,t),s(this,Js).setOnMessage(s(this,Qo)),f(this,Ot,new wy.EventManager(s(this,Mt)));const d=new fy.NetworkStorage(s(this,Ot),s(this,Mt),n,h);f(this,xn,new ly.BluetoothProcessor(s(this,Ot),s(this,Mt))),f(this,Cn,new dy.CommandProcessor(r,n,s(this,Ot),s(this,Mt),s(this,pa),s(this,fa),d,s(this,xn),c,async l=>{await n.sendCommand("Security.setIgnoreCertificateErrors",{ignore:l.acceptInsecureCerts??!1}),new hy.CdpTargetManager(r,n,a,s(this,Ot),s(this,Mt),s(this,pa),d,s(this,xn),s(this,fa),o,(l==null?void 0:l["goog:prerenderingDisabled"])??!1,l==null?void 0:l.unhandledPromptBehavior,h),await n.sendCommand("Target.setDiscoverTargets",{discover:!0}),await n.sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0,filter:[{type:"page",exclude:!0},{}]}),await w(this,ec,mp).call(this)},s(this,Ys))),s(this,Ot).on("event",({message:l,event:p})=>{this.emitOutgoingMessage(l,p)}),s(this,Cn).on("response",({message:l,event:p})=>{this.emitOutgoingMessage(l,p)})}static async createAndStart(t,r,n,a,o,c){const[{browserContextIds:h},{targetInfos:d}]=await Promise.all([n.sendCommand("Target.getBrowserContexts"),n.sendCommand("Target.getTargets")]);let l="default";for(const m of d)if(m.browserContextId&&!h.includes(m.browserContextId)){l=m.browserContextId;break}return new _d(t,r,n,a,l,o,c)}emitOutgoingMessage(t,r){s(this,ha).add(t,r)}close(){s(this,Js).close()}};ha=new WeakMap,Js=new WeakMap,Cn=new WeakMap,Ot=new WeakMap,Mt=new WeakMap,pa=new WeakMap,fa=new WeakMap,xn=new WeakMap,Ys=new WeakMap,Qo=new WeakMap,Zo=new WeakMap,ec=new WeakSet,mp=async function(){await Promise.all(s(this,Mt).getTopLevelContexts().map(t=>t.lifecycleLoaded()))};let Vu=_d;hc.BidiServer=Vu;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.OutgoingMessage=i.EventEmitter=i.BidiServer=void 0;var e=hc;Object.defineProperty(i,"BidiServer",{enumerable:!0,get:function(){return e.BidiServer}});var t=qt;Object.defineProperty(i,"EventEmitter",{enumerable:!0,get:function(){return t.EventEmitter}});var r=qn;Object.defineProperty(i,"OutgoingMessage",{enumerable:!0,get:function(){return r.OutgoingMessage}})})(lc);var En,ls,Ft;const Ps=class Ps extends uf{constructor(t,r){super();u(this,En,!1);u(this,ls);u(this,Ft,df.create());F(this,"frame");F(this,"onClose",()=>{Ps.sessions.delete(this.id()),f(this,En,!0)});if(this.frame=t,!this.frame.page().browser().cdpSupported)return;const n=this.frame.page().browser().connection;f(this,ls,n),r?(s(this,Ft).resolve(r),Ps.sessions.set(r,this)):(async()=>{try{const{result:a}=await n.send("cdp.getSession",{context:t._id});s(this,Ft).resolve(a.session),Ps.sessions.set(a.session,this)}catch(a){s(this,Ft).reject(a)}})(),Ps.sessions.set(s(this,Ft).value(),this)}connection(){}async send(t,r,n){if(s(this,ls)===void 0)throw new U("CDP support is required for this feature. The current browser does not support CDP.");if(s(this,En))throw new fd(`Protocol error (${t}): Session closed. Most likely the page has been closed.`);const a=await s(this,Ft).valueOrThrow(),{result:o}=await s(this,ls).send("cdp.sendCommand",{method:t,params:r,session:a},n==null?void 0:n.timeout);return o.result}async detach(){if(!(s(this,ls)===void 0||s(this,ls).closed||s(this,En)))try{await this.frame.client.send("Target.detachFromTarget",{sessionId:this.id()})}finally{this.onClose()}}id(){const t=s(this,Ft).value();return typeof t=="string"?t:""}};En=new WeakMap,ls=new WeakMap,Ft=new WeakMap,F(Ps,"sessions",new Map);let ii=Ps;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const yy=md("puppeteer:webDriverBiDi:SEND ►"),vy=md("puppeteer:webDriverBiDi:RECV ◀");var ma,mt,Sn,ga,Qs,jt,wa;class by extends z{constructor(t,r,n=0,a){super();u(this,ma);u(this,mt);u(this,Sn);u(this,ga,0);u(this,Qs,!1);u(this,jt,new lf);u(this,wa,[]);f(this,ma,t),f(this,Sn,n),f(this,ga,a??18e4),f(this,mt,r),s(this,mt).onmessage=this.onMessage.bind(this),s(this,mt).onclose=this.unbind.bind(this)}get closed(){return s(this,Qs)}get url(){return s(this,ma)}pipeTo(t){s(this,wa).push(t)}emit(t,r){for(const n of s(this,wa))n.emit(t,r);return super.emit(t,r)}send(t,r,n){return Re(!s(this,Qs),"Protocol error: Connection closed."),s(this,jt).create(t,n??s(this,ga),a=>{const o=JSON.stringify({id:a,method:t,params:r});yy(o),s(this,mt).send(o)})}async onMessage(t){var n;s(this,Sn)&&await new Promise(a=>setTimeout(a,s(this,Sn))),vy(t);const r=JSON.parse(t);if("type"in r)switch(r.type){case"success":s(this,jt).resolve(r.id,r);return;case"error":if(r.id===null)break;s(this,jt).reject(r.id,Cy(r),`${r.error}: ${r.message}`);return;case"event":if(xy(r)){(n=ii.sessions.get(r.params.session))==null||n.emit(r.params.event,r.params.params);return}this.emit(r.method,r.params);return}"id"in r&&s(this,jt).reject(r.id,`Protocol Error. Message is not in BiDi protocol format: '${t}'`,r.message),Ie(r)}unbind(){s(this,Qs)||(f(this,Qs,!0),s(this,mt).onmessage=()=>{},s(this,mt).onclose=()=>{},s(this,jt).clear())}dispose(){this.unbind(),s(this,mt).close()}getPendingProtocolErrors(){return s(this,jt).getPendingProtocolErrors()}}ma=new WeakMap,mt=new WeakMap,Sn=new WeakMap,ga=new WeakMap,Qs=new WeakMap,jt=new WeakMap,wa=new WeakMap;function Cy(i){let e=`${i.error} ${i.message}`;return i.stacktrace&&(e+=` ${i.stacktrace}`),e}function xy(i){return i.method.startsWith("cdp.")}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const Ey=(i,...e)=>{md(`bidi:${i}`)(e)};async function Rv(i){const e=new Py,t=new Sy(i),r={send(o){e.emitMessage(JSON.parse(o))},close(){a.close(),t.close(),i.dispose()},onmessage(o){}};e.on("bidiResponse",o=>{r.onmessage(JSON.stringify(o))});const n=new by(i.url(),r,i.delay,i.timeout),a=await lc.BidiServer.createAndStart(e,t,t.browserClient(),"",void 0,Ey);return n}var ya,Zs,er;class Sy{constructor(e){u(this,ya);u(this,Zs,new Map);u(this,er);f(this,ya,e),f(this,er,new gl(e))}browserClient(){return s(this,er)}getCdpClient(e){const t=s(this,ya).session(e);if(!t)throw new Error(`Unknown CDP session with id ${e}`);if(!s(this,Zs).has(t)){const r=new gl(t,e,s(this,er));return s(this,Zs).set(t,r),r}return s(this,Zs).get(t)}close(){s(this,er).close();for(const e of s(this,Zs).values())e.close()}}ya=new WeakMap,Zs=new WeakMap,er=new WeakMap;var Pn,tr,va,ba;class gl extends lc.EventEmitter{constructor(t,r,n){super();u(this,Pn,!1);u(this,tr);F(this,"sessionId");u(this,va);u(this,ba,(t,r)=>{this.emit(t,r)});f(this,tr,t),this.sessionId=r,f(this,va,n),s(this,tr).on("*",s(this,ba))}browserClient(){return s(this,va)}async sendCommand(t,...r){if(!s(this,Pn))try{return await s(this,tr).send(t,...r)}catch(n){if(s(this,Pn))return;throw n}}close(){s(this,tr).off("*",s(this,ba)),f(this,Pn,!0)}isCloseError(t){return t instanceof fd}}Pn=new WeakMap,tr=new WeakMap,va=new WeakMap,ba=new WeakMap;var _n;class Py extends lc.EventEmitter{constructor(){super(...arguments);u(this,_n,async t=>{})}emitMessage(t){s(this,_n).call(this,t)}setOnMessage(t){f(this,_n,t)}async sendMessage(t){this.emit("bidiResponse",t)}close(){f(this,_n,async t=>{})}}_n=new WeakMap;/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var _y=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},ky=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0};let Iy=(()=>{var r,n,a,o,c,h,gp,bo,wp,m;let i=z,e=[],t;return m=class extends i{constructor(C){super();u(this,h);u(this,r,_y(this,e));u(this,n);u(this,a);u(this,o,new bt);u(this,c);f(this,a,C)}static from(C){var v;const y=new m(C);return w(v=y,h,gp).call(v),y}get disposed(){return s(this,o).disposed}get request(){return s(this,r)}get navigation(){return s(this,n)}dispose(){this[ne]()}[(t=[ms],ne)](){s(this,o).dispose(),super[ne]()}},r=new WeakMap,n=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,h=new WeakSet,gp=function(){const C=s(this,o).use(new z(s(this,a)));C.once("closed",()=>{this.emit("failed",{url:s(this,a).url,timestamp:new Date}),this.dispose()}),C.on("request",({request:v})=>{if(v.navigation===void 0||!w(this,h,bo).call(this,v.navigation))return;f(this,r,v),this.emit("request",v),s(this,o).use(new z(s(this,r))).on("redirect",_=>{f(this,r,_)})});const y=s(this,o).use(new z(s(this,h,wp)));y.on("browsingContext.navigationStarted",v=>{v.context!==s(this,a).id||s(this,n)!==void 0||f(this,n,m.from(s(this,a)))});for(const v of["browsingContext.domContentLoaded","browsingContext.load"])y.on(v,N=>{N.context!==s(this,a).id||N.navigation===null||!w(this,h,bo).call(this,N.navigation)||this.dispose()});for(const[v,N]of[["browsingContext.fragmentNavigated","fragment"],["browsingContext.navigationFailed","failed"],["browsingContext.navigationAborted","aborted"]])y.on(v,_=>{_.context!==s(this,a).id||!w(this,h,bo).call(this,_.navigation)||(this.emit(N,{url:_.url,timestamp:new Date(_.timestamp)}),this.dispose())})},bo=function(C){return s(this,n)!==void 0&&!s(this,n).disposed?!1:s(this,c)===void 0?(f(this,c,C),!0):s(this,c)===C},wp=function(){return s(this,a).userContext.browser.session},(()=>{const C=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;ky(m,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:y=>"dispose"in y,get:y=>y.dispose},metadata:C},null,e),C&&Object.defineProperty(m,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:C})})(),m})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Ty=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},Jn=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0},Gu;let Ed=(()=>{var c,h;let i=z,e=[],t,r,n,a,o;return h=class extends i{constructor(p,m){super();u(this,c,Ty(this,e));F(this,"disposables",new bt);F(this,"id");F(this,"origin");F(this,"executionContextId");this.id=p,this.origin=m}get disposed(){return s(this,c)!==void 0}get target(){return{realm:this.id}}dispose(p){f(this,c,p),this[ne]()}async disown(p){await this.session.send("script.disown",{target:this.target,handles:p})}async callFunction(p,m,b={}){const{result:x}=await this.session.send("script.callFunction",{functionDeclaration:p,awaitPromise:m,target:this.target,...b});return x}async evaluate(p,m,b={}){const{result:x}=await this.session.send("script.evaluate",{expression:p,awaitPromise:m,target:this.target,...b});return x}async resolveExecutionContextId(){if(!this.executionContextId){const{result:p}=await this.session.connection.send("cdp.resolveRealm",{realm:this.id});this.executionContextId=p.executionContextId}return this.executionContextId}[(t=[ms],r=[q(p=>s(p,c))],n=[q(p=>s(p,c))],a=[q(p=>s(p,c))],o=[q(p=>s(p,c))],ne)](){s(this,c)??f(this,c,"Realm already destroyed, probably because all associated browsing contexts closed."),this.emit("destroyed",{reason:s(this,c)}),this.disposables.dispose(),super[ne]()}},c=new WeakMap,(()=>{const p=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;Jn(h,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:m=>"dispose"in m,get:m=>m.dispose},metadata:p},null,e),Jn(h,null,r,{kind:"method",name:"disown",static:!1,private:!1,access:{has:m=>"disown"in m,get:m=>m.disown},metadata:p},null,e),Jn(h,null,n,{kind:"method",name:"callFunction",static:!1,private:!1,access:{has:m=>"callFunction"in m,get:m=>m.callFunction},metadata:p},null,e),Jn(h,null,a,{kind:"method",name:"evaluate",static:!1,private:!1,access:{has:m=>"evaluate"in m,get:m=>m.evaluate},metadata:p},null,e),Jn(h,null,o,{kind:"method",name:"resolveExecutionContextId",static:!1,private:!1,access:{has:m=>"resolveExecutionContextId"in m,get:m=>m.resolveExecutionContextId},metadata:p},null,e),p&&Object.defineProperty(h,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:p})})(),h})();var Ca,tc,yp;const kd=class kd extends Ed{constructor(t,r){super("","");u(this,tc);F(this,"browsingContext");F(this,"sandbox");u(this,Ca,new Map);this.browsingContext=t,this.sandbox=r}static from(t,r){var a;const n=new kd(t,r);return w(a=n,tc,yp).call(a),n}get session(){return this.browsingContext.userContext.browser.session}get target(){return{context:this.browsingContext.id,sandbox:this.sandbox}}};Ca=new WeakMap,tc=new WeakSet,yp=function(){this.disposables.use(new z(this.browsingContext)).on("closed",({reason:n})=>{this.dispose(n)});const r=this.disposables.use(new z(this.session));r.on("script.realmCreated",n=>{n.type!=="window"||n.context!==this.browsingContext.id||n.sandbox!==this.sandbox||(this.id=n.realm,this.origin=n.origin,this.executionContextId=void 0,this.emit("updated",this))}),r.on("script.realmCreated",n=>{if(n.type!=="dedicated-worker"||!n.owners.includes(this.id))return;const a=Sd.from(this,n.realm,n.origin);s(this,Ca).set(a.id,a);const o=this.disposables.use(new z(a));o.once("destroyed",()=>{o.removeAllListeners(),s(this,Ca).delete(a.id)}),this.emit("worker",a)})};let Xu=kd;var xa,sc,vp;class Sd extends Ed{constructor(t,r,n){super(r,n);u(this,sc);u(this,xa,new Map);F(this,"owners");this.owners=new Set([t])}static from(t,r,n){var o;const a=new Gu(t,r,n);return w(o=a,sc,vp).call(o),a}get session(){return this.owners.values().next().value.session}}xa=new WeakMap,sc=new WeakSet,vp=function(){const t=this.disposables.use(new z(this.session));t.on("script.realmDestroyed",r=>{r.realm===this.id&&this.dispose("Realm already destroyed.")}),t.on("script.realmCreated",r=>{if(r.type!=="dedicated-worker"||!r.owners.includes(this.id))return;const n=Gu.from(this,r.realm,r.origin);s(this,xa).set(n.id,n),this.disposables.use(new z(n)).once("destroyed",()=>{s(this,xa).delete(n.id)}),this.emit("worker",n)})};Gu=Sd;var Ea,rc,bp;const Id=class Id extends Ed{constructor(t,r,n){super(r,n);u(this,rc);u(this,Ea,new Map);F(this,"browser");this.browser=t}static from(t,r,n){var o;const a=new Id(t,r,n);return w(o=a,rc,bp).call(o),a}get session(){return this.browser.session}};Ea=new WeakMap,rc=new WeakSet,bp=function(){const t=this.disposables.use(new z(this.session));t.on("script.realmDestroyed",r=>{r.realm===this.id&&this.dispose("Realm already destroyed.")}),t.on("script.realmCreated",r=>{if(r.type!=="dedicated-worker"||!r.owners.includes(this.id))return;const n=Sd.from(this,r.realm,r.origin);s(this,Ea).set(n.id,n),this.disposables.use(new z(n)).once("destroyed",()=>{s(this,Ea).delete(n.id)}),this.emit("worker",n)})};let Ju=Id;/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Ny=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},Dy=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0};let Ry=(()=>{var r,n,a,o,c,h,d,Cp,Cs,m;let i=z,e=[],t;return m=class extends i{constructor(C,y){super();u(this,d);u(this,r,Ny(this,e));u(this,n);u(this,a);u(this,o);u(this,c,new bt);u(this,h);f(this,o,C),f(this,h,y)}static from(C,y){var N;const v=new m(C,y);return w(N=v,d,Cp).call(N),v}get disposed(){return s(this,c).disposed}get error(){return s(this,r)}get headers(){return s(this,h).request.headers}get id(){return s(this,h).request.request}get initiator(){return s(this,h).initiator}get method(){return s(this,h).request.method}get navigation(){return s(this,h).navigation??void 0}get redirect(){return s(this,n)}get lastRedirect(){let C=s(this,n);for(;C;){if(C&&!s(C,n))return C;C=s(C,n)}return C}get response(){return s(this,a)}get url(){return s(this,h).request.url}get isBlocked(){return s(this,h).isBlocked}get resourceType(){return s(this,h).request["goog:resourceType"]??void 0}get postData(){return s(this,h).request["goog:postData"]??void 0}get hasPostData(){return s(this,h).request["goog:hasPostData"]??!1}async continueRequest({url:C,method:y,headers:v,cookies:N,body:_}){await s(this,d,Cs).send("network.continueRequest",{request:this.id,url:C,method:y,headers:v,body:_,cookies:N})}async failRequest(){await s(this,d,Cs).send("network.failRequest",{request:this.id})}async provideResponse({statusCode:C,reasonPhrase:y,headers:v,body:N}){await s(this,d,Cs).send("network.provideResponse",{request:this.id,statusCode:C,reasonPhrase:y,headers:v,body:N})}async continueWithAuth(C){C.action==="provideCredentials"?await s(this,d,Cs).send("network.continueWithAuth",{request:this.id,action:C.action,credentials:C.credentials}):await s(this,d,Cs).send("network.continueWithAuth",{request:this.id,action:C.action})}dispose(){this[ne]()}[(t=[ms],ne)](){s(this,c).dispose(),super[ne]()}timing(){return s(this,h).request.timings}},r=new WeakMap,n=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakSet,Cp=function(){s(this,c).use(new z(s(this,o))).once("closed",({reason:v})=>{f(this,r,v),this.emit("error",s(this,r)),this.dispose()});const y=s(this,c).use(new z(s(this,d,Cs)));y.on("network.beforeRequestSent",v=>{v.context!==s(this,o).id||v.request.request!==this.id||v.redirectCount!==s(this,h).redirectCount+1||(f(this,n,m.from(s(this,o),v)),this.emit("redirect",s(this,n)),this.dispose())}),y.on("network.authRequired",v=>{v.context!==s(this,o).id||v.request.request!==this.id||!v.isBlocked||this.emit("authenticate",void 0)}),y.on("network.fetchError",v=>{v.context!==s(this,o).id||v.request.request!==this.id||s(this,h).redirectCount!==v.redirectCount||(f(this,r,v.errorText),this.emit("error",s(this,r)),this.dispose())}),y.on("network.responseCompleted",v=>{v.context!==s(this,o).id||v.request.request!==this.id||s(this,h).redirectCount!==v.redirectCount||(f(this,a,v.response),s(this,h).request.timings=v.request.timings,this.emit("success",s(this,a)),!(s(this,a).status>=300&&s(this,a).status<400)&&this.dispose())})},Cs=function(){return s(this,o).userContext.browser.session},(()=>{const C=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;Dy(m,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:y=>"dispose"in y,get:y=>y.dispose},metadata:C},null,e),C&&Object.defineProperty(m,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:C})})(),m})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Oy=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},wl=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0};let My=(()=>{var n,a,o,c,xp,Yu,l;let i=z,e=[],t,r;return l=class extends i{constructor(b,x){super();u(this,c);u(this,n,Oy(this,e));u(this,a);u(this,o,new bt);F(this,"browsingContext");F(this,"info");this.browsingContext=b,this.info=x}static from(b,x){var y;const C=new l(b,x);return w(y=C,c,xp).call(y),C}get closed(){return s(this,n)!==void 0}get disposed(){return this.closed}get handled(){return this.info.handler==="accept"||this.info.handler==="dismiss"?!0:s(this,a)!==void 0}get result(){return s(this,a)}dispose(b){f(this,n,b),this[ne]()}async handle(b={}){return await s(this,c,Yu).send("browsingContext.handleUserPrompt",{...b,context:this.info.context}),s(this,a)}[(t=[ms],r=[q(b=>s(b,n))],ne)](){s(this,n)??f(this,n,"User prompt already closed, probably because the associated browsing context was destroyed."),this.emit("closed",{reason:s(this,n)}),s(this,o).dispose(),super[ne]()}},n=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakSet,xp=function(){s(this,o).use(new z(this.browsingContext)).once("closed",({reason:C})=>{this.dispose(`User prompt already closed: ${C}`)}),s(this,o).use(new z(s(this,c,Yu))).on("browsingContext.userPromptClosed",C=>{C.context===this.browsingContext.id&&(f(this,a,C),this.emit("handled",C),this.dispose("User prompt already handled."))})},Yu=function(){return this.browsingContext.userContext.browser.session},(()=>{const b=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;wl(l,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:x=>"dispose"in x,get:x=>x.dispose},metadata:b},null,e),wl(l,null,r,{kind:"method",name:"handle",static:!1,private:!1,access:{has:x=>"handle"in x,get:x=>x.handle},metadata:b},null,e),b&&Object.defineProperty(l,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:b})})(),l})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Fy=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},ie=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0};let jy=(()=>{var M,k,j,W,de,ze,Ae,X,Ep,he,Qu,V;let i=z,e=[],t,r,n,a,o,c,h,d,l,p,m,b,x,C,y,v,N,_,T,D,O,E,g,I;return V=class extends i{constructor(P,S,K,Ce,Ze){super();u(this,X);u(this,M,Fy(this,e));u(this,k);u(this,j);u(this,W,new Map);u(this,de,new bt);u(this,ze,new Map);u(this,Ae,new Map);F(this,"defaultRealm");F(this,"id");F(this,"parent");F(this,"userContext");F(this,"originalOpener");f(this,j,Ce),this.id=K,this.parent=S,this.userContext=P,this.originalOpener=Ze,this.defaultRealm=w(this,X,Qu).call(this)}static from(P,S,K,Ce,Ze){var Md;const hr=new V(P,S,K,Ce,Ze);return w(Md=hr,X,Ep).call(Md),hr}get children(){return s(this,W).values()}get closed(){return s(this,k)!==void 0}get disposed(){return this.closed}get realms(){const P=this;return function*(){yield P.defaultRealm,yield*s(P,ze).values()}()}get top(){let P=this;for(let{parent:S}=P;S;{parent:S}=P)P=S;return P}get url(){return s(this,j)}dispose(P){f(this,k,P);for(const S of s(this,W).values())S.dispose("Parent browsing context was disposed");this[ne]()}async activate(){await s(this,X,he).send("browsingContext.activate",{context:this.id})}async captureScreenshot(P={}){const{result:{data:S}}=await s(this,X,he).send("browsingContext.captureScreenshot",{context:this.id,...P});return S}async close(P){await Promise.all([...s(this,W).values()].map(async S=>{await S.close(P)})),await s(this,X,he).send("browsingContext.close",{context:this.id,promptUnload:P})}async traverseHistory(P){await s(this,X,he).send("browsingContext.traverseHistory",{context:this.id,delta:P})}async navigate(P,S){await s(this,X,he).send("browsingContext.navigate",{context:this.id,url:P,wait:S})}async reload(P={}){await s(this,X,he).send("browsingContext.reload",{context:this.id,...P})}async setCacheBehavior(P){await s(this,X,he).send("network.setCacheBehavior",{contexts:[this.id],cacheBehavior:P})}async print(P={}){const{result:{data:S}}=await s(this,X,he).send("browsingContext.print",{context:this.id,...P});return S}async handleUserPrompt(P={}){await s(this,X,he).send("browsingContext.handleUserPrompt",{context:this.id,...P})}async setViewport(P={}){await s(this,X,he).send("browsingContext.setViewport",{context:this.id,...P})}async performActions(P){await s(this,X,he).send("input.performActions",{context:this.id,actions:P})}async releaseActions(){await s(this,X,he).send("input.releaseActions",{context:this.id})}createWindowRealm(P){return w(this,X,Qu).call(this,P)}async addPreloadScript(P,S={}){return await this.userContext.browser.addPreloadScript(P,{...S,contexts:[this]})}async addIntercept(P){const{result:{intercept:S}}=await this.userContext.browser.session.send("network.addIntercept",{...P,contexts:[this.id]});return S}async removePreloadScript(P){await this.userContext.browser.removePreloadScript(P)}async getCookies(P={}){const{result:{cookies:S}}=await s(this,X,he).send("storage.getCookies",{...P,partition:{type:"context",context:this.id}});return S}async setCookie(P){await s(this,X,he).send("storage.setCookie",{cookie:P,partition:{type:"context",context:this.id}})}async setFiles(P,S){await s(this,X,he).send("input.setFiles",{context:this.id,element:P,files:S})}async subscribe(P){await s(this,X,he).subscribe(P,[this.id])}async addInterception(P){await s(this,X,he).subscribe(P,[this.id])}[(t=[ms],r=[q(P=>s(P,k))],n=[q(P=>s(P,k))],a=[q(P=>s(P,k))],o=[q(P=>s(P,k))],c=[q(P=>s(P,k))],h=[q(P=>s(P,k))],d=[q(P=>s(P,k))],l=[q(P=>s(P,k))],p=[q(P=>s(P,k))],m=[q(P=>s(P,k))],b=[q(P=>s(P,k))],x=[q(P=>s(P,k))],C=[q(P=>s(P,k))],y=[q(P=>s(P,k))],v=[q(P=>s(P,k))],N=[q(P=>s(P,k))],_=[q(P=>s(P,k))],T=[q(P=>s(P,k))],D=[q(P=>s(P,k))],O=[q(P=>s(P,k))],E=[q(P=>s(P,k))],ne)](){s(this,k)??f(this,k,"Browsing context already closed, probably because the user context closed."),this.emit("closed",{reason:s(this,k)}),s(this,de).dispose(),super[ne]()}async deleteCookie(...P){await Promise.all(P.map(async S=>{await s(this,X,he).send("storage.deleteCookies",{filter:S,partition:{type:"context",context:this.id}})}))}async locateNodes(P,S){return(await s(this,X,he).send("browsingContext.locateNodes",{context:this.id,locator:P,startNodes:S.length?S:void 0})).result.nodes}},M=new WeakMap,k=new WeakMap,j=new WeakMap,W=new WeakMap,de=new WeakMap,ze=new WeakMap,Ae=new WeakMap,X=new WeakSet,Ep=function(){s(this,de).use(new z(this.userContext)).once("closed",({reason:K})=>{this.dispose(`Browsing context already closed: ${K}`)});const S=s(this,de).use(new z(s(this,X,he)));S.on("browsingContext.contextCreated",K=>{if(K.parent!==this.id)return;const Ce=V.from(this.userContext,this,K.context,K.url,K.originalOpener);s(this,W).set(K.context,Ce);const Ze=s(this,de).use(new z(Ce));Ze.once("closed",()=>{Ze.removeAllListeners(),s(this,W).delete(Ce.id)}),this.emit("browsingcontext",{browsingContext:Ce})}),S.on("browsingContext.contextDestroyed",K=>{K.context===this.id&&this.dispose("Browsing context already closed.")}),S.on("browsingContext.historyUpdated",K=>{K.context===this.id&&(f(this,j,K.url),this.emit("historyUpdated",void 0))}),S.on("browsingContext.domContentLoaded",K=>{K.context===this.id&&(f(this,j,K.url),this.emit("DOMContentLoaded",void 0))}),S.on("browsingContext.load",K=>{K.context===this.id&&(f(this,j,K.url),this.emit("load",void 0))}),S.on("browsingContext.navigationStarted",K=>{if(K.context!==this.id)return;for(const[Ze,hr]of s(this,Ae))hr.disposed&&s(this,Ae).delete(Ze);if(s(this,M)!==void 0&&!s(this,M).disposed)return;f(this,M,Iy.from(this));const Ce=s(this,de).use(new z(s(this,M)));for(const Ze of["fragment","failed","aborted"])Ce.once(Ze,({url:hr})=>{Ce[ne](),f(this,j,hr)});this.emit("navigation",{navigation:s(this,M)})}),S.on("network.beforeRequestSent",K=>{if(K.context!==this.id||s(this,Ae).has(K.request.request))return;const Ce=Ry.from(this,K);s(this,Ae).set(Ce.id,Ce),this.emit("request",{request:Ce})}),S.on("log.entryAdded",K=>{K.source.context===this.id&&this.emit("log",{entry:K})}),S.on("browsingContext.userPromptOpened",K=>{if(K.context!==this.id)return;const Ce=My.from(this,K);this.emit("userprompt",{userPrompt:Ce})})},he=function(){return this.userContext.browser.session},Qu=function(P){const S=Xu.from(this,P);return S.on("worker",K=>{this.emit("worker",{realm:K})}),S},(()=>{const P=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;g=[q(S=>s(S,k))],I=[q(S=>s(S,k))],ie(V,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:S=>"dispose"in S,get:S=>S.dispose},metadata:P},null,e),ie(V,null,r,{kind:"method",name:"activate",static:!1,private:!1,access:{has:S=>"activate"in S,get:S=>S.activate},metadata:P},null,e),ie(V,null,n,{kind:"method",name:"captureScreenshot",static:!1,private:!1,access:{has:S=>"captureScreenshot"in S,get:S=>S.captureScreenshot},metadata:P},null,e),ie(V,null,a,{kind:"method",name:"close",static:!1,private:!1,access:{has:S=>"close"in S,get:S=>S.close},metadata:P},null,e),ie(V,null,o,{kind:"method",name:"traverseHistory",static:!1,private:!1,access:{has:S=>"traverseHistory"in S,get:S=>S.traverseHistory},metadata:P},null,e),ie(V,null,c,{kind:"method",name:"navigate",static:!1,private:!1,access:{has:S=>"navigate"in S,get:S=>S.navigate},metadata:P},null,e),ie(V,null,h,{kind:"method",name:"reload",static:!1,private:!1,access:{has:S=>"reload"in S,get:S=>S.reload},metadata:P},null,e),ie(V,null,d,{kind:"method",name:"setCacheBehavior",static:!1,private:!1,access:{has:S=>"setCacheBehavior"in S,get:S=>S.setCacheBehavior},metadata:P},null,e),ie(V,null,l,{kind:"method",name:"print",static:!1,private:!1,access:{has:S=>"print"in S,get:S=>S.print},metadata:P},null,e),ie(V,null,p,{kind:"method",name:"handleUserPrompt",static:!1,private:!1,access:{has:S=>"handleUserPrompt"in S,get:S=>S.handleUserPrompt},metadata:P},null,e),ie(V,null,m,{kind:"method",name:"setViewport",static:!1,private:!1,access:{has:S=>"setViewport"in S,get:S=>S.setViewport},metadata:P},null,e),ie(V,null,b,{kind:"method",name:"performActions",static:!1,private:!1,access:{has:S=>"performActions"in S,get:S=>S.performActions},metadata:P},null,e),ie(V,null,x,{kind:"method",name:"releaseActions",static:!1,private:!1,access:{has:S=>"releaseActions"in S,get:S=>S.releaseActions},metadata:P},null,e),ie(V,null,C,{kind:"method",name:"createWindowRealm",static:!1,private:!1,access:{has:S=>"createWindowRealm"in S,get:S=>S.createWindowRealm},metadata:P},null,e),ie(V,null,y,{kind:"method",name:"addPreloadScript",static:!1,private:!1,access:{has:S=>"addPreloadScript"in S,get:S=>S.addPreloadScript},metadata:P},null,e),ie(V,null,v,{kind:"method",name:"addIntercept",static:!1,private:!1,access:{has:S=>"addIntercept"in S,get:S=>S.addIntercept},metadata:P},null,e),ie(V,null,N,{kind:"method",name:"removePreloadScript",static:!1,private:!1,access:{has:S=>"removePreloadScript"in S,get:S=>S.removePreloadScript},metadata:P},null,e),ie(V,null,_,{kind:"method",name:"getCookies",static:!1,private:!1,access:{has:S=>"getCookies"in S,get:S=>S.getCookies},metadata:P},null,e),ie(V,null,T,{kind:"method",name:"setCookie",static:!1,private:!1,access:{has:S=>"setCookie"in S,get:S=>S.setCookie},metadata:P},null,e),ie(V,null,D,{kind:"method",name:"setFiles",static:!1,private:!1,access:{has:S=>"setFiles"in S,get:S=>S.setFiles},metadata:P},null,e),ie(V,null,O,{kind:"method",name:"subscribe",static:!1,private:!1,access:{has:S=>"subscribe"in S,get:S=>S.subscribe},metadata:P},null,e),ie(V,null,E,{kind:"method",name:"addInterception",static:!1,private:!1,access:{has:S=>"addInterception"in S,get:S=>S.addInterception},metadata:P},null,e),ie(V,null,g,{kind:"method",name:"deleteCookie",static:!1,private:!1,access:{has:S=>"deleteCookie"in S,get:S=>S.deleteCookie},metadata:P},null,e),ie(V,null,I,{kind:"method",name:"locateNodes",static:!1,private:!1,access:{has:S=>"locateNodes"in S,get:S=>S.locateNodes},metadata:P},null,e),P&&Object.defineProperty(V,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:P})})(),V})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var By=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},vr=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0};let To=(()=>{var h,d,l,p,m,b,Sp,xs;let i=z,e=[],t,r,n,a,o,c;return h=class extends i{constructor(N,_){super();u(this,b);u(this,d,By(this,e));u(this,l,new Map);u(this,p,new bt);u(this,m);F(this,"browser");f(this,m,_),this.browser=N}static create(N,_){var D;const T=new h(N,_);return w(D=T,b,Sp).call(D),T}get browsingContexts(){return s(this,l).values()}get closed(){return s(this,d)!==void 0}get disposed(){return this.closed}get id(){return s(this,m)}dispose(N){f(this,d,N),this[ne]()}async createBrowsingContext(N,_={}){var O;const{result:{context:T}}=await s(this,b,xs).send("browsingContext.create",{type:N,..._,referenceContext:(O=_.referenceContext)==null?void 0:O.id,userContext:s(this,m)}),D=s(this,l).get(T);return Re(D,"The WebDriver BiDi implementation is failing to create a browsing context correctly."),D}async remove(){try{await s(this,b,xs).send("browser.removeUserContext",{userContext:s(this,m)})}finally{this.dispose("User context already closed.")}}async getCookies(N={},_=void 0){const{result:{cookies:T}}=await s(this,b,xs).send("storage.getCookies",{...N,partition:{type:"storageKey",userContext:s(this,m),sourceOrigin:_}});return T}async setCookie(N,_){await s(this,b,xs).send("storage.setCookie",{cookie:N,partition:{type:"storageKey",sourceOrigin:_,userContext:this.id}})}async setPermissions(N,_,T){await s(this,b,xs).send("permissions.setPermission",{origin:N,descriptor:_,state:T,userContext:s(this,m)})}[(t=[ms],r=[q(N=>s(N,d))],n=[q(N=>s(N,d))],a=[q(N=>s(N,d))],o=[q(N=>s(N,d))],c=[q(N=>s(N,d))],ne)](){s(this,d)??f(this,d,"User context already closed, probably because the browser disconnected/closed."),this.emit("closed",{reason:s(this,d)}),s(this,p).dispose(),super[ne]()}},d=new WeakMap,l=new WeakMap,p=new WeakMap,m=new WeakMap,b=new WeakSet,Sp=function(){const N=s(this,p).use(new z(this.browser));N.once("closed",({reason:T})=>{this.dispose(`User context was closed: ${T}`)}),N.once("disconnected",({reason:T})=>{this.dispose(`User context was closed: ${T}`)}),s(this,p).use(new z(s(this,b,xs))).on("browsingContext.contextCreated",T=>{if(T.parent||T.userContext!==s(this,m))return;const D=jy.from(this,void 0,T.context,T.url,T.originalOpener);s(this,l).set(D.id,D);const O=s(this,p).use(new z(D));O.on("closed",()=>{O.removeAllListeners(),s(this,l).delete(D.id)}),this.emit("browsingcontext",{browsingContext:D})})},xs=function(){return this.browser.session},(()=>{const N=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;vr(h,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:_=>"dispose"in _,get:_=>_.dispose},metadata:N},null,e),vr(h,null,r,{kind:"method",name:"createBrowsingContext",static:!1,private:!1,access:{has:_=>"createBrowsingContext"in _,get:_=>_.createBrowsingContext},metadata:N},null,e),vr(h,null,n,{kind:"method",name:"remove",static:!1,private:!1,access:{has:_=>"remove"in _,get:_=>_.remove},metadata:N},null,e),vr(h,null,a,{kind:"method",name:"getCookies",static:!1,private:!1,access:{has:_=>"getCookies"in _,get:_=>_.getCookies},metadata:N},null,e),vr(h,null,o,{kind:"method",name:"setCookie",static:!1,private:!1,access:{has:_=>"setCookie"in _,get:_=>_.setCookie},metadata:N},null,e),vr(h,null,c,{kind:"method",name:"setPermissions",static:!1,private:!1,access:{has:_=>"setPermissions"in _,get:_=>_.setPermissions},metadata:N},null,e),N&&Object.defineProperty(h,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:N})})(),F(h,"DEFAULT","default"),h})();/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var ur,Pp,Zu;class Ka{static deserialize(e){var t,r,n,a;if(!e){Ie("Service did not produce a result.");return}switch(e.type){case"array":return(t=e.value)==null?void 0:t.map(o=>this.deserialize(o));case"set":return(r=e.value)==null?void 0:r.reduce((o,c)=>o.add(this.deserialize(c)),new Set);case"object":return(n=e.value)==null?void 0:n.reduce((o,c)=>{const{key:h,value:d}=w(this,ur,Zu).call(this,c);return o[h]=d,o},{});case"map":return(a=e.value)==null?void 0:a.reduce((o,c)=>{const{key:h,value:d}=w(this,ur,Zu).call(this,c);return o.set(h,d)},new Map);case"promise":return{};case"regexp":return new RegExp(e.value.pattern,e.value.flags);case"date":return new Date(e.value);case"undefined":return;case"null":return null;case"number":return w(this,ur,Pp).call(this,e.value);case"bigint":return BigInt(e.value);case"boolean":return!!e.value;case"string":return e.value}Ie(`Deserialization of type ${e.type} not supported.`)}}ur=new WeakSet,Pp=function(e){switch(e){case"-0":return-0;case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:return e}},Zu=function([e,t]){const r=typeof e=="string"?e:this.deserialize(e),n=this.deserialize(t);return{key:r,value:n}},u(Ka,ur);/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Sa;const Td=class Td extends hf{constructor(t){super(t.info.type,t.info.message,t.info.defaultValue);u(this,Sa);f(this,Sa,t),this.handled=t.handled}static from(t){return new Td(t)}async handle(t){await s(this,Sa).handle({accept:t.accept,userText:t.text})}};Sa=new WeakMap;let ed=Td;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var gt,kn;const Nd=class Nd extends pf{constructor(t,r){super();u(this,gt);F(this,"realm");u(this,kn,!1);f(this,gt,t),this.realm=r}static from(t,r){return new Nd(t,r)}get disposed(){return s(this,kn)}async jsonValue(){return await this.evaluate(t=>t)}asElement(){return null}async dispose(){s(this,kn)||(f(this,kn,!0),await this.realm.destroyHandles([this]))}get isPrimitiveValue(){switch(s(this,gt).type){case"string":case"number":case"bigint":case"boolean":case"undefined":case"null":return!0;default:return!1}}toString(){return this.isPrimitiveValue?"JSHandle:"+Ka.deserialize(s(this,gt)):"JSHandle@"+s(this,gt).type}get id(){return"handle"in s(this,gt)?s(this,gt).handle:void 0}remoteValue(){return s(this,gt)}remoteObject(){throw new U("Not available in WebDriver BiDi")}};gt=new WeakMap,kn=new WeakMap;let or=Nd;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Ay=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},yl=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0},$y=function(i,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(n=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");n&&(r=function(){try{n.call(this)}catch(a){return Promise.reject(a)}}),i.stack.push({value:e,dispose:r,async:t})}else t&&i.stack.push({async:!0});return e},Ly=function(i){return function(e){function t(o){e.error=e.hasError?new i(o,e.error,"An error was suppressed during disposal."):o,e.hasError=!0}var r,n=0;function a(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(o).then(a,function(c){return t(c),a()})}else n|=1}catch(c){t(c)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return a()}}(typeof SuppressedError=="function"?SuppressedError:function(i,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=i,r.suppressed=e,r});let No=(()=>{var n,a;let i=ff,e=[],t,r;return a=class extends i{constructor(h,d){super(or.from(h,d));u(this,n,Ay(this,e))}static from(h,d){return new a(h,d)}get realm(){return this.handle.realm}get frame(){return this.realm.environment}remoteValue(){return this.handle.remoteValue()}async autofill(h){const d=this.frame.client,p=(await d.send("DOM.describeNode",{objectId:this.handle.id})).node.backendNodeId,m=this.frame._id;await d.send("Autofill.trigger",{fieldId:p,frameId:m,card:h.creditCard})}async contentFrame(){const h={stack:[],error:void 0,hasError:!1};try{const l=$y(h,await this.evaluateHandle(p=>{if(p instanceof HTMLIFrameElement||p instanceof HTMLFrameElement)return p.contentWindow}),!1).remoteValue();return l.type==="window"?this.frame.page().frames().find(p=>p._id===l.value.context)??null:null}catch(d){h.error=d,h.hasError=!0}finally{Ly(h)}}async uploadFile(...h){const d=gf.value.path;d&&(h=h.map(l=>d.win32.isAbsolute(l)||d.posix.isAbsolute(l)?l:d.resolve(l))),await this.frame.setFiles(this,h)}async*queryAXTree(h,d){const l=await this.frame.locateNodes(this,{type:"accessibility",value:{role:d,name:h}});return yield*Rl.map(l,p=>Promise.resolve(a.from(p,this.realm)))}async backendNodeId(){if(!this.frame.page().browser().cdpSupported)throw new U;if(s(this,n))return s(this,n);const{node:h}=await this.frame.client.send("DOM.describeNode",{objectId:this.handle.id});return f(this,n,h.backendNodeId),s(this,n)}},n=new WeakMap,(()=>{const h=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;t=[q()],r=[q(),mf],yl(a,null,t,{kind:"method",name:"autofill",static:!1,private:!1,access:{has:d=>"autofill"in d,get:d=>d.autofill},metadata:h},null,e),yl(a,null,r,{kind:"method",name:"contentFrame",static:!1,private:!1,access:{has:d=>"contentFrame"in d,get:d=>d.contentFrame},metadata:h},null,e),h&&Object.defineProperty(a,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h})})(),a})();/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var cu=function(i,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(n=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");n&&(r=function(){try{n.call(this)}catch(a){return Promise.reject(a)}}),i.stack.push({value:e,dispose:r,async:t})}else t&&i.stack.push({async:!0});return e},qy=function(i){return function(e){function t(o){e.error=e.hasError?new i(o,e.error,"An error was suppressed during disposal."):o,e.hasError=!0}var r,n=0;function a(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(o).then(a,function(c){return t(c),a()})}else n|=1}catch(c){t(c)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return a()}}(typeof SuppressedError=="function"?SuppressedError:function(i,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=i,r.suppressed=e,r}),hs,Pa,In,Tn,_a,ka,xt,_p,kp,nc,Ip,Tp;const Dd=class Dd{constructor(e,t,r,n=!1){u(this,xt);u(this,hs);F(this,"name");u(this,Pa);u(this,In);u(this,Tn);u(this,_a,[]);u(this,ka,new bt);u(this,nc,async e=>{const t={stack:[],error:void 0,hasError:!1};try{if(e.channel!==s(this,Tn))return;const r=w(this,xt,Ip).call(this,e.source);if(!r)return;const n=cu(t,or.from(e.data,r),!1),a=cu(t,await n.evaluateHandle(([,,d])=>d),!1),o=cu(t,new bt,!1),c=[];for(const[d,l]of await a.getProperties()){if(o.use(l),l instanceof No){c[+d]=l,o.use(l);continue}c[+d]=l.jsonValue()}let h;try{h=await s(this,Pa).call(this,...await Promise.all(c))}catch(d){try{d instanceof Error?await n.evaluate(([,l],p,m,b)=>{const x=new Error(m);x.name=p,b&&(x.stack=b),l(x)},d.name,d.message,d.stack):await n.evaluate(([,l],p)=>{l(p)},d)}catch(l){Ie(l)}return}try{await n.evaluate(([d],l)=>{d(l)},h)}catch(d){Ie(d)}}catch(r){t.error=r,t.hasError=!0}finally{qy(t)}});f(this,hs,e),this.name=t,f(this,Pa,r),f(this,In,n),f(this,Tn,`__puppeteer__${s(this,hs)._id}_page_exposeFunction_${this.name}`)}static async from(e,t,r,n=!1){var o;const a=new Dd(e,t,r,n);return await w(o=a,xt,_p).call(o),a}[Symbol.dispose](){this[Symbol.asyncDispose]().catch(Ie)}async[Symbol.asyncDispose](){s(this,ka).dispose(),await Promise.all(s(this,_a).map(async([e,t])=>{const r=s(this,In)?e.isolatedRealm():e.mainRealm();try{await Promise.all([r.evaluate(n=>{delete globalThis[n]},this.name),...e.childFrames().map(n=>n.evaluate(a=>{delete globalThis[a]},this.name)),e.browsingContext.removePreloadScript(t)])}catch(n){Ie(n)}}))}};hs=new WeakMap,Pa=new WeakMap,In=new WeakMap,Tn=new WeakMap,_a=new WeakMap,ka=new WeakMap,xt=new WeakSet,_p=async function(){const e=s(this,xt,kp),t={type:"channel",value:{channel:s(this,Tn),ownership:"root"}};s(this,ka).use(new z(e)).on(Z.ChromiumBidi.Script.EventNames.Message,s(this,nc));const n=Ol(wf(o=>{Object.assign(globalThis,{[PLACEHOLDER("name")]:function(...c){return new Promise((h,d)=>{o([h,d,c])})}})},{name:JSON.stringify(this.name)})),a=[s(this,hs)];for(const o of a)a.push(...o.childFrames());await Promise.all(a.map(async o=>{const c=s(this,In)?o.isolatedRealm():o.mainRealm();try{const[h]=await Promise.all([o.browsingContext.addPreloadScript(n,{arguments:[t],sandbox:c.sandbox}),c.realm.callFunction(n,!1,{arguments:[t]})]);s(this,_a).push([o,h])}catch(h){Ie(h)}}))},kp=function(){return s(this,hs).page().browser().connection},nc=new WeakMap,Ip=function(e){const t=w(this,xt,Tp).call(this,e.context);if(t)return t.realm(e.realm)},Tp=function(e){const t=[s(this,hs)];for(const r of t){if(r._id===e)return r;t.push(...r.childFrames())}};let ai=Dd;var Uy=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},Hy=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0};let Ky=(()=>{var r,n,a,o,c,Np,d;let i=vf,e=[],t;return d=class extends i{constructor(m,b,x){super();u(this,c);u(this,r,Uy(this,e));u(this,n);u(this,a);u(this,o,!1);f(this,r,m),f(this,n,b),f(this,o,x);const C=m["goog:securityDetails"];x&&C&&f(this,a,new yf(C))}static from(m,b,x){var y;const C=new d(m,b,x);return w(y=C,c,Np).call(y),C}remoteAddress(){return{ip:"",port:-1}}url(){return s(this,r).url}status(){return s(this,r).status}statusText(){return s(this,r).statusText}headers(){const m={};for(const b of s(this,r).headers)b.value.type==="string"&&(m[b.name.toLowerCase()]=b.value.value);return m}request(){return s(this,n)}fromCache(){return s(this,r).fromCache}timing(){const m=s(this,n).timing();return{requestTime:m.requestTime,proxyStart:-1,proxyEnd:-1,dnsStart:m.dnsStart,dnsEnd:m.dnsEnd,connectStart:m.connectStart,connectEnd:m.connectEnd,sslStart:m.tlsStart,sslEnd:-1,workerStart:-1,workerReady:-1,workerFetchStart:-1,workerRespondWithSettled:-1,workerRouterEvaluationStart:-1,workerCacheLookupStart:-1,sendStart:m.requestStart,sendEnd:-1,pushStart:-1,pushEnd:-1,receiveHeadersStart:m.responseStart,receiveHeadersEnd:m.responseEnd}}frame(){return s(this,n).frame()}fromServiceWorker(){return!1}securityDetails(){if(!s(this,o))throw new U;return s(this,a)??null}content(){throw new U}},r=new WeakMap,n=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakSet,Np=function(){var m,b;s(this,r).fromCache&&(s(this,n)._fromMemoryCache=!0,(m=s(this,n).frame())==null||m.page().trustedEmitter.emit("requestservedfromcache",s(this,n))),(b=s(this,n).frame())==null||b.page().trustedEmitter.emit("response",this)},(()=>{const m=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;t=[bf],Hy(d,null,t,{kind:"method",name:"remoteAddress",static:!1,private:!1,access:{has:b=>"remoteAddress"in b,get:b=>b.remoteAddress},metadata:m},null,e),m&&Object.defineProperty(d,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:m})})(),d})();var td;const Dp=new WeakMap;var sr,Ia,be,ce,Be,Op,sd,rd,nd,Ta,ic;class Rp extends jd{constructor(t,r,n){super();u(this,Be);u(this,sr);u(this,Ia,null);F(this,"id");u(this,be);u(this,ce);u(this,Ta,!1);u(this,ic,async()=>{if(!s(this,be))return;const t=s(this,be).page()._credentials;t&&!s(this,Ta)?(f(this,Ta,!0),s(this,ce).continueWithAuth({action:"provideCredentials",credentials:{type:"password",username:t.username,password:t.password}})):s(this,ce).continueWithAuth({action:"cancel"})});Dp.set(t,this),this.interception.enabled=t.isBlocked,f(this,ce,t),f(this,be,r),f(this,sr,n?s(n,sr):[]),this.id=t.id}static from(t,r,n){var o;const a=new td(t,r,n);return w(o=a,Be,Op).call(o),a}get client(){return s(this,be).client}url(){return s(this,ce).url}resourceType(){if(!s(this,be).page().browser().cdpSupported)throw new U;return(s(this,ce).resourceType||"other").toLowerCase()}method(){return s(this,ce).method}postData(){if(!s(this,be).page().browser().cdpSupported)throw new U;return s(this,ce).postData}hasPostData(){if(!s(this,be).page().browser().cdpSupported)throw new U;return s(this,ce).hasPostData}async fetchPostData(){throw new U}headers(){const t={};for(const r of s(this,ce).headers)t[r.name.toLowerCase()]=r.value.value;return{...t,...s(this,Be,rd),...s(this,Be,nd)}}response(){return s(this,Ia)}failure(){return s(this,ce).error===void 0?null:{errorText:s(this,ce).error}}isNavigationRequest(){return s(this,ce).navigation!==void 0}initiator(){var t;return{...s(this,ce).initiator,type:((t=s(this,ce).initiator)==null?void 0:t.type)??"other"}}redirectChain(){return s(this,sr).slice()}frame(){return s(this,be)}async continue(t,r){return await super.continue({headers:s(this,Be,sd)?this.headers():void 0,...t},r)}async _continue(t={}){const r=vl(t.headers);return this.interception.handled=!0,await s(this,ce).continueRequest({url:t.url,method:t.method,body:t.postData?{type:"base64",value:Cf(t.postData)}:void 0,headers:r.length>0?r:void 0}).catch(n=>(this.interception.handled=!1,xf(n)))}async _abort(){return this.interception.handled=!0,await s(this,ce).failRequest().catch(t=>{throw this.interception.handled=!1,t})}async _respond(t,r){this.interception.handled=!0;let n;t.body&&(n=jd.getResponse(t.body));const a=vl(t.headers),o=a.some(h=>h.name==="content-length");t.contentType&&a.push({name:"content-type",value:{type:"string",value:t.contentType}}),n!=null&&n.contentLength&&!o&&a.push({name:"content-length",value:{type:"string",value:String(n.contentLength)}});const c=t.status||200;return await s(this,ce).provideResponse({statusCode:c,headers:a.length>0?a:void 0,reasonPhrase:Ef[c],body:n!=null&&n.base64?{type:"base64",value:n==null?void 0:n.base64}:void 0}).catch(h=>{throw this.interception.handled=!1,h})}timing(){return s(this,ce).timing()}}sr=new WeakMap,Ia=new WeakMap,be=new WeakMap,ce=new WeakMap,Be=new WeakSet,Op=function(){s(this,ce).on("redirect",t=>{const r=td.from(t,s(this,be),this);s(this,sr).push(this),t.once("success",()=>{s(this,be).page().trustedEmitter.emit("requestfinished",r)}),t.once("error",()=>{s(this,be).page().trustedEmitter.emit("requestfailed",r)}),r.finalizeInterceptions()}),s(this,ce).once("success",t=>{f(this,Ia,Ky.from(t,this,s(this,be).page().browser().cdpSupported))}),s(this,ce).on("authenticate",s(this,ic)),s(this,be).page().trustedEmitter.emit("request",this),s(this,Be,sd)&&this.interception.handlers.push(async()=>{await this.continue({headers:this.headers()},0)})},sd=function(){return!!(Object.keys(s(this,Be,rd)).length||Object.keys(s(this,Be,nd)).length)},rd=function(){var t;return((t=s(this,be))==null?void 0:t.page()._extraHTTPHeaders)??{}},nd=function(){var t;return((t=s(this,be))==null?void 0:t.page()._userAgentHeaders)??{}},Ta=new WeakMap,ic=new WeakMap;td=Rp;function vl(i){const e=[];for(const[t,r]of Object.entries(i??[]))if(!Object.is(r,void 0)){const n=Array.isArray(r)?r:[r];for(const a of n)e.push({name:t.toLowerCase(),value:{type:"string",value:String(a)}})}return e}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class bl extends Error{}var Ln,Fp,jp;class Mp{static serialize(e){switch(typeof e){case"symbol":case"function":throw new bl(`Unable to serializable ${typeof e}`);case"object":return w(this,Ln,jp).call(this,e);case"undefined":return{type:"undefined"};case"number":return w(this,Ln,Fp).call(this,e);case"bigint":return{type:"bigint",value:e.toString()};case"string":return{type:"string",value:e};case"boolean":return{type:"boolean",value:e}}}}Ln=new WeakSet,Fp=function(e){let t;return Object.is(e,-0)?t="-0":Object.is(e,1/0)?t="Infinity":Object.is(e,-1/0)?t="-Infinity":Object.is(e,NaN)?t="NaN":t=e,{type:"number",value:t}},jp=function(e){if(e===null)return{type:"null"};if(Array.isArray(e))return{type:"array",value:e.map(r=>this.serialize(r))};if(Sf(e)){try{JSON.stringify(e)}catch(r){throw r instanceof TypeError&&r.message.startsWith("Converting circular structure to JSON")&&(r.message+=" Recursive objects are not allowed."),r}const t=[];for(const r in e)t.push([this.serialize(r),this.serialize(e[r])]);return{type:"object",value:t}}else{if(Pf(e))return{type:"regexp",value:{pattern:e.source,flags:e.flags}};if(_f(e))return{type:"date",value:e.toISOString()}}throw new bl("Custom object serialization not possible. Use plain objects instead.")},u(Mp,Ln);/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function zy(i){if(i.exception.type!=="error")return Ka.deserialize(i.exception);const[e="",...t]=i.text.split(": "),r=t.join(": "),n=new Error(r);n.name=e;const a=[];if(i.stackTrace&&a.length<Error.stackTraceLimit)for(const o of i.stackTrace.callFrames.reverse()){if(so.isPuppeteerURL(o.url)&&o.url!==so.INTERNAL_URL){const c=so.parse(o.url);a.unshift(`    at ${o.functionName||c.functionName} (${c.functionName} at ${c.siteString}, <anonymous>:${o.lineNumber}:${o.columnNumber})`)}else a.push(`    at ${o.functionName||"<anonymous>"} (${o.url}:${o.lineNumber}:${o.columnNumber})`);if(a.length>=Error.stackTraceLimit)break}return n.stack=[i.text,...a].join(`
`),n}function Bp(i,e){return t=>{throw t instanceof kf?t.message+=` at ${i}`:t instanceof If&&(t.message=`Navigation timeout of ${e} ms exceeded`),t}}var Wy=function(i,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(n=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");n&&(r=function(){try{n.call(this)}catch(a){return Promise.reject(a)}}),i.stack.push({value:e,dispose:r,async:t})}else t&&i.stack.push({async:!0});return e},Vy=function(i){return function(e){function t(o){e.error=e.hasError?new i(o,e.error,"An error was suppressed during disposal."):o,e.hasError=!0}var r,n=0;function a(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(o).then(a,function(c){return t(c),a()})}else n|=1}catch(c){t(c)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return a()}}(typeof SuppressedError=="function"?SuppressedError:function(i,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=i,r.suppressed=e,r}),Na,id;class Ap extends Tf{constructor(t,r){super(r);u(this,Na);F(this,"realm");F(this,"internalPuppeteerUtil");this.realm=t}initialize(){this.realm.on("destroyed",({reason:t})=>{this.taskManager.terminateAll(new Error(t)),this.dispose()}),this.realm.on("updated",()=>{this.internalPuppeteerUtil=void 0,this.taskManager.rerunAll()})}get puppeteerUtil(){const t=Promise.resolve();return Nf.inject(r=>{this.internalPuppeteerUtil&&this.internalPuppeteerUtil.then(n=>{n.dispose()}),this.internalPuppeteerUtil=t.then(()=>this.evaluateHandle(r))},!this.internalPuppeteerUtil),this.internalPuppeteerUtil}async evaluateHandle(t,...r){return await w(this,Na,id).call(this,!1,t,...r)}async evaluate(t,...r){return await w(this,Na,id).call(this,!0,t,...r)}createHandle(t){return(t.type==="node"||t.type==="window")&&this instanceof ar?No.from(t,this):or.from(t,this)}async serializeAsync(t){return t instanceof Bd&&(t=await t.get(this)),this.serialize(t)}serialize(t){if(t instanceof or||t instanceof No){if(t.realm!==this){if(!(t.realm instanceof ar)||!(this instanceof ar))throw new Error("Trying to evaluate JSHandle from different global types. Usually this means you're using a handle from a worker in a page or vice versa.");if(t.realm.environment!==this.environment)throw new Error("Trying to evaluate JSHandle from different frames. Usually this means you're using a handle from a page on a different page.")}if(t.disposed)throw new Error("JSHandle is disposed!");return t.remoteValue()}return Mp.serialize(t)}async destroyHandles(t){if(this.disposed)return;const r=t.map(({id:n})=>n).filter(n=>n!==void 0);r.length!==0&&await this.realm.disown(r).catch(n=>{Ie(n)})}async adoptHandle(t){return await this.evaluateHandle(r=>r,t)}async transferHandle(t){if(t.realm===this)return t;const r=this.adoptHandle(t);return await t.dispose(),await r}}Na=new WeakSet,id=async function(t,r,...n){var l;const a=Df(((l=Rf(r))==null?void 0:l.toString())??so.INTERNAL_URL);let o;const c=t?"none":"root",h=t?{}:{maxObjectDepth:0,maxDomDepth:0};if(Ml(r)){const p=$d.test(r)?r:`${r}
${a}
`;o=this.realm.evaluate(p,!0,{resultOwnership:c,userActivation:!0,serializationOptions:h})}else{let p=Ol(r);p=$d.test(p)?p:`${p}
${a}
`,o=this.realm.callFunction(p,!0,{arguments:n.some(m=>m instanceof Bd)?await Promise.all(n.map(m=>this.serializeAsync(m))):n.map(m=>this.serialize(m)),resultOwnership:c,userActivation:!0,serializationOptions:h})}const d=await o;if("type"in d&&d.type==="exception")throw zy(d.exceptionDetails);return t?Ka.deserialize(d.result):this.createHandle(d.result)};var Nn,ac,$p,Dn;const oc=class oc extends Ap{constructor(t,r){super(t,r.timeoutSettings);u(this,ac);u(this,Nn);u(this,Dn,!1);f(this,Nn,r)}static from(t,r){var a;const n=new oc(t,r);return w(a=n,ac,$p).call(a),n}get puppeteerUtil(){let t=Promise.resolve();return s(this,Dn)||(t=Promise.all([ai.from(this.environment,"__ariaQuerySelector",Ad.queryOne,!!this.sandbox),ai.from(this.environment,"__ariaQuerySelectorAll",async(r,n)=>{const a=Ad.queryAll(r,n);return await r.realm.evaluateHandle((...o)=>o,...await Rl.collect(a))},!!this.sandbox)]),f(this,Dn,!0)),t.then(()=>super.puppeteerUtil)}get sandbox(){return this.realm.sandbox}get environment(){return s(this,Nn)}async adoptBackendNode(t){const r={stack:[],error:void 0,hasError:!1};try{const{object:n}=await s(this,Nn).client.send("DOM.resolveNode",{backendNodeId:t,executionContextId:await this.realm.resolveExecutionContextId()});return await Wy(r,No.from({handle:n.objectId,type:"node"},this),!1).evaluateHandle(o=>o)}catch(n){r.error=n,r.hasError=!0}finally{Vy(r)}}};Nn=new WeakMap,ac=new WeakSet,$p=function(){Fd(oc.prototype,this,"initialize").call(this),this.realm.on("updated",()=>{this.environment.clearDocumentHandle(),f(this,Dn,!1)})},Dn=new WeakMap;let ar=oc;var Da;const Rd=class Rd extends Ap{constructor(t,r){super(t,r.timeoutSettings);u(this,Da);f(this,Da,r)}static from(t,r){const n=new Rd(t,r);return n.initialize(),n}get environment(){return s(this,Da)}async adoptBackendNode(){throw new Error("Cannot adopt DOM nodes into a worker.")}};Da=new WeakMap;let ad=Rd;/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Ra,Oa;const Od=class Od extends Of{constructor(t,r){super(r.origin);u(this,Ra);u(this,Oa);f(this,Ra,t),f(this,Oa,ad.from(r,this))}static from(t,r){return new Od(t,r)}get frame(){return s(this,Ra)}mainRealm(){return s(this,Oa)}get client(){throw new U}};Ra=new WeakMap,Oa=new WeakMap;let od=Od;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Gy=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},bs=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0},Cl=function(i,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(i,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};function Xy(i){switch(i){case"group":return"startGroup";case"groupCollapsed":return"startGroupCollapsed";case"groupEnd":return"endGroup";default:return i}}let Jy=(()=>{var p,m,b,Lp,cd,Co,v,xo,Eo,T;let i=qf,e=[],t,r,n,a,o,c,h,d,l;return T=class extends i{constructor(E,g){super();u(this,b);u(this,p,Gy(this,e));F(this,"browsingContext");u(this,m,new WeakMap);F(this,"realms");F(this,"_id");F(this,"client");F(this,"accessibility");u(this,v,new Map);f(this,p,E),this.browsingContext=g,this._id=g.id,this.client=new ii(this),this.realms={default:ar.from(this.browsingContext.defaultRealm,this),internal:ar.from(this.browsingContext.createWindowRealm(`__puppeteer_internal_${Math.ceil(Math.random()*1e4)}`),this)},this.accessibility=new Mf(this.realms.default,this._id)}static from(E,g){var M;const I=new T(E,g);return w(M=I,b,Lp).call(M),I}get timeoutSettings(){return this.page()._timeoutSettings}mainRealm(){return this.realms.default}isolatedRealm(){return this.realms.internal}realm(E){for(const g of Object.values(this.realms))if(g.realm.id===E)return g}page(){let E=s(this,p);for(;E instanceof T;)E=s(E,p);return E}url(){return this.browsingContext.url}parentFrame(){return s(this,p)instanceof T?s(this,p):null}childFrames(){return[...this.browsingContext.children].map(E=>s(this,m).get(E))}async goto(E,g={}){const[I]=await Promise.all([this.waitForNavigation(g),this.browsingContext.navigate(E,"interactive").catch(M=>{if(!(Fl(M)&&M.message.includes("net::ERR_HTTP_RESPONSE_CODE_FAILURE"))&&!M.message.includes("navigation canceled")&&!M.message.includes("Navigation was aborted by another navigation"))throw M})]).catch(Bp(E,g.timeout??this.timeoutSettings.navigationTimeout()));return I}async setContent(E,g={}){await Promise.all([this.setFrameContent(E),Po(Wa([s(this,b,xo).call(this,g),s(this,b,Eo).call(this,g)]))])}async waitForNavigation(E={}){const{timeout:g=this.timeoutSettings.navigationTimeout(),signal:I}=E,M=this.childFrames().map(k=>{var j;return w(j=k,b,Co).call(j)});return await Po(Wa([Af(et(this.browsingContext,"navigation"),et(this.browsingContext,"historyUpdated").pipe(pr(()=>({navigation:null})))).pipe(Ld()).pipe(Qc(({navigation:k})=>k===null?Ht(null):s(this,b,xo).call(this,E).pipe($f(()=>M.length===0?Ht(void 0):Wa(M)),Ss(et(k,"fragment"),et(k,"failed"),et(k,"aborted").pipe(pr(({url:j})=>{throw new Error(`Navigation aborted: ${j}`)}))),Qc(()=>{if(k.request){let j=function(W){return k===null?Ht(null):W.response||W.error?Ht(k):W.redirect?j(W.redirect):et(W,"success").pipe(Ss(et(W,"error")),Ss(et(W,"redirect"))).pipe(Qc(()=>j(W)))};return j(k.request)}return Ht(k)})))),s(this,b,Eo).call(this,E)]).pipe(pr(([k])=>{if(!k)return null;const j=k.request;if(!j)return null;const W=j.lastRedirect??j;return Dp.get(W).response()}),Ss(So(g),Lf(I),w(this,b,Co).call(this).pipe(pr(()=>{throw new fd("Frame detached.")})))))}waitForDevicePrompt(){throw new U}get detached(){return this.browsingContext.closed}async exposeFunction(E,g){if(s(this,v).has(E))throw new Error(`Failed to add page binding with name ${E}: globalThis['${E}'] already exists!`);const I=await ai.from(this,E,g);s(this,v).set(E,I)}async removeExposedFunction(E){const g=s(this,v).get(E);if(!g)throw new Error(`Failed to remove page binding with name ${E}: window['${E}'] does not exists!`);s(this,v).delete(E),await g[Symbol.asyncDispose]()}async createCDPSession(){if(!this.page().browser().cdpSupported)throw new U;return await this.page().browser().cdpConnection._createSession({targetId:this._id})}async setFiles(E,g){await this.browsingContext.setFiles(E.remoteValue(),g)}async locateNodes(E,g){return await this.browsingContext.locateNodes(g,[E.remoteValue()])}},p=new WeakMap,m=new WeakMap,b=new WeakSet,Lp=function(){for(const E of this.browsingContext.children)w(this,b,cd).call(this,E);this.browsingContext.on("browsingcontext",({browsingContext:E})=>{w(this,b,cd).call(this,E)}),this.browsingContext.on("closed",()=>{for(const E of ii.sessions.values())E.frame===this&&E.onClose();this.page().trustedEmitter.emit("framedetached",this)}),this.browsingContext.on("request",({request:E})=>{const g=Rp.from(E,this);E.once("success",()=>{this.page().trustedEmitter.emit("requestfinished",g)}),E.once("error",()=>{this.page().trustedEmitter.emit("requestfailed",g)}),g.finalizeInterceptions()}),this.browsingContext.on("navigation",({navigation:E})=>{E.once("fragment",()=>{this.page().trustedEmitter.emit("framenavigated",this)})}),this.browsingContext.on("load",()=>{this.page().trustedEmitter.emit("load",void 0)}),this.browsingContext.on("DOMContentLoaded",()=>{this._hasStartedLoading=!0,this.page().trustedEmitter.emit("domcontentloaded",void 0),this.page().trustedEmitter.emit("framenavigated",this)}),this.browsingContext.on("userprompt",({userPrompt:E})=>{this.page().trustedEmitter.emit("dialog",ed.from(E))}),this.browsingContext.on("log",({entry:E})=>{if(this._id===E.source.context)if(Yy(E)){const g=E.args.map(M=>this.mainRealm().createHandle(M)),I=g.reduce((M,k)=>{const j=k instanceof or&&k.isPrimitiveValue?Ka.deserialize(k.remoteValue()):k.toString();return`${M} ${j}`},"").slice(1);this.page().trustedEmitter.emit("console",new Ff(Xy(E.method),I,g,Zy(E.stackTrace),this))}else if(Qy(E)){const g=new Error(E.text??""),I=g.message.split(`
`).length,M=g.stack.split(`
`).splice(0,I),k=[];if(E.stackTrace){for(const j of E.stackTrace.callFrames)if(k.push(`    at ${j.functionName||"<anonymous>"} (${j.url}:${j.lineNumber+1}:${j.columnNumber+1})`),k.length>=Error.stackTraceLimit)break}g.stack=[...M,...k].join(`
`),this.page().trustedEmitter.emit("pageerror",g)}else Ie(`Unhandled LogEntry with type "${E.type}", text "${E.text}" and level "${E.level}"`)}),this.browsingContext.on("worker",({realm:E})=>{const g=od.from(this,E);E.on("destroyed",()=>{this.page().trustedEmitter.emit("workerdestroyed",g)}),this.page().trustedEmitter.emit("workercreated",g)})},cd=function(E){const g=T.from(this,E);return s(this,m).set(E,g),this.page().trustedEmitter.emit("frameattached",g),E.on("closed",()=>{s(this,m).delete(E)}),g},Co=function(){return jf(()=>this.detached?Ht(this):et(this.page().trustedEmitter,"framedetached").pipe(Bf(E=>E===this)))},v=new WeakMap,xo=function(){return o.value},Eo=function(){return h.value},(()=>{const E=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;t=[gs],r=[gs],n=[gs],a=[gs],c=[gs],d=[gs],l=[gs],bs(T,null,t,{kind:"method",name:"goto",static:!1,private:!1,access:{has:g=>"goto"in g,get:g=>g.goto},metadata:E},null,e),bs(T,null,r,{kind:"method",name:"setContent",static:!1,private:!1,access:{has:g=>"setContent"in g,get:g=>g.setContent},metadata:E},null,e),bs(T,null,n,{kind:"method",name:"waitForNavigation",static:!1,private:!1,access:{has:g=>"waitForNavigation"in g,get:g=>g.waitForNavigation},metadata:E},null,e),bs(T,o={value:Cl(function(g={}){let{waitUntil:I="load"}=g;const{timeout:M=this.timeoutSettings.navigationTimeout()}=g;Array.isArray(I)||(I=[I]);const k=new Set;for(const j of I)switch(j){case"load":{k.add("load");break}case"domcontentloaded":{k.add("DOMContentLoaded");break}}return k.size===0?Ht(void 0):Wa([...k].map(j=>et(this.browsingContext,j))).pipe(pr(()=>{}),Ld(),Ss(So(M),w(this,b,Co).call(this).pipe(pr(()=>{throw new Error("Frame detached.")}))))},"#waitForLoad$")},a,{kind:"method",name:"#waitForLoad$",static:!1,private:!0,access:{has:g=>za(b,g),get:g=>s(g,b,xo)},metadata:E},null,e),bs(T,h={value:Cl(function(g={}){let{waitUntil:I="load"}=g;Array.isArray(I)||(I=[I]);let M=1/0;for(const k of I)switch(k){case"networkidle0":{M=Math.min(0,M);break}case"networkidle2":{M=Math.min(2,M);break}}return M===1/0?Ht(void 0):this.page().waitForNetworkIdle$({idleTime:500,timeout:g.timeout??this.timeoutSettings.timeout(),concurrency:M})},"#waitForNetworkIdle$")},c,{kind:"method",name:"#waitForNetworkIdle$",static:!1,private:!0,access:{has:g=>za(b,g),get:g=>s(g,b,Eo)},metadata:E},null,e),bs(T,null,d,{kind:"method",name:"setFiles",static:!1,private:!1,access:{has:g=>"setFiles"in g,get:g=>g.setFiles},metadata:E},null,e),bs(T,null,l,{kind:"method",name:"locateNodes",static:!1,private:!1,access:{has:g=>"locateNodes"in g,get:g=>g.locateNodes},metadata:E},null,e),E&&Object.defineProperty(T,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:E})})(),T})();function Yy(i){return i.type==="console"}function Qy(i){return i.type==="javascript"}function Zy(i){const e=[];if(i)for(const t of i.callFrames)e.push({url:t.url,lineNumber:t.lineNumber,columnNumber:t.columnNumber});return e}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Oe;(function(i){i.None="none",i.Key="key",i.Pointer="pointer",i.Wheel="wheel"})(Oe||(Oe={}));var re;(function(i){i.Pause="pause",i.KeyDown="keyDown",i.KeyUp="keyUp",i.PointerUp="pointerUp",i.PointerDown="pointerDown",i.PointerMove="pointerMove",i.Scroll="scroll"})(re||(re={}));const Yn=i=>{switch(i){case"\r":case`
`:i="Enter";break}if([...i].length===1)return i;switch(i){case"Cancel":return"";case"Help":return"";case"Backspace":return"";case"Tab":return"";case"Clear":return"";case"Enter":return"";case"Shift":case"ShiftLeft":return"";case"Control":case"ControlLeft":return"";case"Alt":case"AltLeft":return"";case"Pause":return"";case"Escape":return"";case"PageUp":return"";case"PageDown":return"";case"End":return"";case"Home":return"";case"ArrowLeft":return"";case"ArrowUp":return"";case"ArrowRight":return"";case"ArrowDown":return"";case"Insert":return"";case"Delete":return"";case"NumpadEqual":return"";case"Numpad0":return"";case"Numpad1":return"";case"Numpad2":return"";case"Numpad3":return"";case"Numpad4":return"";case"Numpad5":return"";case"Numpad6":return"";case"Numpad7":return"";case"Numpad8":return"";case"Numpad9":return"";case"NumpadMultiply":return"";case"NumpadAdd":return"";case"NumpadSubtract":return"";case"NumpadDecimal":return"";case"NumpadDivide":return"";case"F1":return"";case"F2":return"";case"F3":return"";case"F4":return"";case"F5":return"";case"F6":return"";case"F7":return"";case"F8":return"";case"F9":return"";case"F10":return"";case"F11":return"";case"F12":return"";case"Meta":case"MetaLeft":return"";case"ShiftRight":return"";case"ControlRight":return"";case"AltRight":return"";case"MetaRight":return"";case"Digit0":return"0";case"Digit1":return"1";case"Digit2":return"2";case"Digit3":return"3";case"Digit4":return"4";case"Digit5":return"5";case"Digit6":return"6";case"Digit7":return"7";case"Digit8":return"8";case"Digit9":return"9";case"KeyA":return"a";case"KeyB":return"b";case"KeyC":return"c";case"KeyD":return"d";case"KeyE":return"e";case"KeyF":return"f";case"KeyG":return"g";case"KeyH":return"h";case"KeyI":return"i";case"KeyJ":return"j";case"KeyK":return"k";case"KeyL":return"l";case"KeyM":return"m";case"KeyN":return"n";case"KeyO":return"o";case"KeyP":return"p";case"KeyQ":return"q";case"KeyR":return"r";case"KeyS":return"s";case"KeyT":return"t";case"KeyU":return"u";case"KeyV":return"v";case"KeyW":return"w";case"KeyX":return"x";case"KeyY":return"y";case"KeyZ":return"z";case"Semicolon":return";";case"Equal":return"=";case"Comma":return",";case"Minus":return"-";case"Period":return".";case"Slash":return"/";case"Backquote":return"`";case"BracketLeft":return"[";case"Backslash":return"\\";case"BracketRight":return"]";case"Quote":return'"';default:throw new Error(`Unknown key: "${i}"`)}};var Bt;class ev extends Uf{constructor(t){super();u(this,Bt);f(this,Bt,t)}async down(t,r){await s(this,Bt).mainFrame().browsingContext.performActions([{type:Oe.Key,id:"__puppeteer_keyboard",actions:[{type:re.KeyDown,value:Yn(t)}]}])}async up(t){await s(this,Bt).mainFrame().browsingContext.performActions([{type:Oe.Key,id:"__puppeteer_keyboard",actions:[{type:re.KeyUp,value:Yn(t)}]}])}async press(t,r={}){const{delay:n=0}=r,a=[{type:re.KeyDown,value:Yn(t)}];n>0&&a.push({type:re.Pause,duration:n}),a.push({type:re.KeyUp,value:Yn(t)}),await s(this,Bt).mainFrame().browsingContext.performActions([{type:Oe.Key,id:"__puppeteer_keyboard",actions:a}])}async type(t,r={}){const{delay:n=0}=r,a=[...t].map(Yn),o=[];if(n<=0)for(const c of a)o.push({type:re.KeyDown,value:c},{type:re.KeyUp,value:c});else for(const c of a)o.push({type:re.KeyDown,value:c},{type:re.Pause,duration:n},{type:re.KeyUp,value:c});await s(this,Bt).mainFrame().browsingContext.performActions([{type:Oe.Key,id:"__puppeteer_keyboard",actions:o}])}async sendCharacter(t){if([...t].length>1)throw new Error("Cannot send more than 1 character.");await(await s(this,Bt).focusedFrame()).isolatedRealm().evaluate(async n=>{document.execCommand("insertText",!1,n)},t)}}Bt=new WeakMap;const uu=i=>{switch(i){case Kt.Left:return 0;case Kt.Middle:return 1;case Kt.Right:return 2;case Kt.Back:return 3;case Kt.Forward:return 4}};var wt,rr;class tv extends Hf{constructor(t){super();u(this,wt);u(this,rr,{x:0,y:0});f(this,wt,t)}async reset(){f(this,rr,{x:0,y:0}),await s(this,wt).mainFrame().browsingContext.releaseActions()}async move(t,r,n={}){const a=s(this,rr),o={x:Math.round(t),y:Math.round(r)},c=[],h=n.steps??0;for(let d=0;d<h;++d)c.push({type:re.PointerMove,x:a.x+(o.x-a.x)*(d/h),y:a.y+(o.y-a.y)*(d/h),origin:n.origin});c.push({type:re.PointerMove,...o,origin:n.origin}),f(this,rr,o),await s(this,wt).mainFrame().browsingContext.performActions([{type:Oe.Pointer,id:"__puppeteer_mouse",actions:c}])}async down(t={}){await s(this,wt).mainFrame().browsingContext.performActions([{type:Oe.Pointer,id:"__puppeteer_mouse",actions:[{type:re.PointerDown,button:uu(t.button??Kt.Left)}]}])}async up(t={}){await s(this,wt).mainFrame().browsingContext.performActions([{type:Oe.Pointer,id:"__puppeteer_mouse",actions:[{type:re.PointerUp,button:uu(t.button??Kt.Left)}]}])}async click(t,r,n={}){const a=[{type:re.PointerMove,x:Math.round(t),y:Math.round(r),origin:n.origin}],o={type:re.PointerDown,button:uu(n.button??Kt.Left)},c={type:re.PointerUp,button:o.button};for(let h=1;h<(n.count??1);++h)a.push(o,c);a.push(o),n.delay&&a.push({type:re.Pause,duration:n.delay}),a.push(c),await s(this,wt).mainFrame().browsingContext.performActions([{type:Oe.Pointer,id:"__puppeteer_mouse",actions:a}])}async wheel(t={}){await s(this,wt).mainFrame().browsingContext.performActions([{type:Oe.Wheel,id:"__puppeteer_wheel",actions:[{type:re.Scroll,...s(this,rr)??{x:0,y:0},deltaX:t.deltaX??0,deltaY:t.deltaY??0}]}])}drag(){throw new U}dragOver(){throw new U}dragEnter(){throw new U}drop(){throw new U}dragAndDrop(){throw new U}}wt=new WeakMap,rr=new WeakMap;var Ma,Fa,ja,nr,ir,Ba,Rn;class sv{constructor(e,t,r,n,a,o){u(this,Ma,!1);u(this,Fa);u(this,ja);u(this,nr);u(this,ir);u(this,Ba);u(this,Rn);f(this,ir,e),f(this,Ba,t),f(this,Fa,Math.round(n)),f(this,ja,Math.round(a)),f(this,Rn,o),f(this,nr,`__puppeteer_finger_${r}`)}async start(e={}){if(s(this,Ma))throw new zf("Touch has already started");await s(this,ir).mainFrame().browsingContext.performActions([{type:Oe.Pointer,id:s(this,nr),parameters:{pointerType:"touch"},actions:[{type:re.PointerMove,x:s(this,Fa),y:s(this,ja),origin:e.origin},{...s(this,Rn),type:re.PointerDown,button:0}]}]),f(this,Ma,!0)}move(e,t){const r=Math.round(e),n=Math.round(t);return s(this,ir).mainFrame().browsingContext.performActions([{type:Oe.Pointer,id:s(this,nr),parameters:{pointerType:"touch"},actions:[{...s(this,Rn),type:re.PointerMove,x:r,y:n}]}])}async end(){await s(this,ir).mainFrame().browsingContext.performActions([{type:Oe.Pointer,id:s(this,nr),parameters:{pointerType:"touch"},actions:[{type:re.PointerUp,button:0}]}]),s(this,Ba).removeHandle(this)}}Ma=new WeakMap,Fa=new WeakMap,ja=new WeakMap,nr=new WeakMap,ir=new WeakMap,Ba=new WeakMap,Rn=new WeakMap;var Aa;class rv extends Kf{constructor(t){super();u(this,Aa);f(this,Aa,t)}async touchStart(t,r,n={}){const a=this.idGenerator(),o={width:.5*2,height:.5*2,pressure:.5,altitudeAngle:Math.PI/2},c=new sv(s(this,Aa),this,a,t,r,o);return await c.start(n),this.touches.push(c),c}}Aa=new WeakMap;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var nv=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0},xl=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},El=function(i,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(n=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");n&&(r=function(){try{n.call(this)}catch(a){return Promise.reject(a)}}),i.stack.push({value:e,dispose:r,async:t})}else t&&i.stack.push({async:!0});return e},Sl=function(i){return function(e){function t(o){e.error=e.hasError?new i(o,e.error,"An error was suppressed during disposal."):o,e.hasError=!0}var r,n=0;function a(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(o).then(a,function(c){return t(c),a()})}else n|=1}catch(c){t(c)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return a()}}(typeof SuppressedError=="function"?SuppressedError:function(i,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=i,r.suppressed=e,r});let Do=(()=>{var n,a,o,c,h,d,l,p,qp,b,x,C,y,v,ri,ud,dd,D;let i=Qf,e,t=[],r=[];return D=class extends i{constructor(g,I){super();u(this,p);u(this,n,xl(this,t,new z));u(this,a,xl(this,r));u(this,o);u(this,c,null);u(this,h,new Set);F(this,"keyboard");F(this,"mouse");F(this,"touchscreen");F(this,"tracing");F(this,"coverage");u(this,d);u(this,l);F(this,"_userAgentHeaders",{});u(this,b);u(this,x);u(this,C);F(this,"_extraHTTPHeaders",{});u(this,y);F(this,"_credentials",null);u(this,v);f(this,a,g),f(this,o,Jy.from(this,I)),f(this,d,new Wf(s(this,o).client)),this.tracing=new Vf(s(this,o).client),this.coverage=new Gf(s(this,o).client),this.keyboard=new ev(this),this.mouse=new tv(this),this.touchscreen=new rv(this)}static from(g,I){var k;const M=new D(g,I);return w(k=M,p,qp).call(k),M}get trustedEmitter(){return s(this,n)}set trustedEmitter(g){f(this,n,g)}_client(){return s(this,o).client}async setUserAgent(g,I){if(!s(this,a).browser().cdpSupported&&I)throw new U("Current Browser does not support `userAgentMetadata`");if(s(this,a).browser().cdpSupported&&I)return await this._client().send("Network.setUserAgentOverride",{userAgent:g,userAgentMetadata:I});const M=g!=="";g=g??await s(this,a).browser().userAgent(),this._userAgentHeaders=M?{"User-Agent":g}:{},f(this,b,await w(this,p,ri).call(this,["beforeRequestSent"],s(this,b),M));const k=de=>{Object.defineProperty(navigator,"userAgent",{value:de})},j=[s(this,o)];for(const de of j)j.push(...de.childFrames());s(this,x)&&await this.removeScriptToEvaluateOnNewDocument(s(this,x));const[W]=await Promise.all([M?this.evaluateOnNewDocument(k,g):void 0,j.map(de=>de.evaluate(k,g))]);f(this,x,W==null?void 0:W.identifier)}async setBypassCSP(g){await this._client().send("Page.setBypassCSP",{enabled:g})}async queryObjects(g){Re(!g.disposed,"Prototype JSHandle is disposed!"),Re(g.id,"Prototype JSHandle must not be referencing primitive value");const I=await s(this,o).client.send("Runtime.queryObjects",{prototypeObjectId:g.id});return s(this,o).mainRealm().createHandle({type:"array",handle:I.objects.objectId})}browser(){return this.browserContext().browser()}browserContext(){return s(this,a)}mainFrame(){return s(this,o)}async focusedFrame(){const g={stack:[],error:void 0,hasError:!1};try{const M=El(g,await this.mainFrame().isolatedRealm().evaluateHandle(()=>{let j=window;for(;(j.document.activeElement instanceof j.HTMLIFrameElement||j.document.activeElement instanceof j.HTMLFrameElement)&&j.document.activeElement.contentWindow!==null;)j=j.document.activeElement.contentWindow;return j}),!1).remoteValue();Re(M.type==="window");const k=this.frames().find(j=>j._id===M.value.context);return Re(k),k}catch(I){g.error=I,g.hasError=!0}finally{Sl(g)}}frames(){const g=[s(this,o)];for(const I of g)g.push(...I.childFrames());return g}isClosed(){return s(this,o).detached}async close(g){const I={stack:[],error:void 0,hasError:!1};try{const M=El(I,await s(this,a).waitForScreenshotOperations(),!1);try{await s(this,o).browsingContext.close(g==null?void 0:g.runBeforeUnload)}catch{return}}catch(M){I.error=M,I.hasError=!0}finally{Sl(I)}}async reload(g={}){const[I]=await Promise.all([s(this,o).waitForNavigation(g),s(this,o).browsingContext.reload()]).catch(Bp(this.url(),g.timeout??this._timeoutSettings.navigationTimeout()));return I}setDefaultNavigationTimeout(g){this._timeoutSettings.setDefaultNavigationTimeout(g)}setDefaultTimeout(g){this._timeoutSettings.setDefaultTimeout(g)}getDefaultTimeout(){return this._timeoutSettings.timeout()}getDefaultNavigationTimeout(){return this._timeoutSettings.navigationTimeout()}isJavaScriptEnabled(){return s(this,d).javascriptEnabled}async setGeolocation(g){return await s(this,d).setGeolocation(g)}async setJavaScriptEnabled(g){return await s(this,d).setJavaScriptEnabled(g)}async emulateMediaType(g){return await s(this,d).emulateMediaType(g)}async emulateCPUThrottling(g){return await s(this,d).emulateCPUThrottling(g)}async emulateMediaFeatures(g){return await s(this,d).emulateMediaFeatures(g)}async emulateTimezone(g){return await s(this,d).emulateTimezone(g)}async emulateIdleState(g){return await s(this,d).emulateIdleState(g)}async emulateVisionDeficiency(g){return await s(this,d).emulateVisionDeficiency(g)}async setViewport(g){if(!this.browser().cdpSupported){await s(this,o).browsingContext.setViewport({viewport:g!=null&&g.width&&(g!=null&&g.height)?{width:g.width,height:g.height}:null,devicePixelRatio:g!=null&&g.deviceScaleFactor?g.deviceScaleFactor:null}),f(this,c,g);return}const I=await s(this,d).emulateViewport(g);f(this,c,g),I&&await this.reload()}viewport(){return s(this,c)}async pdf(g={}){const{timeout:I=this._timeoutSettings.timeout(),path:M=void 0}=g,{printBackground:k,margin:j,landscape:W,width:de,height:ze,pageRanges:Ae,scale:X,preferCSSPageSize:tf}=Xf(g,"cm"),sf=Ae?Ae.split(", "):[];await Po(qd(this.mainFrame().isolatedRealm().evaluate(()=>document.fonts.ready)).pipe(Ss(So(I))));const rf=await Po(qd(s(this,o).browsingContext.print({background:k,margin:j,orientation:W?"landscape":"portrait",page:{width:de,height:ze},pageRanges:sf,scale:X,shrinkToFit:!tf})).pipe(Ss(So(I)))),V=Jf(rf,!0);return await this._maybeWriteTypedArrayToFile(M,V),V}async createPDFStream(g){const I=await this.pdf(g);return new ReadableStream({start(M){M.enqueue(I),M.close()}})}async _screenshot(g){const{clip:I,type:M,captureBeyondViewport:k,quality:j}=g;if(g.omitBackground!==void 0&&g.omitBackground)throw new U("BiDi does not support 'omitBackground'.");if(g.optimizeForSpeed!==void 0&&g.optimizeForSpeed)throw new U("BiDi does not support 'optimizeForSpeed'.");if(g.fromSurface!==void 0&&!g.fromSurface)throw new U("BiDi does not support 'fromSurface'.");if(I!==void 0&&I.scale!==void 0&&I.scale!==1)throw new U("BiDi does not support 'scale' in 'clip'.");let W;if(I)if(k)W=I;else{const[ze,Ae]=await this.evaluate(()=>{if(!window.visualViewport)throw new Error("window.visualViewport is not supported.");return[window.visualViewport.pageLeft,window.visualViewport.pageTop]});W={...I,x:I.x-ze,y:I.y-Ae}}return await s(this,o).browsingContext.captureScreenshot({origin:k?"document":"viewport",format:{type:`image/${M}`,...j!==void 0?{quality:j/100}:{}},...W?{clip:{type:"box",...W}}:{}})}async createCDPSession(){return await s(this,o).createCDPSession()}async bringToFront(){await s(this,o).browsingContext.activate()}async evaluateOnNewDocument(g,...I){const M=iv(g,...I);return{identifier:await s(this,o).browsingContext.addPreloadScript(M)}}async removeScriptToEvaluateOnNewDocument(g){await s(this,o).browsingContext.removePreloadScript(g)}async exposeFunction(g,I){return await this.mainFrame().exposeFunction(g,"default"in I?I.default:I)}isDragInterceptionEnabled(){return!1}async setCacheEnabled(g){if(!s(this,a).browser().cdpSupported){await s(this,o).browsingContext.setCacheBehavior(g?"default":"bypass");return}await this._client().send("Network.setCacheDisabled",{cacheDisabled:!g})}async cookies(...g){const I=(g.length?g:[this.url()]).map(k=>new URL(k));return(await s(this,o).browsingContext.getCookies()).map(k=>Up(k)).filter(k=>I.some(j=>cv(k,j)))}isServiceWorkerBypassed(){throw new U}target(){throw new U}waitForFileChooser(){throw new U}workers(){return[...s(this,h)]}async setRequestInterception(g){f(this,C,await w(this,p,ri).call(this,["beforeRequestSent"],s(this,C),g))}async setExtraHTTPHeaders(g){const I={};for(const[M,k]of Object.entries(g))Re(Ml(k),`Expected value of header "${M}" to be String, but "${typeof k}" is found.`),I[M.toLowerCase()]=k;this._extraHTTPHeaders=I,f(this,y,await w(this,p,ri).call(this,["beforeRequestSent"],s(this,y),!!Object.keys(this._extraHTTPHeaders).length))}async authenticate(g){f(this,v,await w(this,p,ri).call(this,["authRequired"],s(this,v),!!g)),this._credentials=g}setDragInterception(){throw new U}setBypassServiceWorker(){throw new U}async setOfflineMode(g){if(!s(this,a).browser().cdpSupported)throw new U;return s(this,l)||f(this,l,{offline:!1,upload:-1,download:-1,latency:0}),s(this,l).offline=g,await w(this,p,ud).call(this)}async emulateNetworkConditions(g){if(!s(this,a).browser().cdpSupported)throw new U;return s(this,l)||f(this,l,{offline:!1,upload:-1,download:-1,latency:0}),s(this,l).upload=g?g.upload:-1,s(this,l).download=g?g.download:-1,s(this,l).latency=g?g.latency:0,await w(this,p,ud).call(this)}async setCookie(...g){const I=this.url(),M=I.startsWith("http");for(const k of g){let j=k.url||"";!j&&M&&(j=I),Re(j!=="about:blank",`Blank page can not have cookie "${k.name}"`),Re(!String.prototype.startsWith.call(j||"","data:"),`Data URL page can not have cookie "${k.name}"`),Re(k.partitionKey===void 0||typeof k.partitionKey=="string","BiDi only allows domain partition keys");const W=URL.canParse(j)?new URL(j):void 0,de=k.domain??(W==null?void 0:W.hostname);Re(de!==void 0,"At least one of the url and domain needs to be specified");const ze={domain:de,name:k.name,value:{type:"string",value:k.value},...k.path!==void 0?{path:k.path}:{},...k.httpOnly!==void 0?{httpOnly:k.httpOnly}:{},...k.secure!==void 0?{secure:k.secure}:{},...k.sameSite!==void 0?{sameSite:Kp(k.sameSite)}:{},expiry:zp(k.expires),...Hp(k,"sameParty","sourceScheme","priority","url")};k.partitionKey!==void 0?await this.browserContext().userContext.setCookie(ze,k.partitionKey):await s(this,o).browsingContext.setCookie(ze)}}async deleteCookie(...g){await Promise.all(g.map(async I=>{const M=I.url??this.url(),k=URL.canParse(M)?new URL(M):void 0,j=I.domain??(k==null?void 0:k.hostname);Re(j!==void 0,"At least one of the url and domain needs to be specified");const W={domain:j,name:I.name,...I.path!==void 0?{path:I.path}:{}};await s(this,o).browsingContext.deleteCookie(W)}))}async removeExposedFunction(g){await s(this,o).removeExposedFunction(g)}metrics(){throw new U}async goBack(g={}){return await w(this,p,dd).call(this,-1,g)}async goForward(g={}){return await w(this,p,dd).call(this,1,g)}waitForDevicePrompt(){throw new U}},n=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap,l=new WeakMap,p=new WeakSet,qp=function(){s(this,o).browsingContext.on("closed",()=>{this.trustedEmitter.emit("close",void 0),this.trustedEmitter.removeAllListeners()}),this.trustedEmitter.on("workercreated",g=>{s(this,h).add(g)}),this.trustedEmitter.on("workerdestroyed",g=>{s(this,h).delete(g)})},b=new WeakMap,x=new WeakMap,C=new WeakMap,y=new WeakMap,v=new WeakMap,ri=async function(g,I,M){if(M&&!I)return await s(this,o).browsingContext.addIntercept({phases:g});if(!M&&I){await s(this,o).browsingContext.userContext.browser.removeIntercept(I);return}return I},ud=async function(){s(this,l)&&await this._client().send("Network.emulateNetworkConditions",{offline:s(this,l).offline,latency:s(this,l).latency,uploadThroughput:s(this,l).upload,downloadThroughput:s(this,l).download})},dd=async function(g,I){const M=new AbortController;try{const[k]=await Promise.all([this.waitForNavigation({...I,signal:M.signal}),s(this,o).browsingContext.traverseHistory(g)]);return k}catch(k){if(M.abort(),Fl(k)&&k.message.includes("no such history entry"))return null;throw k}},(()=>{const g=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;e=[cc()],nv(D,null,e,{kind:"accessor",name:"trustedEmitter",static:!1,private:!1,access:{has:I=>"trustedEmitter"in I,get:I=>I.trustedEmitter,set:(I,M)=>{I.trustedEmitter=M}},metadata:g},t,r),g&&Object.defineProperty(D,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:g})})(),D})();function iv(i,...e){return`() => {${Yf(i,...e)}}`}function av(i,e){const t=i.domain.toLowerCase(),r=e.hostname.toLowerCase();return t===r?!0:t.startsWith(".")&&r.endsWith(t)}function ov(i,e){const t=e.pathname,r=i.path;return!!(t===r||t.startsWith(r)&&(r.endsWith("/")||t[r.length]==="/"))}function cv(i,e){const t=new URL(e);return Re(i!==void 0),av(i,t)?ov(i,t):!1}function Up(i,e=!1){const t=i[Ro+"partitionKey"];function r(){return typeof t=="string"?{partitionKey:t}:typeof t=="object"&&t!==null?e?{partitionKey:{sourceOrigin:t.topLevelSite,hasCrossSiteAncestor:t.hasCrossSiteAncestor??!1}}:{partitionKey:t.topLevelSite}:{}}return{name:i.name,value:i.value.value,domain:i.domain,path:i.path,size:i.size,httpOnly:i.httpOnly,secure:i.secure,sameSite:dv(i.sameSite),expires:i.expiry??-1,session:i.expiry===void 0||i.expiry<=0,...uv(i,"sameParty","sourceScheme","partitionKeyOpaque","priority"),...r()}}const Ro="goog:";function uv(i,...e){const t={};for(const r of e)i[Ro+r]!==void 0&&(t[r]=i[Ro+r]);return t}function Hp(i,...e){const t={};for(const r of e)i[r]!==void 0&&(t[Ro+r]=i[r]);return t}function dv(i){return i==="strict"?"Strict":i==="lax"?"Lax":"None"}function Kp(i){return i==="Strict"?"strict":i==="Lax"?"lax":"none"}function zp(i){return[void 0,-1].includes(i)?void 0:i}function lv(i){if(i===void 0||typeof i=="string")return i;if(i.hasCrossSiteAncestor)throw new U("WebDriver BiDi does not support `hasCrossSiteAncestor` yet.");return i.sourceOrigin}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var On;class hv extends uc{constructor(t){super();u(this,On);f(this,On,t)}asPage(){throw new U}url(){return""}createCDPSession(){throw new U}type(){return dc.BROWSER}browser(){return s(this,On)}browserContext(){return s(this,On).defaultBrowserContext()}opener(){throw new U}}On=new WeakMap;var At;class pv extends uc{constructor(t){super();u(this,At);f(this,At,t)}async page(){return s(this,At)}async asPage(){return Do.from(this.browserContext(),s(this,At).mainFrame().browsingContext)}url(){return s(this,At).url()}createCDPSession(){return s(this,At).createCDPSession()}type(){return dc.PAGE}browser(){return this.browserContext().browser()}browserContext(){return s(this,At).browserContext()}opener(){throw new U}}At=new WeakMap;var $t,Mn;class fv extends uc{constructor(t){super();u(this,$t);u(this,Mn);f(this,$t,t)}async page(){return s(this,Mn)===void 0&&f(this,Mn,Do.from(this.browserContext(),s(this,$t).browsingContext)),s(this,Mn)}async asPage(){return Do.from(this.browserContext(),s(this,$t).browsingContext)}url(){return s(this,$t).url()}createCDPSession(){return s(this,$t).createCDPSession()}type(){return dc.PAGE}browser(){return this.browserContext().browser()}browserContext(){return s(this,$t).page().browserContext()}opener(){throw new U}}$t=new WeakMap,Mn=new WeakMap;var Fn;class mv extends uc{constructor(t){super();u(this,Fn);f(this,Fn,t)}async page(){throw new U}async asPage(){throw new U}url(){return s(this,Fn).url()}createCDPSession(){throw new U}type(){return dc.OTHER}browser(){return this.browserContext().browser()}browserContext(){return s(this,Fn).frame.page().browserContext()}opener(){throw new U}}Fn=new WeakMap;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var gv=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0},Pl=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},wv=function(i,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(n=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");n&&(r=function(){try{n.call(this)}catch(a){return Promise.reject(a)}}),i.stack.push({value:e,dispose:r,async:t})}else t&&i.stack.push({async:!0});return e},yv=function(i){return function(e){function t(o){e.error=e.hasError?new i(o,e.error,"An error was suppressed during disposal."):o,e.hasError=!0}var r,n=0;function a(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(o).then(a,function(c){return t(c),a()})}else n|=1}catch(c){t(c)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return a()}}(typeof SuppressedError=="function"?SuppressedError:function(i,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=i,r.suppressed=e,r});let vv=(()=>{var n,a,o,c,h,d,l,Wp,ld,b;let i=Zf,e,t=[],r=[];return b=class extends i{constructor(y,v,N){super();u(this,l);u(this,n,Pl(this,t,new z));u(this,a,Pl(this,r));u(this,o);F(this,"userContext");u(this,c,new WeakMap);u(this,h,new Map);u(this,d,[]);f(this,a,y),this.userContext=v,f(this,o,N.defaultViewport)}static from(y,v,N){var T;const _=new b(y,v,N);return w(T=_,l,Wp).call(T),_}get trustedEmitter(){return s(this,n)}set trustedEmitter(y){f(this,n,y)}targets(){return[...s(this,h).values()].flatMap(([y,v])=>[y,...v.values()])}async newPage(){const y={stack:[],error:void 0,hasError:!1};try{const v=wv(y,await this.waitForScreenshotOperations(),!1),N=await this.userContext.createBrowsingContext("tab"),_=s(this,c).get(N);if(!_)throw new Error("Page is not found");if(s(this,o))try{await _.setViewport(s(this,o))}catch{}return _}catch(v){y.error=v,y.hasError=!0}finally{yv(y)}}async close(){Re(this.userContext.id!==To.DEFAULT,"Default BrowserContext cannot be closed!");try{await this.userContext.remove()}catch(y){Ie(y)}s(this,h).clear()}browser(){return s(this,a)}async pages(){return[...this.userContext.browsingContexts].map(y=>s(this,c).get(y))}async overridePermissions(y,v){const N=new Set(v.map(_=>{if(!Ud.get(_))throw new Error("Unknown permission: "+_);return _}));await Promise.all(Array.from(Ud.keys()).map(_=>{const T=this.userContext.setPermissions(y,{name:_},N.has(_)?"granted":"denied");return s(this,d).push({origin:y,permission:_}),N.has(_)?T:T.catch(Ie)}))}async clearPermissionOverrides(){const y=s(this,d).map(({permission:v,origin:N})=>this.userContext.setPermissions(N,{name:v},"prompt").catch(Ie));f(this,d,[]),await Promise.all(y)}get id(){if(this.userContext.id!==To.DEFAULT)return this.userContext.id}async cookies(){return(await this.userContext.getCookies()).map(v=>Up(v,!0))}async setCookie(...y){await Promise.all(y.map(async v=>{const N={domain:v.domain,name:v.name,value:{type:"string",value:v.value},...v.path!==void 0?{path:v.path}:{},...v.httpOnly!==void 0?{httpOnly:v.httpOnly}:{},...v.secure!==void 0?{secure:v.secure}:{},...v.sameSite!==void 0?{sameSite:Kp(v.sameSite)}:{},expiry:zp(v.expires),...Hp(v,"sameParty","sourceScheme","priority","url")};return await this.userContext.setCookie(N,lv(v.partitionKey))}))}},n=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap,l=new WeakSet,Wp=function(){for(const y of this.userContext.browsingContexts)w(this,l,ld).call(this,y);this.userContext.on("browsingcontext",({browsingContext:y})=>{const v=w(this,l,ld).call(this,y);if(y.originalOpener)for(const N of this.userContext.browsingContexts)N.id===y.originalOpener&&s(this,c).get(N).trustedEmitter.emit("popup",v)}),this.userContext.on("closed",()=>{this.trustedEmitter.removeAllListeners()})},ld=function(y){const v=Do.from(this,y);s(this,c).set(y,v),v.trustedEmitter.on("close",()=>{s(this,c).delete(y)});const N=new pv(v),_=new Map;return s(this,h).set(v,[N,_]),v.trustedEmitter.on("frameattached",T=>{const D=T,O=new fv(D);_.set(D,O),this.trustedEmitter.emit("targetcreated",O)}),v.trustedEmitter.on("framenavigated",T=>{const D=T,O=_.get(D);O===void 0?this.trustedEmitter.emit("targetchanged",N):this.trustedEmitter.emit("targetchanged",O)}),v.trustedEmitter.on("framedetached",T=>{const D=T,O=_.get(D);O!==void 0&&(_.delete(D),this.trustedEmitter.emit("targetdestroyed",O))}),v.trustedEmitter.on("workercreated",T=>{const D=T,O=new mv(D);_.set(D,O),this.trustedEmitter.emit("targetcreated",O)}),v.trustedEmitter.on("workerdestroyed",T=>{const D=T,O=_.get(D);O!==void 0&&(_.delete(T),this.trustedEmitter.emit("targetdestroyed",O))}),v.trustedEmitter.on("close",()=>{s(this,h).delete(v),this.trustedEmitter.emit("targetdestroyed",N)}),this.trustedEmitter.emit("targetcreated",N),v},(()=>{const y=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;e=[cc()],gv(b,null,e,{kind:"accessor",name:"trustedEmitter",static:!1,private:!1,access:{has:v=>"trustedEmitter"in v,get:v=>v.trustedEmitter,set:(v,N)=>{v.trustedEmitter=N}},metadata:y},t,r),y&&Object.defineProperty(b,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:y})})(),b})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var bv=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},br=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0},Cv=function(i,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(n=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");n&&(r=function(){try{n.call(this)}catch(a){return Promise.reject(a)}}),i.stack.push({value:e,dispose:r,async:t})}else t&&i.stack.push({async:!0});return e},xv=function(i){return function(e){function t(o){e.error=e.hasError?new i(o,e.error,"An error was suppressed during disposal."):o,e.hasError=!0}var r,n=0;function a(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(o).then(a,function(c){return t(c),a()})}else n|=1}catch(c){t(c)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return a()}}(typeof SuppressedError=="function"?SuppressedError:function(i,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=i,r.suppressed=e,r});let Ev=(()=>{var h,d,l,p,m,b,Vp,Gp,Xp,hd,N;let i=z,e=[],t,r,n,a,o,c;return N=class extends i{constructor(D){super();u(this,b);u(this,h,(bv(this,e),!1));u(this,d);u(this,l,new bt);u(this,p,new Map);F(this,"session");u(this,m,new Map);this.session=D}static async from(D){var E;const O=new N(D);return await w(E=O,b,Vp).call(E),O}get closed(){return s(this,h)}get defaultUserContext(){return s(this,p).get(To.DEFAULT)}get disconnected(){return s(this,d)!==void 0}get disposed(){return this.disconnected}get userContexts(){return s(this,p).values()}dispose(D,O=!1){f(this,h,O),f(this,d,D),this[ne]()}async close(){try{await this.session.send("browser.close",{})}finally{this.dispose("Browser already closed.",!0)}}async addPreloadScript(D,O={}){var g;const{result:{script:E}}=await this.session.send("script.addPreloadScript",{functionDeclaration:D,...O,contexts:(g=O.contexts)==null?void 0:g.map(I=>I.id)});return E}async removeIntercept(D){await this.session.send("network.removeIntercept",{intercept:D})}async removePreloadScript(D){await this.session.send("script.removePreloadScript",{script:D})}async createUserContext(){const{result:{userContext:D}}=await this.session.send("browser.createUserContext",{});return w(this,b,hd).call(this,D)}[(t=[ms],r=[q(D=>s(D,d))],n=[q(D=>s(D,d))],a=[q(D=>s(D,d))],o=[q(D=>s(D,d))],c=[q(D=>s(D,d))],ne)](){s(this,d)??f(this,d,"Browser was disconnected, probably because the session ended."),this.closed&&this.emit("closed",{reason:s(this,d)}),this.emit("disconnected",{reason:s(this,d)}),s(this,l).dispose(),super[ne]()}},h=new WeakMap,d=new WeakMap,l=new WeakMap,p=new WeakMap,m=new WeakMap,b=new WeakSet,Vp=async function(){const D=s(this,l).use(new z(this.session));D.once("ended",({reason:O})=>{this.dispose(O)}),D.on("script.realmCreated",O=>{O.type==="shared-worker"&&s(this,m).set(O.realm,Ju.from(this,O.realm,O.origin))}),await w(this,b,Gp).call(this),await w(this,b,Xp).call(this)},Gp=async function(){const{result:{userContexts:D}}=await this.session.send("browser.getUserContexts",{});for(const O of D)w(this,b,hd).call(this,O.userContext)},Xp=async function(){const D=new Set;let O;{const E={stack:[],error:void 0,hasError:!1};try{Cv(E,new z(this.session),!1).on("browsingContext.contextCreated",M=>{D.add(M.context)});const{result:I}=await this.session.send("browsingContext.getTree",{});O=I.contexts}catch(g){E.error=g,E.hasError=!0}finally{xv(E)}}for(const E of O)D.has(E.context)||this.session.emit("browsingContext.contextCreated",E),E.children&&O.push(...E.children)},hd=function(D){const O=To.create(this,D);s(this,p).set(O.id,O);const E=s(this,l).use(new z(O));return E.once("closed",()=>{E.removeAllListeners(),s(this,p).delete(O.id)}),O},(()=>{const D=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;br(N,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:O=>"dispose"in O,get:O=>O.dispose},metadata:D},null,e),br(N,null,r,{kind:"method",name:"close",static:!1,private:!1,access:{has:O=>"close"in O,get:O=>O.close},metadata:D},null,e),br(N,null,n,{kind:"method",name:"addPreloadScript",static:!1,private:!1,access:{has:O=>"addPreloadScript"in O,get:O=>O.addPreloadScript},metadata:D},null,e),br(N,null,a,{kind:"method",name:"removeIntercept",static:!1,private:!1,access:{has:O=>"removeIntercept"in O,get:O=>O.removeIntercept},metadata:D},null,e),br(N,null,o,{kind:"method",name:"removePreloadScript",static:!1,private:!1,access:{has:O=>"removePreloadScript"in O,get:O=>O.removePreloadScript},metadata:D},null,e),br(N,null,c,{kind:"method",name:"createUserContext",static:!1,private:!1,access:{has:O=>"createUserContext"in O,get:O=>O.createUserContext},metadata:D},null,e),D&&Object.defineProperty(N,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:D})})(),N})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var du=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},Cr=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0};let Sv=(()=>{var l,p,m,b,x,Jp,y;let i=z,e=[],t,r=[],n=[],a,o,c,h,d;return y=class extends i{constructor(_,T){super();u(this,x);u(this,l,du(this,e));u(this,p,new bt);u(this,m);F(this,"browser");u(this,b,du(this,r,void 0));du(this,n),f(this,m,T),this.connection=_}static async from(_,T){var E;const{result:D}=await _.send("session.new",{capabilities:T}),O=new y(_,D);return await w(E=O,x,Jp).call(E),O}get connection(){return s(this,b)}set connection(_){f(this,b,_)}get capabilities(){return s(this,m).capabilities}get disposed(){return this.ended}get ended(){return s(this,l)!==void 0}get id(){return s(this,m).sessionId}dispose(_){f(this,l,_),this[ne]()}async send(_,T){return await this.connection.send(_,T)}async subscribe(_,T){await this.send("session.subscribe",{events:_,contexts:T})}async addIntercepts(_,T){await this.send("session.subscribe",{events:_,contexts:T})}async end(){try{await this.send("session.end",{})}finally{this.dispose("Session already ended.")}}[(t=[cc()],a=[ms],o=[q(_=>s(_,l))],c=[q(_=>s(_,l))],h=[q(_=>s(_,l))],d=[q(_=>s(_,l))],ne)](){s(this,l)??f(this,l,"Session already destroyed, probably because the connection broke."),this.emit("ended",{reason:s(this,l)}),s(this,p).dispose(),super[ne]()}},l=new WeakMap,p=new WeakMap,m=new WeakMap,b=new WeakMap,x=new WeakSet,Jp=async function(){this.browser=await Ev.from(this),s(this,p).use(this.browser).once("closed",({reason:D})=>{this.dispose(D)});const T=new WeakSet;this.on("browsingContext.fragmentNavigated",D=>{T.has(D)||(T.add(D),this.emit("browsingContext.navigationStarted",D),this.emit("browsingContext.fragmentNavigated",D))})},(()=>{const _=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;Cr(y,null,t,{kind:"accessor",name:"connection",static:!1,private:!1,access:{has:T=>"connection"in T,get:T=>T.connection,set:(T,D)=>{T.connection=D}},metadata:_},r,n),Cr(y,null,a,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:T=>"dispose"in T,get:T=>T.dispose},metadata:_},null,e),Cr(y,null,o,{kind:"method",name:"send",static:!1,private:!1,access:{has:T=>"send"in T,get:T=>T.send},metadata:_},null,e),Cr(y,null,c,{kind:"method",name:"subscribe",static:!1,private:!1,access:{has:T=>"subscribe"in T,get:T=>T.subscribe},metadata:_},null,e),Cr(y,null,h,{kind:"method",name:"addIntercepts",static:!1,private:!1,access:{has:T=>"addIntercepts"in T,get:T=>T.addIntercepts},metadata:_},null,e),Cr(y,null,d,{kind:"method",name:"end",static:!1,private:!1,access:{has:T=>"end"in T,get:T=>T.end},metadata:_},null,e),_&&Object.defineProperty(y,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_})})(),y})();/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Pv=function(i,e,t,r,n,a){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var c=r.kind,h=c==="getter"?"get":c==="setter"?"set":"value",d=!e&&i?r.static?i:i.prototype:null,l=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,m=!1,b=t.length-1;b>=0;b--){var x={};for(var C in r)x[C]=C==="access"?{}:r[C];for(var C in r.access)x.access[C]=r.access[C];x.addInitializer=function(v){if(m)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(v||null))};var y=(0,t[b])(c==="accessor"?{get:l.get,set:l.set}:l[h],x);if(c==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(p=o(y.get))&&(l.get=p),(p=o(y.set))&&(l.set=p),(p=o(y.init))&&n.unshift(p)}else(p=o(y))&&(c==="field"?n.unshift(p):l[h]=p)}d&&Object.defineProperty(d,r.name,l),m=!0},_l=function(i,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(i,t):e[n].call(i);return r?t:void 0},kl=function(i,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(i,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};let Ov=(()=>{var a,o,c,Es,Yp,l,p,m,b,x,C,y,Qp,Zp,ef,pd;let i=em,e,t=[],r=[],n;return a=class extends i{constructor(E,g){super();u(this,c);F(this,"protocol","webDriverBiDi");u(this,o,_l(this,t,new z));u(this,l,_l(this,r));u(this,p);u(this,m);u(this,b);u(this,x,new WeakMap);u(this,C,new hv(this));u(this,y);f(this,l,g.process),f(this,p,g.closeCallback),f(this,m,E),f(this,b,g.defaultViewport),f(this,y,g.cdpConnection)}static async create(E){var M,k,j;const g=await Sv.from(E.connection,{firstMatch:(M=E.capabilities)==null?void 0:M.firstMatch,alwaysMatch:{...(k=E.capabilities)==null?void 0:k.alwaysMatch,acceptInsecureCerts:E.acceptInsecureCerts,unhandledPromptBehavior:{default:"ignore"},webSocketUrl:!0,"goog:prerenderingDisabled":!0}});await g.subscribe(g.capabilities.browserName.toLocaleLowerCase().includes("firefox")?a.subscribeModules:[...a.subscribeModules,...a.subscribeCdpEvents]);const I=new a(g.browser,E);return w(j=I,c,Qp).call(j),I}get cdpSupported(){return s(this,y)!==void 0}get cdpConnection(){return s(this,y)}async userAgent(){return s(this,m).session.capabilities.userAgent}get connection(){return s(this,m).session.connection}wsEndpoint(){return this.connection.url}async close(){var E;if(!this.connection.closed)try{await s(this,m).close(),await((E=s(this,p))==null?void 0:E.call(null))}catch(g){Ie(g)}finally{this.connection.dispose()}}get connected(){return!s(this,m).disconnected}process(){return s(this,l)??null}async createBrowserContext(E){const g=await s(this,m).createUserContext();return w(this,c,pd).call(this,g)}async version(){return`${s(this,c,Zp)}/${s(this,c,ef)}`}browserContexts(){return[...s(this,m).userContexts].map(E=>s(this,x).get(E))}defaultBrowserContext(){return s(this,x).get(s(this,m).defaultUserContext)}newPage(){return this.defaultBrowserContext().newPage()}targets(){return[s(this,C),...this.browserContexts().flatMap(E=>E.targets())]}target(){return s(this,C)}async disconnect(){try{await s(this,m).session.end()}catch(E){Ie(E)}finally{this.connection.dispose()}}get debugInfo(){return{pendingProtocolErrors:this.connection.getPendingProtocolErrors()}}},o=new WeakMap,c=new WeakSet,Es=function(){return n.get.call(this)},Yp=function(E){return n.set.call(this,E)},l=new WeakMap,p=new WeakMap,m=new WeakMap,b=new WeakMap,x=new WeakMap,C=new WeakMap,y=new WeakMap,Qp=function(){var E;for(const g of s(this,m).userContexts)w(this,c,pd).call(this,g);s(this,m).once("disconnected",()=>{s(this,c,Es).emit("disconnected",void 0),s(this,c,Es).removeAllListeners()}),(E=s(this,l))==null||E.once("close",()=>{s(this,m).dispose("Browser process exited.",!0),this.connection.dispose()})},Zp=function(){return s(this,m).session.capabilities.browserName},ef=function(){return s(this,m).session.capabilities.browserVersion},pd=function(E){const g=vv.from(this,E,{defaultViewport:s(this,b)});return s(this,x).set(E,g),g.trustedEmitter.on("targetcreated",I=>{s(this,c,Es).emit("targetcreated",I)}),g.trustedEmitter.on("targetchanged",I=>{s(this,c,Es).emit("targetchanged",I)}),g.trustedEmitter.on("targetdestroyed",I=>{s(this,c,Es).emit("targetdestroyed",I)}),g},(()=>{const E=typeof Symbol=="function"&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;e=[cc()],Pv(a,n={get:kl(function(){return s(this,o)},"#trustedEmitter","get"),set:kl(function(g){f(this,o,g)},"#trustedEmitter","set")},e,{kind:"accessor",name:"#trustedEmitter",static:!1,private:!0,access:{has:g=>za(c,g),get:g=>s(g,c,Es),set:(g,I)=>{f(g,c,I,Yp)}},metadata:E},t,r),E&&Object.defineProperty(a,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:E})})(),F(a,"subscribeModules",["browsingContext","network","log","script"]),F(a,"subscribeCdpEvents",["cdp.Debugger.scriptParsed","cdp.CSS.styleSheetAdded","cdp.Runtime.executionContextsCleared","cdp.Tracing.tracingComplete","cdp.Network.requestWillBeSent","cdp.Debugger.scriptParsed","cdp.Page.screencastFrame"]),a})();export{Ov as BidiBrowser,vv as BidiBrowserContext,by as BidiConnection,No as BidiElementHandle,Jy as BidiFrame,ar as BidiFrameRealm,Rp as BidiHTTPRequest,Ky as BidiHTTPResponse,or as BidiJSHandle,ev as BidiKeyboard,tv as BidiMouse,Do as BidiPage,Ap as BidiRealm,rv as BidiTouchscreen,ad as BidiWorkerRealm,Up as bidiToPuppeteerCookie,Hp as cdpSpecificCookiePropertiesFromPuppeteerToBidi,Rv as connectBidiOverCdp,zp as convertCookiesExpiryCdpToBiDi,lv as convertCookiesPartitionKeyFromPuppeteerToBiDi,Kp as convertCookiesSameSiteCdpToBiDi,Dp as requests};
//# sourceMappingURL=bidi-CqrhQ_7P.js.map

//# debugId=171d0e36-afad-59d5-a839-8f0b64add2c9
